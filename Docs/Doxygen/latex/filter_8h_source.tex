\doxysection{filter.\+h}
\hypertarget{filter_8h_source}{}\label{filter_8h_source}\index{/Users/hoff/Retro/virtualc64/Emulator/Components/SID/resid/filter.h@{/Users/hoff/Retro/virtualc64/Emulator/Components/SID/resid/filter.h}}

\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ \textcolor{comment}{//\ \ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{00002\ \textcolor{comment}{//\ \ This\ file\ is\ part\ of\ reSID,\ a\ MOS6581\ SID\ emulator\ engine.}}
\DoxyCodeLine{00003\ \textcolor{comment}{//\ \ Copyright\ (C)\ 2010\ \ Dag\ Lem\ <resid@nimrod.no>}}
\DoxyCodeLine{00004\ \textcolor{comment}{//}}
\DoxyCodeLine{00005\ \textcolor{comment}{//\ \ This\ program\ is\ free\ software;\ you\ can\ redistribute\ it\ and/or\ modify}}
\DoxyCodeLine{00006\ \textcolor{comment}{//\ \ it\ under\ the\ terms\ of\ the\ GNU\ General\ Public\ License\ as\ published\ by}}
\DoxyCodeLine{00007\ \textcolor{comment}{//\ \ the\ Free\ Software\ Foundation;\ either\ version\ 2\ of\ the\ License,\ or}}
\DoxyCodeLine{00008\ \textcolor{comment}{//\ \ (at\ your\ option)\ any\ later\ version.}}
\DoxyCodeLine{00009\ \textcolor{comment}{//}}
\DoxyCodeLine{00010\ \textcolor{comment}{//\ \ This\ program\ is\ distributed\ in\ the\ hope\ that\ it\ will\ be\ useful,}}
\DoxyCodeLine{00011\ \textcolor{comment}{//\ \ but\ WITHOUT\ ANY\ WARRANTY;\ without\ even\ the\ implied\ warranty\ of}}
\DoxyCodeLine{00012\ \textcolor{comment}{//\ \ MERCHANTABILITY\ or\ FITNESS\ FOR\ A\ PARTICULAR\ PURPOSE.\ \ See\ the}}
\DoxyCodeLine{00013\ \textcolor{comment}{//\ \ GNU\ General\ Public\ License\ for\ more\ details.}}
\DoxyCodeLine{00014\ \textcolor{comment}{//}}
\DoxyCodeLine{00015\ \textcolor{comment}{//\ \ You\ should\ have\ received\ a\ copy\ of\ the\ GNU\ General\ Public\ License}}
\DoxyCodeLine{00016\ \textcolor{comment}{//\ \ along\ with\ this\ program;\ if\ not,\ write\ to\ the\ Free\ Software}}
\DoxyCodeLine{00017\ \textcolor{comment}{//\ \ Foundation,\ Inc.,\ 59\ Temple\ Place,\ Suite\ 330,\ Boston,\ MA\ \ 02111-\/1307\ \ USA}}
\DoxyCodeLine{00018\ \textcolor{comment}{//\ \ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{00019\ }
\DoxyCodeLine{00020\ \textcolor{preprocessor}{\#ifndef\ RESID\_FILTER\_H}}
\DoxyCodeLine{00021\ \textcolor{preprocessor}{\#define\ RESID\_FILTER\_H}}
\DoxyCodeLine{00022\ }
\DoxyCodeLine{00023\ \textcolor{preprocessor}{\#include\ "{}resid-\/config.h"{}}}
\DoxyCodeLine{00024\ }
\DoxyCodeLine{00025\ \textcolor{keyword}{namespace\ }reSID}
\DoxyCodeLine{00026\ \{}
\DoxyCodeLine{00027\ }
\DoxyCodeLine{00028\ \textcolor{comment}{//\ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{00029\ \textcolor{comment}{//\ The\ SID\ filter\ is\ modeled\ with\ a\ two-\/integrator-\/loop\ biquadratic\ filter,}}
\DoxyCodeLine{00030\ \textcolor{comment}{//\ which\ has\ been\ confirmed\ by\ Bob\ Yannes\ to\ be\ the\ actual\ circuit\ used\ in}}
\DoxyCodeLine{00031\ \textcolor{comment}{//\ the\ SID\ chip.}}
\DoxyCodeLine{00032\ \textcolor{comment}{//}}
\DoxyCodeLine{00033\ \textcolor{comment}{//\ Measurements\ show\ that\ excellent\ emulation\ of\ the\ SID\ filter\ is\ achieved,}}
\DoxyCodeLine{00034\ \textcolor{comment}{//\ except\ when\ high\ resonance\ is\ combined\ with\ high\ sustain\ levels.}}
\DoxyCodeLine{00035\ \textcolor{comment}{//\ In\ this\ case\ the\ SID\ op-\/amps\ are\ performing\ less\ than\ ideally\ and\ are}}
\DoxyCodeLine{00036\ \textcolor{comment}{//\ causing\ some\ peculiar\ behavior\ of\ the\ SID\ filter.\ This\ however\ seems\ to}}
\DoxyCodeLine{00037\ \textcolor{comment}{//\ have\ more\ effect\ on\ the\ overall\ amplitude\ than\ on\ the\ color\ of\ the\ sound.}}
\DoxyCodeLine{00038\ \textcolor{comment}{//}}
\DoxyCodeLine{00039\ \textcolor{comment}{//\ The\ theory\ for\ the\ filter\ circuit\ can\ be\ found\ in\ "{}Microelectric\ Circuits"{}}}
\DoxyCodeLine{00040\ \textcolor{comment}{//\ by\ Adel\ S.\ Sedra\ and\ Kenneth\ C.\ Smith.}}
\DoxyCodeLine{00041\ \textcolor{comment}{//\ The\ circuit\ is\ modeled\ based\ on\ the\ explanation\ found\ there\ except\ that}}
\DoxyCodeLine{00042\ \textcolor{comment}{//\ an\ additional\ inverter\ is\ used\ in\ the\ feedback\ from\ the\ bandpass\ output,}}
\DoxyCodeLine{00043\ \textcolor{comment}{//\ allowing\ the\ summer\ op-\/amp\ to\ operate\ in\ single-\/ended\ mode.\ This\ yields}}
\DoxyCodeLine{00044\ \textcolor{comment}{//\ filter\ outputs\ with\ levels\ independent\ of\ Q,\ which\ corresponds\ with\ the}}
\DoxyCodeLine{00045\ \textcolor{comment}{//\ results\ obtained\ from\ a\ real\ SID.}}
\DoxyCodeLine{00046\ \textcolor{comment}{//}}
\DoxyCodeLine{00047\ \textcolor{comment}{//\ We\ have\ been\ able\ to\ model\ the\ summer\ and\ the\ two\ integrators\ of\ the\ circuit}}
\DoxyCodeLine{00048\ \textcolor{comment}{//\ to\ form\ components\ of\ an\ IIR\ filter.}}
\DoxyCodeLine{00049\ \textcolor{comment}{//\ Vhp\ is\ the\ output\ of\ the\ summer,\ Vbp\ is\ the\ output\ of\ the\ first\ integrator,}}
\DoxyCodeLine{00050\ \textcolor{comment}{//\ and\ Vlp\ is\ the\ output\ of\ the\ second\ integrator\ in\ the\ filter\ circuit.}}
\DoxyCodeLine{00051\ \textcolor{comment}{//}}
\DoxyCodeLine{00052\ \textcolor{comment}{//\ According\ to\ Bob\ Yannes,\ the\ active\ stages\ of\ the\ SID\ filter\ are\ not\ really}}
\DoxyCodeLine{00053\ \textcolor{comment}{//\ op-\/amps.\ Rather,\ simple\ NMOS\ inverters\ are\ used.\ By\ biasing\ an\ inverter}}
\DoxyCodeLine{00054\ \textcolor{comment}{//\ into\ its\ region\ of\ quasi-\/linear\ operation\ using\ a\ feedback\ resistor\ from}}
\DoxyCodeLine{00055\ \textcolor{comment}{//\ input\ to\ output,\ a\ MOS\ inverter\ can\ be\ made\ to\ act\ like\ an\ op-\/amp\ for}}
\DoxyCodeLine{00056\ \textcolor{comment}{//\ small\ signals\ centered\ around\ the\ switching\ threshold.}}
\DoxyCodeLine{00057\ \textcolor{comment}{//}}
\DoxyCodeLine{00058\ \textcolor{comment}{//\ In\ 2008,\ Michael\ Huth\ facilitated\ closer\ investigation\ of\ the\ SID\ 6581}}
\DoxyCodeLine{00059\ \textcolor{comment}{//\ filter\ circuit\ by\ publishing\ high\ quality\ microscope\ photographs\ of\ the\ die.}}
\DoxyCodeLine{00060\ \textcolor{comment}{//\ Tommi\ Lempinen\ has\ done\ an\ impressive\ work\ on\ re-\/vectorizing\ and\ annotating}}
\DoxyCodeLine{00061\ \textcolor{comment}{//\ the\ die\ photographs,\ substantially\ simplifying\ further\ analysis\ of\ the}}
\DoxyCodeLine{00062\ \textcolor{comment}{//\ filter\ circuit.}}
\DoxyCodeLine{00063\ \textcolor{comment}{//}}
\DoxyCodeLine{00064\ \textcolor{comment}{//\ The\ filter\ schematics\ below\ are\ reverse\ engineered\ from\ these\ re-\/vectorized}}
\DoxyCodeLine{00065\ \textcolor{comment}{//\ and\ annotated\ die\ photographs.\ While\ the\ filter\ first\ depicted\ in\ reSID\ 0.9}}
\DoxyCodeLine{00066\ \textcolor{comment}{//\ is\ a\ correct\ model\ of\ the\ basic\ filter,\ the\ schematics\ are\ now\ completed}}
\DoxyCodeLine{00067\ \textcolor{comment}{//\ with\ the\ audio\ mixer\ and\ output\ stage,\ including\ details\ on\ intended}}
\DoxyCodeLine{00068\ \textcolor{comment}{//\ relative\ resistor\ values.\ Also\ included\ are\ schematics\ for\ the\ NMOS\ FET}}
\DoxyCodeLine{00069\ \textcolor{comment}{//\ voltage\ controlled\ resistors\ (VCRs)\ used\ to\ control\ cutoff\ frequency,\ the}}
\DoxyCodeLine{00070\ \textcolor{comment}{//\ DAC\ which\ controls\ the\ VCRs,\ the\ NMOS\ op-\/amps,\ and\ the\ output\ buffer.}}
\DoxyCodeLine{00071\ \textcolor{comment}{//}}
\DoxyCodeLine{00072\ \textcolor{comment}{//}}
\DoxyCodeLine{00073\ \textcolor{comment}{//\ SID\ filter\ /\ mixer\ /\ output}}
\DoxyCodeLine{00074\ \textcolor{comment}{//\ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{00075\ \textcolor{comment}{//}}
\DoxyCodeLine{00076\ \textcolor{comment}{//\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{00077\ \textcolor{comment}{//\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ |\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ |}}
\DoxyCodeLine{00078\ \textcolor{comment}{//\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ |\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ -\/-\/1R1-\/-\/\ \(\backslash\)-\/-\/\ \ D7\ \ \ \ \ \ \ \ \ \ \ |}}
\DoxyCodeLine{00079\ \textcolor{comment}{//\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ |\ \ \ \ \ \ \ \ \ \ \ \ \ \ -\/-\/-\/R1-\/-\/\ \ \ |\ \ \ \ \ \ \ \ \ \ \ |\ \ \ \ \ \ \ \ \ \ \ \ \ \ |}}
\DoxyCodeLine{00080\ \textcolor{comment}{//\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ |\ \ \ \ \ \ \ \ \ \ \ \ \ |\ \ \ \ \ \ \ |\ \ |-\/-\/2R1-\/-\/\ \(\backslash\)-\/-\/|\ D6\ \ \ \ \ \ \ \ \ \ \ |}}
\DoxyCodeLine{00081\ \textcolor{comment}{//\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ |\ \ \ \ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/<A]-\/-\/-\/-\/-\/|\ \ \ \ \ \ \ \ \ \ \ |\ \ \ \ \ \$17\ \ \ \ \ \ |}}
\DoxyCodeLine{00082\ \textcolor{comment}{//\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ |\ \ \ |\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ |-\/-\/4R1-\/-\/\ \(\backslash\)-\/-\/|\ D5\ \ 1=open\ \ \ |\ (3.5R1)}}
\DoxyCodeLine{00083\ \textcolor{comment}{//\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ |\ \ \ |\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ |\ \ \ \ \ \ \ \ \ \ \ |\ \ \ \ \ \ \ \ \ \ \ \ \ \ |}}
\DoxyCodeLine{00084\ \textcolor{comment}{//\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ |\ \ \ |\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ -\/-\/8R1-\/-\/\ \(\backslash\)-\/-\/|\ D4\ \ \ \ \ \ \ \ \ \ \ |\ (7.0R1)}}
\DoxyCodeLine{00085\ \textcolor{comment}{//\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ |\ \ \ |\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ |\ \ \ \ \ \ \ \ \ \ \ \ \ \ |}}
\DoxyCodeLine{00086\ \textcolor{comment}{//\ \$17\ \ \ \ \ \ \ \ \ \ \ |\ \ \ |\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (CAP2B)\ \ \ \ \ |\ \ (CAP1B)\ \ \ \ \ |}}
\DoxyCodeLine{00087\ \textcolor{comment}{//\ 0=to\ mixer\ \ \ \ |\ \ \ \ -\/-\/R8-\/-\/\ \ \ \ -\/-\/-\/R8-\/-\/\ \ \ \ \ \ \ \ -\/-\/-\/C-\/-\/-\/|\ \ \ \ \ \ \ -\/-\/-\/C-\/-\/-\/|}}
\DoxyCodeLine{00088\ \textcolor{comment}{//\ 1=to\ filter\ \ \ |\ \ \ \ \ \ \ \ \ \ |\ \ |\ \ \ \ \ \ \ |\ \ \ \ \ \ |\ \ \ \ \ \ \ |\ \ \ \ \ \ |\ \ \ \ \ \ \ |}}
\DoxyCodeLine{00089\ \textcolor{comment}{//\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ -\/-\/-\/-\/-\/-\/R8-\/-\/|-\/-\/-\/-\/-\/[A>-\/-\/|-\/-\/Rw-\/-\/-\/-\/-\/[A>-\/-\/|-\/-\/Rw-\/-\/-\/-\/-\/[A>-\/-\/|}}
\DoxyCodeLine{00090\ \textcolor{comment}{//\ \ \ \ \ ve\ (EXT\ IN)\ \ \ \ \ \ \ \ \ \ |\ \ \ \ \ \ \ \ \ \ |\ \ \ \ \ \ \ \ \ \ \ \ \ \ |\ \ \ \ \ \ \ \ \ \ \ \ \ \ |}}
\DoxyCodeLine{00091\ \textcolor{comment}{//\ D3\ \ \(\backslash\)\ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/R8-\/-\/|\ \ \ \ \ \ \ \ \ \ |\ \ \ \ \ \ \ \ \ \ \ \ \ \ |\ (CAP2A)\ \ \ \ \ \ |\ (CAP1A)}}
\DoxyCodeLine{00092\ \textcolor{comment}{//\ \ \ \ \ |\ \ \ v3\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ |\ \ \ \ \ \ \ \ \ \ |\ vhp\ \ \ \ \ \ \ \ \ \ |\ vbp\ \ \ \ \ \ \ \ \ \ |\ vlp}}
\DoxyCodeLine{00093\ \textcolor{comment}{//\ D2\ \ |\ \ \ \(\backslash\)\ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/R8-\/-\/|\ \ \ \ \ -\/-\/-\/-\/-\/\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ |\ \ \ \ \ \ \ \ \ \ \ \ \ \ |}}
\DoxyCodeLine{00094\ \textcolor{comment}{//\ \ \ \ \ |\ \ \ |\ \ \ v2\ \ \ \ \ \ \ \ \ \ \ |\ \ \ \ |\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ |\ \ \ \ \ \ \ \ \ \ \ \ \ \ |}}
\DoxyCodeLine{00095\ \textcolor{comment}{//\ D1\ \ |\ \ \ |\ \ \ \(\backslash\)\ -\/-\/-\/-\/-\/-\/-\/R8-\/-\/|\ \ \ \ |\ \ \ \ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ |}}
\DoxyCodeLine{00096\ \textcolor{comment}{//\ \ \ \ \ |\ \ \ |\ \ \ |\ \ \ v1\ \ \ \ \ \ \ |\ \ \ \ |\ \ \ |\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ |}}
\DoxyCodeLine{00097\ \textcolor{comment}{//\ D0\ \ |\ \ \ |\ \ \ |\ \ \ \(\backslash\)\ -\/-\/-\/R8-\/-\/\ \ \ \ \ |\ \ \ |\ \ \ \ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{00098\ \textcolor{comment}{//\ \ \ \ \ |\ \ \ |\ \ \ |\ \ \ |\ \ \ \ \ \ \ \ \ \ \ \ \ |\ \ \ |\ \ \ |}}
\DoxyCodeLine{00099\ \textcolor{comment}{//\ \ \ \ \ R6\ \ R6\ \ R6\ \ R6\ \ \ \ \ \ \ \ \ \ \ \ R6\ \ R6\ \ R6}}
\DoxyCodeLine{00100\ \textcolor{comment}{//\ \ \ \ \ |\ \ \ |\ \ \ |\ \ \ |\ \$18\ \ \ \ \ \ \ \ \ |\ \ \ |\ \ \ |\ \ \$18}}
\DoxyCodeLine{00101\ \textcolor{comment}{//\ \ \ \ \ |\ \ \ \ \(\backslash\)\ \ |\ \ \ |\ D7:\ 1=open\ \ \ \(\backslash\)\ \ \ \(\backslash\)\ \ \ \(\backslash\)\ D6\ -\/\ D4:\ 0=open}}
\DoxyCodeLine{00102\ \textcolor{comment}{//\ \ \ \ \ |\ \ \ |\ \ \ |\ \ \ |\ \ \ \ \ \ \ \ \ \ \ \ \ |\ \ \ |\ \ \ |}}
\DoxyCodeLine{00103\ \textcolor{comment}{//\ \ \ \ \ \ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ 12V}}
\DoxyCodeLine{00104\ \textcolor{comment}{//\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ |}}
\DoxyCodeLine{00105\ \textcolor{comment}{//\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ |\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ D3\ \ -\/-\//\ -\/-\/1R2-\/-\/\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ |}}
\DoxyCodeLine{00106\ \textcolor{comment}{//\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ |\ \ \ \ -\/-\/-\/R8-\/-\/\ \ \ \ \ \ \ |\ \ \ \ \ \ \ \ \ \ \ |\ \ \ -\/-\/-\/R2-\/-\/\ \ \ \ \ \ \ |}}
\DoxyCodeLine{00107\ \textcolor{comment}{//\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ |\ \ \ |\ \ \ \ \ \ \ |\ \ \ D2\ |-\/-\//\ -\/-\/2R2-\/-\/|\ \ |\ \ \ \ \ \ \ |\ \ ||-\/-\/}}
\DoxyCodeLine{00108\ \textcolor{comment}{//\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ -\/-\/-\/-\/-\/-\/[A>-\/-\/-\/-\/-\/-\/-\/-\/-\/|\ \ \ \ \ \ \ \ \ \ \ |-\/-\/-\/-\/-\/[A>-\/-\/-\/-\/-\/||}}
\DoxyCodeLine{00109\ \textcolor{comment}{//\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ D1\ |-\/-\//\ -\/-\/4R2-\/-\/|\ (4.25R2)\ \ \ \ ||-\/-\/}}
\DoxyCodeLine{00110\ \textcolor{comment}{//\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \$18\ \ \ \ \ \ \ \ \ |\ \ \ \ \ \ \ \ \ \ \ |\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ |}}
\DoxyCodeLine{00111\ \textcolor{comment}{//\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ 0=open\ \ \ D0\ \ -\/-\//\ -\/-\/8R2-\/-\/\ \ (8.75R2)\ \ \ \ \ \ \ \ |}}
\DoxyCodeLine{00112\ \textcolor{comment}{//}}
\DoxyCodeLine{00113\ \textcolor{comment}{//\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ vo\ (AUDIO}}
\DoxyCodeLine{00114\ \textcolor{comment}{//\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ OUT)}}
\DoxyCodeLine{00115\ \textcolor{comment}{//}}
\DoxyCodeLine{00116\ \textcolor{comment}{//}}
\DoxyCodeLine{00117\ \textcolor{comment}{//\ v1\ \ -\/\ voice\ 1}}
\DoxyCodeLine{00118\ \textcolor{comment}{//\ v2\ \ -\/\ voice\ 2}}
\DoxyCodeLine{00119\ \textcolor{comment}{//\ v3\ \ -\/\ voice\ 3}}
\DoxyCodeLine{00120\ \textcolor{comment}{//\ ve\ \ -\/\ ext\ in}}
\DoxyCodeLine{00121\ \textcolor{comment}{//\ vhp\ -\/\ highpass\ output}}
\DoxyCodeLine{00122\ \textcolor{comment}{//\ vbp\ -\/\ bandpass\ output}}
\DoxyCodeLine{00123\ \textcolor{comment}{//\ vlp\ -\/\ lowpass\ output}}
\DoxyCodeLine{00124\ \textcolor{comment}{//\ vo\ \ -\/\ audio\ out}}
\DoxyCodeLine{00125\ \textcolor{comment}{//\ [A>\ -\/\ single\ ended\ inverting\ op-\/amp\ (self-\/biased\ NMOS\ inverter)}}
\DoxyCodeLine{00126\ \textcolor{comment}{//\ Rn\ \ -\/\ "{}resistors"{},\ implemented\ with\ custom\ NMOS\ FETs}}
\DoxyCodeLine{00127\ \textcolor{comment}{//\ Rw\ \ -\/\ cutoff\ frequency\ resistor\ (VCR)}}
\DoxyCodeLine{00128\ \textcolor{comment}{//\ C\ \ \ -\/\ capacitor}}
\DoxyCodeLine{00129\ \textcolor{comment}{//}}
\DoxyCodeLine{00130\ \textcolor{comment}{//\ Notes:}}
\DoxyCodeLine{00131\ \textcolor{comment}{//}}
\DoxyCodeLine{00132\ \textcolor{comment}{//\ R2\ \ \string~\ \ 2.0*R1}}
\DoxyCodeLine{00133\ \textcolor{comment}{//\ R6\ \ \string~\ \ 6.0*R1}}
\DoxyCodeLine{00134\ \textcolor{comment}{//\ R8\ \ \string~\ \ 8.0*R1}}
\DoxyCodeLine{00135\ \textcolor{comment}{//\ R24\ \string~\ 24.0*R1}}
\DoxyCodeLine{00136\ \textcolor{comment}{//}}
\DoxyCodeLine{00137\ \textcolor{comment}{//\ The\ Rn\ "{}resistors"{}\ in\ the\ circuit\ are\ implemented\ with\ custom\ NMOS\ FETs,}}
\DoxyCodeLine{00138\ \textcolor{comment}{//\ probably\ because\ of\ space\ constraints\ on\ the\ SID\ die.\ The\ silicon\ substrate}}
\DoxyCodeLine{00139\ \textcolor{comment}{//\ is\ laid\ out\ in\ a\ narrow\ strip\ or\ "{}snake"{},\ with\ a\ strip\ length\ proportional}}
\DoxyCodeLine{00140\ \textcolor{comment}{//\ to\ the\ intended\ resistance.\ The\ polysilicon\ gate\ electrode\ covers\ the\ entire}}
\DoxyCodeLine{00141\ \textcolor{comment}{//\ silicon\ substrate\ and\ is\ fixed\ at\ 12V\ in\ order\ for\ the\ NMOS\ FET\ to\ operate}}
\DoxyCodeLine{00142\ \textcolor{comment}{//\ in\ triode\ mode\ (a.k.a.\ linear\ mode\ or\ ohmic\ mode).}}
\DoxyCodeLine{00143\ \textcolor{comment}{//}}
\DoxyCodeLine{00144\ \textcolor{comment}{//\ Even\ in\ "{}linear\ mode"{},\ an\ NMOS\ FET\ is\ only\ an\ approximation\ of\ a\ resistor,}}
\DoxyCodeLine{00145\ \textcolor{comment}{//\ as\ the\ apparant\ resistance\ increases\ with\ increasing\ drain-\/to-\/source}}
\DoxyCodeLine{00146\ \textcolor{comment}{//\ voltage.\ If\ the\ drain-\/to-\/source\ voltage\ should\ approach\ the\ gate\ voltage}}
\DoxyCodeLine{00147\ \textcolor{comment}{//\ of\ 12V,\ the\ NMOS\ FET\ will\ enter\ saturation\ mode\ (a.k.a.\ active\ mode),\ and}}
\DoxyCodeLine{00148\ \textcolor{comment}{//\ the\ NMOS\ FET\ will\ not\ operate\ anywhere\ like\ a\ resistor.}}
\DoxyCodeLine{00149\ \textcolor{comment}{//}}
\DoxyCodeLine{00150\ \textcolor{comment}{//}}
\DoxyCodeLine{00151\ \textcolor{comment}{//}}
\DoxyCodeLine{00152\ \textcolor{comment}{//\ NMOS\ FET\ voltage\ controlled\ resistor\ (VCR)}}
\DoxyCodeLine{00153\ \textcolor{comment}{//\ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{00154\ \textcolor{comment}{//}}
\DoxyCodeLine{00155\ \textcolor{comment}{//\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ Vw}}
\DoxyCodeLine{00156\ \textcolor{comment}{//}}
\DoxyCodeLine{00157\ \textcolor{comment}{//\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ |}}
\DoxyCodeLine{00158\ \textcolor{comment}{//\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ |}}
\DoxyCodeLine{00159\ \textcolor{comment}{//\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ R1}}
\DoxyCodeLine{00160\ \textcolor{comment}{//\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ |}}
\DoxyCodeLine{00161\ \textcolor{comment}{//\ \ \ \ \ \ \ \ \ \ -\/-\/R1-\/-\/|}}
\DoxyCodeLine{00162\ \textcolor{comment}{//\ \ \ \ \ \ \ \ \ |\ \ \ \ \_\_|\_\_}}
\DoxyCodeLine{00163\ \textcolor{comment}{//\ \ \ \ \ \ \ \ \ |\ \ \ \ -\/-\/-\/-\/-\/}}
\DoxyCodeLine{00164\ \textcolor{comment}{//\ \ \ \ \ \ \ \ \ |\ \ \ \ |\ \ \ |}}
\DoxyCodeLine{00165\ \textcolor{comment}{//\ vi\ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/\ \ \ \ \ -\/-\/-\/-\/-\/-\/-\/-\/\ vo}}
\DoxyCodeLine{00166\ \textcolor{comment}{//\ \ \ \ \ \ \ \ \ |\ \ \ \ \ \ \ \ \ \ \ |}}
\DoxyCodeLine{00167\ \textcolor{comment}{//\ \ \ \ \ \ \ \ \ \ -\/-\/-\/-\/R24-\/-\/-\/-\/}}
\DoxyCodeLine{00168\ \textcolor{comment}{//}}
\DoxyCodeLine{00169\ \textcolor{comment}{//}}
\DoxyCodeLine{00170\ \textcolor{comment}{//\ vi\ \ -\/\ input}}
\DoxyCodeLine{00171\ \textcolor{comment}{//\ vo\ \ -\/\ output}}
\DoxyCodeLine{00172\ \textcolor{comment}{//\ Rn\ \ -\/\ "{}resistors"{},\ implemented\ with\ custom\ NMOS\ FETs}}
\DoxyCodeLine{00173\ \textcolor{comment}{//\ Vw\ \ -\/\ voltage\ from\ 11-\/bit\ DAC\ (frequency\ cutoff\ control)}}
\DoxyCodeLine{00174\ \textcolor{comment}{//}}
\DoxyCodeLine{00175\ \textcolor{comment}{//\ Notes:}}
\DoxyCodeLine{00176\ \textcolor{comment}{//}}
\DoxyCodeLine{00177\ \textcolor{comment}{//\ An\ approximate\ value\ for\ R24\ can\ be\ found\ by\ using\ the\ formula\ for\ the}}
\DoxyCodeLine{00178\ \textcolor{comment}{//\ filter\ cutoff\ frequency:}}
\DoxyCodeLine{00179\ \textcolor{comment}{//}}
\DoxyCodeLine{00180\ \textcolor{comment}{//\ FCmin\ =\ 1/(2*pi*Rmax*C)}}
\DoxyCodeLine{00181\ \textcolor{comment}{//}}
\DoxyCodeLine{00182\ \textcolor{comment}{//\ Assuming\ that\ a\ the\ setting\ for\ minimum\ cutoff\ frequency\ in\ combination\ with}}
\DoxyCodeLine{00183\ \textcolor{comment}{//\ a\ low\ level\ input\ signal\ ensures\ that\ only\ negligible\ current\ will\ flow}}
\DoxyCodeLine{00184\ \textcolor{comment}{//\ through\ the\ transistor\ in\ the\ schematics\ above,\ values\ for\ FCmin\ and\ C\ can}}
\DoxyCodeLine{00185\ \textcolor{comment}{//\ be\ substituted\ in\ this\ formula\ to\ find\ Rmax.}}
\DoxyCodeLine{00186\ \textcolor{comment}{//\ Using\ C\ =\ 470pF\ and\ FCmin\ =\ 220Hz\ (measured\ value),\ we\ get:}}
\DoxyCodeLine{00187\ \textcolor{comment}{//}}
\DoxyCodeLine{00188\ \textcolor{comment}{//\ FCmin\ =\ 1/(2*pi*Rmax*C)}}
\DoxyCodeLine{00189\ \textcolor{comment}{//\ Rmax\ =\ 1/(2*pi*FCmin*C)\ =\ 1/(2*pi*220*470e-\/12)\ \string~\ 1.5MOhm}}
\DoxyCodeLine{00190\ \textcolor{comment}{//}}
\DoxyCodeLine{00191\ \textcolor{comment}{//\ From\ this\ it\ follows\ that:}}
\DoxyCodeLine{00192\ \textcolor{comment}{//\ R24\ =\ \ Rmax\ \ \ \string~\ 1.5MOhm}}
\DoxyCodeLine{00193\ \textcolor{comment}{//\ R1\ \ \string~\ \ R24/24\ \string~\ \ 64kOhm}}
\DoxyCodeLine{00194\ \textcolor{comment}{//\ R2\ \ \string~\ \ 2.0*R1\ \string~\ 128kOhm}}
\DoxyCodeLine{00195\ \textcolor{comment}{//\ R6\ \ \string~\ \ 6.0*R1\ \string~\ 384kOhm}}
\DoxyCodeLine{00196\ \textcolor{comment}{//\ R8\ \ \string~\ \ 8.0*R1\ \string~\ 512kOhm}}
\DoxyCodeLine{00197\ \textcolor{comment}{//}}
\DoxyCodeLine{00198\ \textcolor{comment}{//\ Note\ that\ these\ are\ only\ approximate\ values\ for\ one\ particular\ SID\ chip,}}
\DoxyCodeLine{00199\ \textcolor{comment}{//\ due\ to\ process\ variations\ the\ values\ can\ be\ substantially\ different\ in}}
\DoxyCodeLine{00200\ \textcolor{comment}{//\ other\ chips.}}
\DoxyCodeLine{00201\ \textcolor{comment}{//}}
\DoxyCodeLine{00202\ \textcolor{comment}{//}}
\DoxyCodeLine{00203\ \textcolor{comment}{//}}
\DoxyCodeLine{00204\ \textcolor{comment}{//\ Filter\ frequency\ cutoff\ DAC}}
\DoxyCodeLine{00205\ \textcolor{comment}{//\ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{00206\ \textcolor{comment}{//}}
\DoxyCodeLine{00207\ \textcolor{comment}{//}}
\DoxyCodeLine{00208\ \textcolor{comment}{//\ \ \ \ \ \ \ \ 12V\ \ 10\ \ \ 9\ \ \ 8\ \ \ 7\ \ \ 6\ \ \ 5\ \ \ 4\ \ \ 3\ \ \ 2\ \ \ 1\ \ \ 0\ \ \ VGND}}
\DoxyCodeLine{00209\ \textcolor{comment}{//\ \ \ \ \ \ \ \ \ \ |\ \ \ |\ \ \ |\ \ \ |\ \ \ |\ \ \ |\ \ \ |\ \ \ |\ \ \ |\ \ \ |\ \ \ |\ \ \ |\ \ \ \ \ |\ \ \ Missing}}
\DoxyCodeLine{00210\ \textcolor{comment}{//\ \ \ \ \ \ \ \ \ 2R\ \ 2R\ \ 2R\ \ 2R\ \ 2R\ \ 2R\ \ 2R\ \ 2R\ \ 2R\ \ 2R\ \ 2R\ \ 2R\ \ \ \ 2R\ \ \ termination}}
\DoxyCodeLine{00211\ \textcolor{comment}{//\ \ \ \ \ \ \ \ \ \ |\ \ \ |\ \ \ |\ \ \ |\ \ \ |\ \ \ |\ \ \ |\ \ \ |\ \ \ |\ \ \ |\ \ \ |\ \ \ |\ \ \ \ \ |}}
\DoxyCodeLine{00212\ \textcolor{comment}{//\ \ \ \ \ Vw\ -\/-\/-\/-\/R-\/-\/-\/R-\/-\/-\/R-\/-\/-\/R-\/-\/-\/R-\/-\/-\/R-\/-\/-\/R-\/-\/-\/R-\/-\/-\/R-\/-\/-\/R-\/-\/-\/R-\/-\/\ \ \ -\/-\/-\/}}
\DoxyCodeLine{00213\ \textcolor{comment}{//}}
\DoxyCodeLine{00214\ \textcolor{comment}{//\ Bit\ on:\ \ 12V}}
\DoxyCodeLine{00215\ \textcolor{comment}{//\ Bit\ off:\ \ 5V\ (VGND)}}
\DoxyCodeLine{00216\ \textcolor{comment}{//}}
\DoxyCodeLine{00217\ \textcolor{comment}{//\ As\ is\ the\ case\ with\ all\ MOS\ 6581\ DACs,\ the\ termination\ to\ (virtual)\ ground}}
\DoxyCodeLine{00218\ \textcolor{comment}{//\ at\ bit\ 0\ is\ missing.}}
\DoxyCodeLine{00219\ \textcolor{comment}{//}}
\DoxyCodeLine{00220\ \textcolor{comment}{//\ Furthermore,\ the\ control\ of\ the\ two\ VCRs\ imposes\ a\ load\ on\ the\ DAC\ output}}
\DoxyCodeLine{00221\ \textcolor{comment}{//\ which\ varies\ with\ the\ input\ signals\ to\ the\ VCRs.\ This\ can\ be\ seen\ from\ the}}
\DoxyCodeLine{00222\ \textcolor{comment}{//\ VCR\ figure\ above.}}
\DoxyCodeLine{00223\ \textcolor{comment}{//}}
\DoxyCodeLine{00224\ \textcolor{comment}{//}}
\DoxyCodeLine{00225\ \textcolor{comment}{//}}
\DoxyCodeLine{00226\ \textcolor{comment}{//\ "{}Op-\/amp"{}\ (self-\/biased\ NMOS\ inverter)}}
\DoxyCodeLine{00227\ \textcolor{comment}{//\ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{00228\ \textcolor{comment}{//}}
\DoxyCodeLine{00229\ \textcolor{comment}{//}}
\DoxyCodeLine{00230\ \textcolor{comment}{//\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ 12V}}
\DoxyCodeLine{00231\ \textcolor{comment}{//}}
\DoxyCodeLine{00232\ \textcolor{comment}{//\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ |}}
\DoxyCodeLine{00233\ \textcolor{comment}{//\ \ \ \ \ \ \ \ \ \ \ \ \ \ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/|}}
\DoxyCodeLine{00234\ \textcolor{comment}{//\ \ \ \ \ \ \ \ \ \ \ \ \ |\ \ \ \ \ \ \ \ \ \ \ |}}
\DoxyCodeLine{00235\ \textcolor{comment}{//\ \ \ \ \ \ \ \ \ \ \ \ \ |\ \ \ \ \ -\/-\/-\/-\/-\/-\/|}}
\DoxyCodeLine{00236\ \textcolor{comment}{//\ \ \ \ \ \ \ \ \ \ \ \ \ |\ \ \ \ |\ \ \ \ \ \ |}}
\DoxyCodeLine{00237\ \textcolor{comment}{//\ \ \ \ \ \ \ \ \ \ \ \ \ |\ \ \ \ |\ \ ||-\/-\/}}
\DoxyCodeLine{00238\ \textcolor{comment}{//\ \ \ \ \ \ \ \ \ \ \ \ \ |\ \ \ \ \ -\/-\/||}}
\DoxyCodeLine{00239\ \textcolor{comment}{//\ \ \ \ \ \ \ \ \ \ \ \ \ |\ \ \ \ \ \ \ ||-\/-\/}}
\DoxyCodeLine{00240\ \textcolor{comment}{//\ \ \ \ \ \ \ \ \ ||-\/-\/\ \ \ \ \ \ \ \ \ \ \ \ |}}
\DoxyCodeLine{00241\ \textcolor{comment}{//\ vi\ -\/-\/-\/-\/-\/||\ \ \ \ \ \ \ \ \ \ \ \ \ \ |-\/-\/-\/-\/-\/-\/-\/-\/-\/\ vo}}
\DoxyCodeLine{00242\ \textcolor{comment}{//\ \ \ \ \ \ \ \ \ ||-\/-\/\ \ \ \ \ \ \ \ \ \ \ \ |\ \ \ |}}
\DoxyCodeLine{00243\ \textcolor{comment}{//\ \ \ \ \ \ \ \ \ \ \ \ \ |\ \ \ \ \ \ \ ||-\/-\/\ \ \ \ |}}
\DoxyCodeLine{00244\ \textcolor{comment}{//\ \ \ \ \ \ \ \ \ \ \ \ \ |-\/-\/-\/-\/-\/-\/-\/||\ \ \ \ \ \ |}}
\DoxyCodeLine{00245\ \textcolor{comment}{//\ \ \ \ \ \ \ \ \ \ \ \ \ |\ \ \ \ \ \ \ ||-\/-\/\ \ \ \ |}}
\DoxyCodeLine{00246\ \textcolor{comment}{//\ \ \ \ \ \ \ \ \ ||-\/-\/\ \ \ \ \ \ \ \ \ \ \ \ |\ \ \ |}}
\DoxyCodeLine{00247\ \textcolor{comment}{//\ \ \ \ \ \ \ -\/-\/||\ \ \ \ \ \ \ \ \ \ \ \ \ \ |\ \ \ |}}
\DoxyCodeLine{00248\ \textcolor{comment}{//\ \ \ \ \ \ |\ \ ||-\/-\/\ \ \ \ \ \ \ \ \ \ \ \ |\ \ \ |}}
\DoxyCodeLine{00249\ \textcolor{comment}{//\ \ \ \ \ \ |\ \ \ \ \ \ |\ \ \ \ \ \ \ \ \ \ \ |\ \ \ |}}
\DoxyCodeLine{00250\ \textcolor{comment}{//\ \ \ \ \ \ |\ \ \ \ \ \ \ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/|\ \ \ |}}
\DoxyCodeLine{00251\ \textcolor{comment}{//\ \ \ \ \ \ |\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ |\ \ \ |}}
\DoxyCodeLine{00252\ \textcolor{comment}{//\ \ \ \ \ \ |\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ |}}
\DoxyCodeLine{00253\ \textcolor{comment}{//\ \ \ \ \ \ |\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ GND\ \ |}}
\DoxyCodeLine{00254\ \textcolor{comment}{//\ \ \ \ \ \ |\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ |}}
\DoxyCodeLine{00255\ \textcolor{comment}{//\ \ \ \ \ \ \ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{00256\ \textcolor{comment}{//}}
\DoxyCodeLine{00257\ \textcolor{comment}{//}}
\DoxyCodeLine{00258\ \textcolor{comment}{//\ vi\ \ -\/\ input}}
\DoxyCodeLine{00259\ \textcolor{comment}{//\ vo\ \ -\/\ output}}
\DoxyCodeLine{00260\ \textcolor{comment}{//}}
\DoxyCodeLine{00261\ \textcolor{comment}{//\ Notes:}}
\DoxyCodeLine{00262\ \textcolor{comment}{//}}
\DoxyCodeLine{00263\ \textcolor{comment}{//\ The\ schematics\ above\ are\ laid\ out\ to\ show\ that\ the\ "{}op-\/amp"{}\ logically}}
\DoxyCodeLine{00264\ \textcolor{comment}{//\ consists\ of\ two\ building\ blocks;\ a\ saturated\ load\ NMOS\ inverter\ (on\ the}}
\DoxyCodeLine{00265\ \textcolor{comment}{//\ right\ hand\ side\ of\ the\ schematics)\ with\ a\ buffer\ /\ bias\ input\ stage}}
\DoxyCodeLine{00266\ \textcolor{comment}{//\ consisting\ of\ a\ variable\ saturated\ load\ NMOS\ inverter\ (on\ the\ left\ hand}}
\DoxyCodeLine{00267\ \textcolor{comment}{//\ side\ of\ the\ schematics).}}
\DoxyCodeLine{00268\ \textcolor{comment}{//}}
\DoxyCodeLine{00269\ \textcolor{comment}{//\ Provided\ a\ reasonably\ high\ input\ impedance\ and\ a\ reasonably\ low\ output}}
\DoxyCodeLine{00270\ \textcolor{comment}{//\ impedance,\ the\ "{}op-\/amp"{}\ can\ be\ modeled\ as\ a\ voltage\ transfer\ function}}
\DoxyCodeLine{00271\ \textcolor{comment}{//\ mapping\ input\ voltage\ to\ output\ voltage.}}
\DoxyCodeLine{00272\ \textcolor{comment}{//}}
\DoxyCodeLine{00273\ \textcolor{comment}{//}}
\DoxyCodeLine{00274\ \textcolor{comment}{//}}
\DoxyCodeLine{00275\ \textcolor{comment}{//\ Output\ buffer\ (NMOS\ voltage\ follower)}}
\DoxyCodeLine{00276\ \textcolor{comment}{//\ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{00277\ \textcolor{comment}{//}}
\DoxyCodeLine{00278\ \textcolor{comment}{//}}
\DoxyCodeLine{00279\ \textcolor{comment}{//\ \ \ \ \ \ \ \ \ \ \ \ 12V}}
\DoxyCodeLine{00280\ \textcolor{comment}{//}}
\DoxyCodeLine{00281\ \textcolor{comment}{//\ \ \ \ \ \ \ \ \ \ \ \ \ |}}
\DoxyCodeLine{00282\ \textcolor{comment}{//\ \ \ \ \ \ \ \ \ \ \ \ \ |}}
\DoxyCodeLine{00283\ \textcolor{comment}{//\ \ \ \ \ \ \ \ \ ||-\/-\/}}
\DoxyCodeLine{00284\ \textcolor{comment}{//\ vi\ -\/-\/-\/-\/-\/||}}
\DoxyCodeLine{00285\ \textcolor{comment}{//\ \ \ \ \ \ \ \ \ ||-\/-\/}}
\DoxyCodeLine{00286\ \textcolor{comment}{//\ \ \ \ \ \ \ \ \ \ \ \ \ |}}
\DoxyCodeLine{00287\ \textcolor{comment}{//\ \ \ \ \ \ \ \ \ \ \ \ \ |-\/-\/-\/-\/-\/-\/\ vo}}
\DoxyCodeLine{00288\ \textcolor{comment}{//\ \ \ \ \ \ \ \ \ \ \ \ \ |\ \ \ \ \ (AUDIO}}
\DoxyCodeLine{00289\ \textcolor{comment}{//\ \ \ \ \ \ \ \ \ \ \ \ Rext\ \ \ \ OUT)}}
\DoxyCodeLine{00290\ \textcolor{comment}{//\ \ \ \ \ \ \ \ \ \ \ \ \ |}}
\DoxyCodeLine{00291\ \textcolor{comment}{//\ \ \ \ \ \ \ \ \ \ \ \ \ |}}
\DoxyCodeLine{00292\ \textcolor{comment}{//}}
\DoxyCodeLine{00293\ \textcolor{comment}{//\ \ \ \ \ \ \ \ \ \ \ \ GND}}
\DoxyCodeLine{00294\ \textcolor{comment}{//}}
\DoxyCodeLine{00295\ \textcolor{comment}{//\ vi\ \ \ -\/\ input}}
\DoxyCodeLine{00296\ \textcolor{comment}{//\ vo\ \ \ -\/\ output}}
\DoxyCodeLine{00297\ \textcolor{comment}{//\ Rext\ -\/\ external\ resistor,\ 1kOhm}}
\DoxyCodeLine{00298\ \textcolor{comment}{//}}
\DoxyCodeLine{00299\ \textcolor{comment}{//\ Notes:}}
\DoxyCodeLine{00300\ \textcolor{comment}{//}}
\DoxyCodeLine{00301\ \textcolor{comment}{//\ The\ external\ resistor\ Rext\ is\ needed\ to\ complete\ the\ NMOS\ voltage\ follower,}}
\DoxyCodeLine{00302\ \textcolor{comment}{//\ this\ resistor\ has\ a\ recommended\ value\ of\ 1kOhm.}}
\DoxyCodeLine{00303\ \textcolor{comment}{//}}
\DoxyCodeLine{00304\ \textcolor{comment}{//\ Die\ photographs\ show\ that\ actually,\ two\ NMOS\ transistors\ are\ used\ in\ the}}
\DoxyCodeLine{00305\ \textcolor{comment}{//\ voltage\ follower.\ However\ the\ two\ transistors\ are\ coupled\ in\ parallel\ (all}}
\DoxyCodeLine{00306\ \textcolor{comment}{//\ terminals\ are\ pairwise\ common),\ which\ implies\ that\ we\ can\ model\ the\ two}}
\DoxyCodeLine{00307\ \textcolor{comment}{//\ transistors\ as\ one.}}
\DoxyCodeLine{00308\ \textcolor{comment}{//}}
\DoxyCodeLine{00309\ \textcolor{comment}{//\ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{00310\ }
\DoxyCodeLine{00311\ \textcolor{comment}{//\ Compile-\/time\ computation\ of\ op-\/amp\ summer\ and\ mixer\ table\ offsets.}}
\DoxyCodeLine{00312\ }
\DoxyCodeLine{00313\ \textcolor{comment}{//\ The\ highpass\ summer\ has\ 2\ -\/\ 6\ inputs\ (bandpass,\ lowpass,\ and\ 0\ -\/\ 4\ voices).}}
\DoxyCodeLine{00314\ \textcolor{keyword}{template}<\textcolor{keywordtype}{int}\ i>}
\DoxyCodeLine{00315\ \textcolor{keyword}{struct\ }summer\_offset}
\DoxyCodeLine{00316\ \{}
\DoxyCodeLine{00317\ \ \ \textcolor{keyword}{enum}\ \{\ value\ =\ summer\_offset<i\ -\/\ 1>::value\ +\ ((2\ +\ i\ -\/\ 1)\ <<\ 16)\ \};}
\DoxyCodeLine{00318\ \};}
\DoxyCodeLine{00319\ }
\DoxyCodeLine{00320\ \textcolor{keyword}{template}<>}
\DoxyCodeLine{00321\ \textcolor{keyword}{struct\ }summer\_offset<0>}
\DoxyCodeLine{00322\ \{}
\DoxyCodeLine{00323\ \ \ \textcolor{keyword}{enum}\ \{\ value\ =\ 0\ \};}
\DoxyCodeLine{00324\ \};}
\DoxyCodeLine{00325\ }
\DoxyCodeLine{00326\ \textcolor{comment}{//\ The\ mixer\ has\ 0\ -\/\ 7\ inputs\ (0\ -\/\ 4\ voices\ and\ 0\ -\/\ 3\ filter\ outputs).}}
\DoxyCodeLine{00327\ \textcolor{keyword}{template}<\textcolor{keywordtype}{int}\ i>}
\DoxyCodeLine{00328\ \textcolor{keyword}{struct\ }mixer\_offset}
\DoxyCodeLine{00329\ \{}
\DoxyCodeLine{00330\ \ \ \textcolor{keyword}{enum}\ \{\ value\ =\ mixer\_offset<i\ -\/\ 1>::value\ +\ ((i\ -\/\ 1)\ <<\ 16)\ \};}
\DoxyCodeLine{00331\ \};}
\DoxyCodeLine{00332\ }
\DoxyCodeLine{00333\ \textcolor{keyword}{template}<>}
\DoxyCodeLine{00334\ \textcolor{keyword}{struct\ }mixer\_offset<1>}
\DoxyCodeLine{00335\ \{}
\DoxyCodeLine{00336\ \ \ \textcolor{keyword}{enum}\ \{\ value\ =\ 1\ \};}
\DoxyCodeLine{00337\ \};}
\DoxyCodeLine{00338\ }
\DoxyCodeLine{00339\ \textcolor{keyword}{template}<>}
\DoxyCodeLine{00340\ \textcolor{keyword}{struct\ }mixer\_offset<0>}
\DoxyCodeLine{00341\ \{}
\DoxyCodeLine{00342\ \ \ \textcolor{keyword}{enum}\ \{\ value\ =\ 0\ \};}
\DoxyCodeLine{00343\ \};}
\DoxyCodeLine{00344\ }
\DoxyCodeLine{00345\ }
\DoxyCodeLine{00346\ \textcolor{keyword}{class\ }Filter}
\DoxyCodeLine{00347\ \{}
\DoxyCodeLine{00348\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00349\ \ \ Filter();}
\DoxyCodeLine{00350\ }
\DoxyCodeLine{00351\ \ \ \textcolor{keywordtype}{void}\ enable\_filter(\textcolor{keywordtype}{bool}\ enable);}
\DoxyCodeLine{00352\ \ \ \textcolor{keywordtype}{void}\ adjust\_filter\_bias(\textcolor{keywordtype}{double}\ dac\_bias);}
\DoxyCodeLine{00353\ \ \ \textcolor{keywordtype}{void}\ set\_chip\_model(chip\_model\ model);}
\DoxyCodeLine{00354\ \ \ \textcolor{keywordtype}{void}\ set\_voice\_mask(reg4\ mask);}
\DoxyCodeLine{00355\ }
\DoxyCodeLine{00356\ \ \ \textcolor{keywordtype}{void}\ clock(\textcolor{keywordtype}{int}\ voice1,\ \textcolor{keywordtype}{int}\ voice2,\ \textcolor{keywordtype}{int}\ voice3);}
\DoxyCodeLine{00357\ \ \ \textcolor{keywordtype}{void}\ clock(cycle\_count\ delta\_t,\ \textcolor{keywordtype}{int}\ voice1,\ \textcolor{keywordtype}{int}\ voice2,\ \textcolor{keywordtype}{int}\ voice3);}
\DoxyCodeLine{00358\ \ \ \textcolor{keywordtype}{void}\ reset();}
\DoxyCodeLine{00359\ }
\DoxyCodeLine{00360\ \ \ \textcolor{comment}{//\ Write\ registers.}}
\DoxyCodeLine{00361\ \ \ \textcolor{keywordtype}{void}\ writeFC\_LO(reg8);}
\DoxyCodeLine{00362\ \ \ \textcolor{keywordtype}{void}\ writeFC\_HI(reg8);}
\DoxyCodeLine{00363\ \ \ \textcolor{keywordtype}{void}\ writeRES\_FILT(reg8);}
\DoxyCodeLine{00364\ \ \ \textcolor{keywordtype}{void}\ writeMODE\_VOL(reg8);}
\DoxyCodeLine{00365\ }
\DoxyCodeLine{00366\ \ \ \textcolor{comment}{//\ SID\ audio\ input\ (16\ bits).}}
\DoxyCodeLine{00367\ \ \ \textcolor{keywordtype}{void}\ input(\textcolor{keywordtype}{short}\ sample);}
\DoxyCodeLine{00368\ }
\DoxyCodeLine{00369\ \ \ \textcolor{comment}{//\ SID\ audio\ output\ (16\ bits).}}
\DoxyCodeLine{00370\ \ \ \textcolor{keywordtype}{short}\ output();}
\DoxyCodeLine{00371\ }
\DoxyCodeLine{00372\ \textcolor{keyword}{protected}:}
\DoxyCodeLine{00373\ \ \ \textcolor{keywordtype}{void}\ set\_sum\_mix();}
\DoxyCodeLine{00374\ \ \ \textcolor{keywordtype}{void}\ set\_w0();}
\DoxyCodeLine{00375\ \ \ \textcolor{keywordtype}{void}\ set\_Q();}
\DoxyCodeLine{00376\ }
\DoxyCodeLine{00377\ \ \ \textcolor{comment}{//\ Filter\ enabled.}}
\DoxyCodeLine{00378\ \ \ \textcolor{keywordtype}{bool}\ enabled;}
\DoxyCodeLine{00379\ }
\DoxyCodeLine{00380\ \ \ \textcolor{comment}{//\ Filter\ cutoff\ frequency.}}
\DoxyCodeLine{00381\ \ \ reg12\ fc;}
\DoxyCodeLine{00382\ }
\DoxyCodeLine{00383\ \ \ \textcolor{comment}{//\ Filter\ resonance.}}
\DoxyCodeLine{00384\ \ \ reg8\ res;}
\DoxyCodeLine{00385\ }
\DoxyCodeLine{00386\ \ \ \textcolor{comment}{//\ Selects\ which\ voices\ to\ route\ through\ the\ filter.}}
\DoxyCodeLine{00387\ \ \ reg8\ filt;}
\DoxyCodeLine{00388\ }
\DoxyCodeLine{00389\ \ \ \textcolor{comment}{//\ Selects\ which\ filter\ outputs\ to\ route\ into\ the\ mixer.}}
\DoxyCodeLine{00390\ \ \ reg4\ mode;}
\DoxyCodeLine{00391\ }
\DoxyCodeLine{00392\ \ \ \textcolor{comment}{//\ Output\ master\ volume.}}
\DoxyCodeLine{00393\ \ \ reg4\ vol;}
\DoxyCodeLine{00394\ }
\DoxyCodeLine{00395\ \ \ \textcolor{comment}{//\ Used\ to\ mask\ out\ EXT\ IN\ if\ not\ connected,\ and\ for\ test\ purposes}}
\DoxyCodeLine{00396\ \ \ \textcolor{comment}{//\ (voice\ muting).}}
\DoxyCodeLine{00397\ \ \ reg8\ voice\_mask;}
\DoxyCodeLine{00398\ }
\DoxyCodeLine{00399\ \ \ \textcolor{comment}{//\ Select\ which\ inputs\ to\ route\ into\ the\ summer\ /\ mixer.}}
\DoxyCodeLine{00400\ \ \ \textcolor{comment}{//\ These\ are\ derived\ from\ filt,\ mode,\ and\ voice\_mask.}}
\DoxyCodeLine{00401\ \ \ reg8\ sum;}
\DoxyCodeLine{00402\ \ \ reg8\ mix;}
\DoxyCodeLine{00403\ }
\DoxyCodeLine{00404\ \ \ \textcolor{comment}{//\ State\ of\ filter.}}
\DoxyCodeLine{00405\ \ \ \textcolor{keywordtype}{int}\ Vhp;\ \textcolor{comment}{//\ highpass}}
\DoxyCodeLine{00406\ \ \ \textcolor{keywordtype}{int}\ Vbp;\ \textcolor{comment}{//\ bandpass}}
\DoxyCodeLine{00407\ \ \ \textcolor{keywordtype}{int}\ Vbp\_x,\ Vbp\_vc;}
\DoxyCodeLine{00408\ \ \ \textcolor{keywordtype}{int}\ Vlp;\ \textcolor{comment}{//\ lowpass}}
\DoxyCodeLine{00409\ \ \ \textcolor{keywordtype}{int}\ Vlp\_x,\ Vlp\_vc;}
\DoxyCodeLine{00410\ \ \ \textcolor{comment}{//\ Filter\ /\ mixer\ inputs.}}
\DoxyCodeLine{00411\ \ \ \textcolor{keywordtype}{int}\ ve;}
\DoxyCodeLine{00412\ \ \ \textcolor{keywordtype}{int}\ v3;}
\DoxyCodeLine{00413\ \ \ \textcolor{keywordtype}{int}\ v2;}
\DoxyCodeLine{00414\ \ \ \textcolor{keywordtype}{int}\ v1;}
\DoxyCodeLine{00415\ }
\DoxyCodeLine{00416\ \ \ \textcolor{comment}{//\ Cutoff\ frequency\ DAC\ voltage,\ resonance.}}
\DoxyCodeLine{00417\ \ \ \textcolor{keywordtype}{int}\ Vddt\_Vw\_2,\ Vw\_bias;}
\DoxyCodeLine{00418\ \ \ \textcolor{keywordtype}{int}\ \_8\_div\_Q;}
\DoxyCodeLine{00419\ \ \ \textcolor{comment}{//\ FIXME:\ Temporarily\ used\ for\ MOS\ 8580\ emulation.}}
\DoxyCodeLine{00420\ \ \ \textcolor{keywordtype}{int}\ w0;}
\DoxyCodeLine{00421\ \ \ \textcolor{keywordtype}{int}\ \_1024\_div\_Q;}
\DoxyCodeLine{00422\ }
\DoxyCodeLine{00423\ \ \ chip\_model\ sid\_model;}
\DoxyCodeLine{00424\ }
\DoxyCodeLine{00425\ \ \ \ \textcolor{keyword}{typedef}\ \textcolor{keyword}{struct\ }\{}
\DoxyCodeLine{00426\ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{short}\ vx;}
\DoxyCodeLine{00427\ \ \ \ \ \textcolor{keywordtype}{short}\ dvx;}
\DoxyCodeLine{00428\ \ \ \}\ opamp\_t;}
\DoxyCodeLine{00429\ }
\DoxyCodeLine{00430\ \ \ \textcolor{keyword}{typedef}\ \textcolor{keyword}{struct\ }\{}
\DoxyCodeLine{00431\ \ \ \ \ \textcolor{keywordtype}{int}\ vo\_N16;\ \ \textcolor{comment}{//\ Fixed\ point\ scaling\ for\ 16\ bit\ op-\/amp\ output.}}
\DoxyCodeLine{00432\ \ \ \ \ \textcolor{keywordtype}{int}\ kVddt;\ \ \ \textcolor{comment}{//\ K*(Vdd\ -\/\ Vth)}}
\DoxyCodeLine{00433\ \ \ \ \ \textcolor{keywordtype}{int}\ n\_snake;}
\DoxyCodeLine{00434\ \ \ \ \ \textcolor{keywordtype}{int}\ voice\_scale\_s14;}
\DoxyCodeLine{00435\ \ \ \ \ \textcolor{keywordtype}{int}\ voice\_DC;}
\DoxyCodeLine{00436\ \ \ \ \ \textcolor{keywordtype}{int}\ ak;}
\DoxyCodeLine{00437\ \ \ \ \ \textcolor{keywordtype}{int}\ bk;}
\DoxyCodeLine{00438\ \ \ \ \ \textcolor{keywordtype}{int}\ vc\_min;}
\DoxyCodeLine{00439\ \ \ \ \ \textcolor{keywordtype}{int}\ vc\_max;}
\DoxyCodeLine{00440\ }
\DoxyCodeLine{00441\ \ \ \ \ \textcolor{comment}{//\ Reverse\ op-\/amp\ transfer\ function.}}
\DoxyCodeLine{00442\ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{short}\ opamp\_rev[1\ <<\ 16];}
\DoxyCodeLine{00443\ \ \ \ \ \textcolor{comment}{//\ Lookup\ tables\ for\ gain\ and\ summer\ op-\/amps\ in\ output\ stage\ /\ filter.}}
\DoxyCodeLine{00444\ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{short}\ summer[summer\_offset<5>::value];}
\DoxyCodeLine{00445\ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{short}\ gain[16][1\ <<\ 16];}
\DoxyCodeLine{00446\ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{short}\ mixer[mixer\_offset<8>::value];}
\DoxyCodeLine{00447\ \ \ \ \ \textcolor{comment}{//\ Cutoff\ frequency\ DAC\ output\ voltage\ table.\ FC\ is\ an\ 11\ bit\ register.}}
\DoxyCodeLine{00448\ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{short}\ f0\_dac[1\ <<\ 11];}
\DoxyCodeLine{00449\ \ \ \}\ model\_filter\_t;}
\DoxyCodeLine{00450\ }
\DoxyCodeLine{00451\ \ \ \textcolor{keywordtype}{int}\ solve\_gain(opamp\_t*\ opamp,\ \textcolor{keywordtype}{int}\ n,\ \textcolor{keywordtype}{int}\ vi\_t,\ \textcolor{keywordtype}{int}\&\ x,\ model\_filter\_t\&\ mf);}
\DoxyCodeLine{00452\ \ \ \textcolor{keywordtype}{int}\ solve\_integrate\_6581(\textcolor{keywordtype}{int}\ dt,\ \textcolor{keywordtype}{int}\ vi\_t,\ \textcolor{keywordtype}{int}\&\ x,\ \textcolor{keywordtype}{int}\&\ vc,\ model\_filter\_t\&\ mf);}
\DoxyCodeLine{00453\ }
\DoxyCodeLine{00454\ \ \ \textcolor{comment}{//\ VCR\ -\/\ 6581\ only.}}
\DoxyCodeLine{00455\ \ \ \textcolor{keyword}{static}\ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{short}\ vcr\_kVg[1\ <<\ 16];}
\DoxyCodeLine{00456\ \ \ \textcolor{keyword}{static}\ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{short}\ vcr\_n\_Ids\_term[1\ <<\ 16];}
\DoxyCodeLine{00457\ \ \ \textcolor{comment}{//\ Common\ parameters.}}
\DoxyCodeLine{00458\ \ \ \textcolor{keyword}{static}\ model\_filter\_t\ model\_filter[2];}
\DoxyCodeLine{00459\ }
\DoxyCodeLine{00460\ \textcolor{keyword}{friend}\ \textcolor{keyword}{class\ }SID;}
\DoxyCodeLine{00461\ \};}
\DoxyCodeLine{00462\ }
\DoxyCodeLine{00463\ }
\DoxyCodeLine{00464\ \textcolor{comment}{//\ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{00465\ \textcolor{comment}{//\ Inline\ functions.}}
\DoxyCodeLine{00466\ \textcolor{comment}{//\ The\ following\ functions\ are\ defined\ inline\ because\ they\ are\ called\ every}}
\DoxyCodeLine{00467\ \textcolor{comment}{//\ time\ a\ sample\ is\ calculated.}}
\DoxyCodeLine{00468\ \textcolor{comment}{//\ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{00469\ }
\DoxyCodeLine{00470\ \textcolor{preprocessor}{\#if\ RESID\_INLINING\ ||\ defined(RESID\_FILTER\_CC)}}
\DoxyCodeLine{00471\ }
\DoxyCodeLine{00472\ \textcolor{comment}{//\ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{00473\ \textcolor{comment}{//\ SID\ clocking\ -\/\ 1\ cycle.}}
\DoxyCodeLine{00474\ \textcolor{comment}{//\ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{00475\ RESID\_INLINE}
\DoxyCodeLine{00476\ \textcolor{keywordtype}{void}\ Filter::clock(\textcolor{keywordtype}{int}\ voice1,\ \textcolor{keywordtype}{int}\ voice2,\ \textcolor{keywordtype}{int}\ voice3)}
\DoxyCodeLine{00477\ \{}
\DoxyCodeLine{00478\ \ \ model\_filter\_t\&\ f\ =\ model\_filter[sid\_model];}
\DoxyCodeLine{00479\ }
\DoxyCodeLine{00480\ \ \ v1\ =\ (voice1*f.voice\_scale\_s14\ >>\ 18)\ +\ f.voice\_DC;}
\DoxyCodeLine{00481\ \ \ v2\ =\ (voice2*f.voice\_scale\_s14\ >>\ 18)\ +\ f.voice\_DC;}
\DoxyCodeLine{00482\ \ \ v3\ =\ (voice3*f.voice\_scale\_s14\ >>\ 18)\ +\ f.voice\_DC;}
\DoxyCodeLine{00483\ }
\DoxyCodeLine{00484\ \ \ \textcolor{comment}{//\ Sum\ inputs\ routed\ into\ the\ filter.}}
\DoxyCodeLine{00485\ \ \ \textcolor{keywordtype}{int}\ Vi\ =\ 0;}
\DoxyCodeLine{00486\ \ \ \textcolor{keywordtype}{int}\ offset\ =\ 0;}
\DoxyCodeLine{00487\ }
\DoxyCodeLine{00488\ \ \ \textcolor{keywordflow}{switch}\ (sum\ \&\ 0xf)\ \{}
\DoxyCodeLine{00489\ \ \ \textcolor{keywordflow}{case}\ 0x0:}
\DoxyCodeLine{00490\ \ \ \ \ Vi\ =\ 0;}
\DoxyCodeLine{00491\ \ \ \ \ offset\ =\ summer\_offset<0>::value;}
\DoxyCodeLine{00492\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00493\ \ \ \textcolor{keywordflow}{case}\ 0x1:}
\DoxyCodeLine{00494\ \ \ \ \ Vi\ =\ v1;}
\DoxyCodeLine{00495\ \ \ \ \ offset\ =\ summer\_offset<1>::value;}
\DoxyCodeLine{00496\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00497\ \ \ \textcolor{keywordflow}{case}\ 0x2:}
\DoxyCodeLine{00498\ \ \ \ \ Vi\ =\ v2;}
\DoxyCodeLine{00499\ \ \ \ \ offset\ =\ summer\_offset<1>::value;}
\DoxyCodeLine{00500\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00501\ \ \ \textcolor{keywordflow}{case}\ 0x3:}
\DoxyCodeLine{00502\ \ \ \ \ Vi\ =\ v2\ +\ v1;}
\DoxyCodeLine{00503\ \ \ \ \ offset\ =\ summer\_offset<2>::value;}
\DoxyCodeLine{00504\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00505\ \ \ \textcolor{keywordflow}{case}\ 0x4:}
\DoxyCodeLine{00506\ \ \ \ \ Vi\ =\ v3;}
\DoxyCodeLine{00507\ \ \ \ \ offset\ =\ summer\_offset<1>::value;}
\DoxyCodeLine{00508\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00509\ \ \ \textcolor{keywordflow}{case}\ 0x5:}
\DoxyCodeLine{00510\ \ \ \ \ Vi\ =\ v3\ +\ v1;}
\DoxyCodeLine{00511\ \ \ \ \ offset\ =\ summer\_offset<2>::value;}
\DoxyCodeLine{00512\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00513\ \ \ \textcolor{keywordflow}{case}\ 0x6:}
\DoxyCodeLine{00514\ \ \ \ \ Vi\ =\ v3\ +\ v2;}
\DoxyCodeLine{00515\ \ \ \ \ offset\ =\ summer\_offset<2>::value;}
\DoxyCodeLine{00516\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00517\ \ \ \textcolor{keywordflow}{case}\ 0x7:}
\DoxyCodeLine{00518\ \ \ \ \ Vi\ =\ v3\ +\ v2\ +\ v1;}
\DoxyCodeLine{00519\ \ \ \ \ offset\ =\ summer\_offset<3>::value;}
\DoxyCodeLine{00520\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00521\ \ \ \textcolor{keywordflow}{case}\ 0x8:}
\DoxyCodeLine{00522\ \ \ \ \ Vi\ =\ ve;}
\DoxyCodeLine{00523\ \ \ \ \ offset\ =\ summer\_offset<1>::value;}
\DoxyCodeLine{00524\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00525\ \ \ \textcolor{keywordflow}{case}\ 0x9:}
\DoxyCodeLine{00526\ \ \ \ \ Vi\ =\ ve\ +\ v1;}
\DoxyCodeLine{00527\ \ \ \ \ offset\ =\ summer\_offset<2>::value;}
\DoxyCodeLine{00528\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00529\ \ \ \textcolor{keywordflow}{case}\ 0xa:}
\DoxyCodeLine{00530\ \ \ \ \ Vi\ =\ ve\ +\ v2;}
\DoxyCodeLine{00531\ \ \ \ \ offset\ =\ summer\_offset<2>::value;}
\DoxyCodeLine{00532\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00533\ \ \ \textcolor{keywordflow}{case}\ 0xb:}
\DoxyCodeLine{00534\ \ \ \ \ Vi\ =\ ve\ +\ v2\ +\ v1;}
\DoxyCodeLine{00535\ \ \ \ \ offset\ =\ summer\_offset<3>::value;}
\DoxyCodeLine{00536\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00537\ \ \ \textcolor{keywordflow}{case}\ 0xc:}
\DoxyCodeLine{00538\ \ \ \ \ Vi\ =\ ve\ +\ v3;}
\DoxyCodeLine{00539\ \ \ \ \ offset\ =\ summer\_offset<2>::value;}
\DoxyCodeLine{00540\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00541\ \ \ \textcolor{keywordflow}{case}\ 0xd:}
\DoxyCodeLine{00542\ \ \ \ \ Vi\ =\ ve\ +\ v3\ +\ v1;}
\DoxyCodeLine{00543\ \ \ \ \ offset\ =\ summer\_offset<3>::value;}
\DoxyCodeLine{00544\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00545\ \ \ \textcolor{keywordflow}{case}\ 0xe:}
\DoxyCodeLine{00546\ \ \ \ \ Vi\ =\ ve\ +\ v3\ +\ v2;}
\DoxyCodeLine{00547\ \ \ \ \ offset\ =\ summer\_offset<3>::value;}
\DoxyCodeLine{00548\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00549\ \ \ \textcolor{keywordflow}{case}\ 0xf:}
\DoxyCodeLine{00550\ \ \ \ \ Vi\ =\ ve\ +\ v3\ +\ v2\ +\ v1;}
\DoxyCodeLine{00551\ \ \ \ \ offset\ =\ summer\_offset<4>::value;}
\DoxyCodeLine{00552\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00553\ \ \ \}}
\DoxyCodeLine{00554\ }
\DoxyCodeLine{00555\ \ \ \textcolor{comment}{//\ Calculate\ filter\ outputs.}}
\DoxyCodeLine{00556\ \ \ \textcolor{keywordflow}{if}\ (sid\_model\ ==\ 0)\ \{}
\DoxyCodeLine{00557\ \ \ \ \ \textcolor{comment}{//\ MOS\ 6581.}}
\DoxyCodeLine{00558\ \ \ \ \ Vlp\ =\ solve\_integrate\_6581(1,\ Vbp,\ Vlp\_x,\ Vlp\_vc,\ f);}
\DoxyCodeLine{00559\ \ \ \ \ Vbp\ =\ solve\_integrate\_6581(1,\ Vhp,\ Vbp\_x,\ Vbp\_vc,\ f);}
\DoxyCodeLine{00560\ \ \ \ \ Vhp\ =\ f.summer[offset\ +\ f.gain[\_8\_div\_Q][Vbp]\ +\ Vlp\ +\ Vi];}
\DoxyCodeLine{00561\ \ \ \}}
\DoxyCodeLine{00562\ \ \ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00563\ \ \ \ \ \textcolor{comment}{//\ MOS\ 8580.\ FIXME:\ Not\ yet\ using\ op-\/amp\ model.}}
\DoxyCodeLine{00564\ }
\DoxyCodeLine{00565\ \ \ \ \ \textcolor{comment}{//\ delta\_t\ =\ 1\ is\ converted\ to\ seconds\ given\ a\ 1MHz\ clock\ by\ dividing}}
\DoxyCodeLine{00566\ \ \ \ \ \textcolor{comment}{//\ with\ 1\ 000\ 000.}}
\DoxyCodeLine{00567\ }
\DoxyCodeLine{00568\ \ \ \ \ \textcolor{keywordtype}{int}\ dVbp\ =\ w0*(Vhp\ >>\ 4)\ >>\ 16;}
\DoxyCodeLine{00569\ \ \ \ \ \textcolor{keywordtype}{int}\ dVlp\ =\ w0*(Vbp\ >>\ 4)\ >>\ 16;}
\DoxyCodeLine{00570\ \ \ \ \ Vbp\ -\/=\ dVbp;}
\DoxyCodeLine{00571\ \ \ \ \ Vlp\ -\/=\ dVlp;}
\DoxyCodeLine{00572\ \ \ \ \ Vhp\ =\ (Vbp*\_1024\_div\_Q\ >>\ 10)\ -\/\ Vlp\ -\/\ Vi;}
\DoxyCodeLine{00573\ \ \ \}}
\DoxyCodeLine{00574\ \}}
\DoxyCodeLine{00575\ }
\DoxyCodeLine{00576\ \textcolor{comment}{//\ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{00577\ \textcolor{comment}{//\ SID\ clocking\ -\/\ delta\_t\ cycles.}}
\DoxyCodeLine{00578\ \textcolor{comment}{//\ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{00579\ RESID\_INLINE}
\DoxyCodeLine{00580\ \textcolor{keywordtype}{void}\ Filter::clock(cycle\_count\ delta\_t,\ \textcolor{keywordtype}{int}\ voice1,\ \textcolor{keywordtype}{int}\ voice2,\ \textcolor{keywordtype}{int}\ voice3)}
\DoxyCodeLine{00581\ \{}
\DoxyCodeLine{00582\ \ \ model\_filter\_t\&\ f\ =\ model\_filter[sid\_model];}
\DoxyCodeLine{00583\ }
\DoxyCodeLine{00584\ \ \ v1\ =\ (voice1*f.voice\_scale\_s14\ >>\ 18)\ +\ f.voice\_DC;}
\DoxyCodeLine{00585\ \ \ v2\ =\ (voice2*f.voice\_scale\_s14\ >>\ 18)\ +\ f.voice\_DC;}
\DoxyCodeLine{00586\ \ \ v3\ =\ (voice3*f.voice\_scale\_s14\ >>\ 18)\ +\ f.voice\_DC;}
\DoxyCodeLine{00587\ }
\DoxyCodeLine{00588\ \ \ \textcolor{comment}{//\ Enable\ filter\ on/off.}}
\DoxyCodeLine{00589\ \ \ \textcolor{comment}{//\ This\ is\ not\ really\ part\ of\ SID,\ but\ is\ useful\ for\ testing.}}
\DoxyCodeLine{00590\ \ \ \textcolor{comment}{//\ On\ slow\ CPUs\ it\ may\ be\ necessary\ to\ bypass\ the\ filter\ to\ lower\ the\ CPU}}
\DoxyCodeLine{00591\ \ \ \textcolor{comment}{//\ load.}}
\DoxyCodeLine{00592\ \ \ \textcolor{keywordflow}{if}\ (unlikely(!enabled))\ \{}
\DoxyCodeLine{00593\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00594\ \ \ \}}
\DoxyCodeLine{00595\ }
\DoxyCodeLine{00596\ \ \ \textcolor{comment}{//\ Sum\ inputs\ routed\ into\ the\ filter.}}
\DoxyCodeLine{00597\ \ \ \textcolor{keywordtype}{int}\ Vi\ =\ 0;}
\DoxyCodeLine{00598\ \ \ \textcolor{keywordtype}{int}\ offset\ =\ 0;}
\DoxyCodeLine{00599\ }
\DoxyCodeLine{00600\ \ \ \textcolor{keywordflow}{switch}\ (sum\ \&\ 0xf)\ \{}
\DoxyCodeLine{00601\ \ \ \textcolor{keywordflow}{case}\ 0x0:}
\DoxyCodeLine{00602\ \ \ \ \ Vi\ =\ 0;}
\DoxyCodeLine{00603\ \ \ \ \ offset\ =\ summer\_offset<0>::value;}
\DoxyCodeLine{00604\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00605\ \ \ \textcolor{keywordflow}{case}\ 0x1:}
\DoxyCodeLine{00606\ \ \ \ \ Vi\ =\ v1;}
\DoxyCodeLine{00607\ \ \ \ \ offset\ =\ summer\_offset<1>::value;}
\DoxyCodeLine{00608\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00609\ \ \ \textcolor{keywordflow}{case}\ 0x2:}
\DoxyCodeLine{00610\ \ \ \ \ Vi\ =\ v2;}
\DoxyCodeLine{00611\ \ \ \ \ offset\ =\ summer\_offset<1>::value;}
\DoxyCodeLine{00612\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00613\ \ \ \textcolor{keywordflow}{case}\ 0x3:}
\DoxyCodeLine{00614\ \ \ \ \ Vi\ =\ v2\ +\ v1;}
\DoxyCodeLine{00615\ \ \ \ \ offset\ =\ summer\_offset<2>::value;}
\DoxyCodeLine{00616\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00617\ \ \ \textcolor{keywordflow}{case}\ 0x4:}
\DoxyCodeLine{00618\ \ \ \ \ Vi\ =\ v3;}
\DoxyCodeLine{00619\ \ \ \ \ offset\ =\ summer\_offset<1>::value;}
\DoxyCodeLine{00620\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00621\ \ \ \textcolor{keywordflow}{case}\ 0x5:}
\DoxyCodeLine{00622\ \ \ \ \ Vi\ =\ v3\ +\ v1;}
\DoxyCodeLine{00623\ \ \ \ \ offset\ =\ summer\_offset<2>::value;}
\DoxyCodeLine{00624\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00625\ \ \ \textcolor{keywordflow}{case}\ 0x6:}
\DoxyCodeLine{00626\ \ \ \ \ Vi\ =\ v3\ +\ v2;}
\DoxyCodeLine{00627\ \ \ \ \ offset\ =\ summer\_offset<2>::value;}
\DoxyCodeLine{00628\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00629\ \ \ \textcolor{keywordflow}{case}\ 0x7:}
\DoxyCodeLine{00630\ \ \ \ \ Vi\ =\ v3\ +\ v2\ +\ v1;}
\DoxyCodeLine{00631\ \ \ \ \ offset\ =\ summer\_offset<3>::value;}
\DoxyCodeLine{00632\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00633\ \ \ \textcolor{keywordflow}{case}\ 0x8:}
\DoxyCodeLine{00634\ \ \ \ \ Vi\ =\ ve;}
\DoxyCodeLine{00635\ \ \ \ \ offset\ =\ summer\_offset<1>::value;}
\DoxyCodeLine{00636\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00637\ \ \ \textcolor{keywordflow}{case}\ 0x9:}
\DoxyCodeLine{00638\ \ \ \ \ Vi\ =\ ve\ +\ v1;}
\DoxyCodeLine{00639\ \ \ \ \ offset\ =\ summer\_offset<2>::value;}
\DoxyCodeLine{00640\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00641\ \ \ \textcolor{keywordflow}{case}\ 0xa:}
\DoxyCodeLine{00642\ \ \ \ \ Vi\ =\ ve\ +\ v2;}
\DoxyCodeLine{00643\ \ \ \ \ offset\ =\ summer\_offset<2>::value;}
\DoxyCodeLine{00644\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00645\ \ \ \textcolor{keywordflow}{case}\ 0xb:}
\DoxyCodeLine{00646\ \ \ \ \ Vi\ =\ ve\ +\ v2\ +\ v1;}
\DoxyCodeLine{00647\ \ \ \ \ offset\ =\ summer\_offset<3>::value;}
\DoxyCodeLine{00648\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00649\ \ \ \textcolor{keywordflow}{case}\ 0xc:}
\DoxyCodeLine{00650\ \ \ \ \ Vi\ =\ ve\ +\ v3;}
\DoxyCodeLine{00651\ \ \ \ \ offset\ =\ summer\_offset<2>::value;}
\DoxyCodeLine{00652\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00653\ \ \ \textcolor{keywordflow}{case}\ 0xd:}
\DoxyCodeLine{00654\ \ \ \ \ Vi\ =\ ve\ +\ v3\ +\ v1;}
\DoxyCodeLine{00655\ \ \ \ \ offset\ =\ summer\_offset<3>::value;}
\DoxyCodeLine{00656\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00657\ \ \ \textcolor{keywordflow}{case}\ 0xe:}
\DoxyCodeLine{00658\ \ \ \ \ Vi\ =\ ve\ +\ v3\ +\ v2;}
\DoxyCodeLine{00659\ \ \ \ \ offset\ =\ summer\_offset<3>::value;}
\DoxyCodeLine{00660\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00661\ \ \ \textcolor{keywordflow}{case}\ 0xf:}
\DoxyCodeLine{00662\ \ \ \ \ Vi\ =\ ve\ +\ v3\ +\ v2\ +\ v1;}
\DoxyCodeLine{00663\ \ \ \ \ offset\ =\ summer\_offset<4>::value;}
\DoxyCodeLine{00664\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00665\ \ \ \}}
\DoxyCodeLine{00666\ }
\DoxyCodeLine{00667\ \ \ \textcolor{comment}{//\ Maximum\ delta\ cycles\ for\ filter\ fixpoint\ iteration\ to\ converge}}
\DoxyCodeLine{00668\ \ \ \textcolor{comment}{//\ is\ approximately\ 3.}}
\DoxyCodeLine{00669\ \ \ cycle\_count\ delta\_t\_flt\ =\ 3;}
\DoxyCodeLine{00670\ }
\DoxyCodeLine{00671\ \ \ \textcolor{keywordflow}{if}\ (sid\_model\ ==\ 0)\ \{}
\DoxyCodeLine{00672\ \ \ \ \ \textcolor{comment}{//\ MOS\ 6581.}}
\DoxyCodeLine{00673\ \ \ \ \ \textcolor{keywordflow}{while}\ (delta\_t)\ \{}
\DoxyCodeLine{00674\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (unlikely(delta\_t\ <\ delta\_t\_flt))\ \{}
\DoxyCodeLine{00675\ \ \ \ \ \ \ \ \ delta\_t\_flt\ =\ delta\_t;}
\DoxyCodeLine{00676\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00677\ }
\DoxyCodeLine{00678\ \ \ \ \ \ \ \textcolor{comment}{//\ Calculate\ filter\ outputs.}}
\DoxyCodeLine{00679\ \ \ \ \ \ \ Vlp\ =\ solve\_integrate\_6581(delta\_t\_flt,\ Vbp,\ Vlp\_x,\ Vlp\_vc,\ f);}
\DoxyCodeLine{00680\ \ \ \ \ \ \ Vbp\ =\ solve\_integrate\_6581(delta\_t\_flt,\ Vhp,\ Vbp\_x,\ Vbp\_vc,\ f);}
\DoxyCodeLine{00681\ \ \ \ \ \ \ Vhp\ =\ f.summer[offset\ +\ f.gain[\_8\_div\_Q][Vbp]\ +\ Vlp\ +\ Vi];}
\DoxyCodeLine{00682\ }
\DoxyCodeLine{00683\ \ \ \ \ \ \ delta\_t\ -\/=\ delta\_t\_flt;}
\DoxyCodeLine{00684\ \ \ \ \ \}}
\DoxyCodeLine{00685\ \ \ \}}
\DoxyCodeLine{00686\ \ \ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00687\ \ \ \ \ \textcolor{comment}{//\ MOS\ 8580.\ FIXME:\ Not\ yet\ using\ op-\/amp\ model.}}
\DoxyCodeLine{00688\ \ \ \ \ \textcolor{keywordflow}{while}\ (delta\_t)\ \{}
\DoxyCodeLine{00689\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (delta\_t\ <\ delta\_t\_flt)\ \{}
\DoxyCodeLine{00690\ \ \ \ \ \ \ \ \ delta\_t\_flt\ =\ delta\_t;}
\DoxyCodeLine{00691\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00692\ }
\DoxyCodeLine{00693\ \ \ \ \ \ \ \textcolor{comment}{//\ delta\_t\ is\ converted\ to\ seconds\ given\ a\ 1MHz\ clock\ by\ dividing}}
\DoxyCodeLine{00694\ \ \ \ \ \ \ \textcolor{comment}{//\ with\ 1\ 000\ 000.\ This\ is\ done\ in\ two\ operations\ to\ avoid\ integer}}
\DoxyCodeLine{00695\ \ \ \ \ \ \ \textcolor{comment}{//\ multiplication\ overflow.}}
\DoxyCodeLine{00696\ }
\DoxyCodeLine{00697\ \ \ \ \ \ \ \textcolor{comment}{//\ Calculate\ filter\ outputs.}}
\DoxyCodeLine{00698\ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ w0\_delta\_t\ =\ w0*delta\_t\_flt\ >>\ 2;}
\DoxyCodeLine{00699\ }
\DoxyCodeLine{00700\ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ dVbp\ =\ w0\_delta\_t*(Vhp\ >>\ 4)\ >>\ 14;}
\DoxyCodeLine{00701\ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ dVlp\ =\ w0\_delta\_t*(Vbp\ >>\ 4)\ >>\ 14;}
\DoxyCodeLine{00702\ \ \ \ \ \ \ Vbp\ -\/=\ dVbp;}
\DoxyCodeLine{00703\ \ \ \ \ \ \ Vlp\ -\/=\ dVlp;}
\DoxyCodeLine{00704\ \ \ \ \ \ \ Vhp\ =\ (Vbp*\_1024\_div\_Q\ >>\ 10)\ -\/\ Vlp\ -\/\ Vi;}
\DoxyCodeLine{00705\ }
\DoxyCodeLine{00706\ \ \ \ \ \ \ delta\_t\ -\/=\ delta\_t\_flt;}
\DoxyCodeLine{00707\ \ \ \ \ \}}
\DoxyCodeLine{00708\ \ \ \}}
\DoxyCodeLine{00709\ \}}
\DoxyCodeLine{00710\ }
\DoxyCodeLine{00711\ }
\DoxyCodeLine{00712\ \textcolor{comment}{//\ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{00713\ \textcolor{comment}{//\ SID\ audio\ input\ (16\ bits).}}
\DoxyCodeLine{00714\ \textcolor{comment}{//\ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{00715\ RESID\_INLINE}
\DoxyCodeLine{00716\ \textcolor{keywordtype}{void}\ Filter::input(\textcolor{keywordtype}{short}\ sample)}
\DoxyCodeLine{00717\ \{}
\DoxyCodeLine{00718\ \ \ \textcolor{comment}{//\ Scale\ to\ three\ times\ the\ peak-\/to-\/peak\ for\ one\ voice\ and\ add\ the\ op-\/amp}}
\DoxyCodeLine{00719\ \ \ \textcolor{comment}{//\ "{}zero"{}\ DC\ level.}}
\DoxyCodeLine{00720\ \ \ \textcolor{comment}{//\ NB!\ Adding\ the\ op-\/amp\ "{}zero"{}\ DC\ level\ is\ a\ (wildly\ inaccurate)}}
\DoxyCodeLine{00721\ \ \ \textcolor{comment}{//\ approximation\ of\ feeding\ the\ input\ through\ an\ AC\ coupling\ capacitor.}}
\DoxyCodeLine{00722\ \ \ \textcolor{comment}{//\ This\ could\ be\ implemented\ as\ a\ separate\ filter\ circuit,\ however\ the}}
\DoxyCodeLine{00723\ \ \ \textcolor{comment}{//\ primary\ use\ of\ the\ emulator\ is\ not\ to\ process\ external\ signals.}}
\DoxyCodeLine{00724\ \ \ \textcolor{comment}{//\ The\ upside\ is\ that\ the\ MOS8580\ "{}digi\ boost"{}\ works\ without\ a\ separate\ (DC)}}
\DoxyCodeLine{00725\ \ \ \textcolor{comment}{//\ input\ interface.}}
\DoxyCodeLine{00726\ \ \ \textcolor{comment}{//\ Note\ that\ the\ input\ is\ 16\ bits,\ compared\ to\ the\ 20\ bit\ voice\ output.}}
\DoxyCodeLine{00727\ \ \ model\_filter\_t\&\ f\ =\ model\_filter[sid\_model];}
\DoxyCodeLine{00728\ \ \ ve\ =\ (sample*f.voice\_scale\_s14*3\ >>\ 14)\ +\ f.mixer[0];}
\DoxyCodeLine{00729\ \}}
\DoxyCodeLine{00730\ }
\DoxyCodeLine{00731\ }
\DoxyCodeLine{00732\ \textcolor{comment}{//\ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{00733\ \textcolor{comment}{//\ SID\ audio\ output\ (16\ bits).}}
\DoxyCodeLine{00734\ \textcolor{comment}{//\ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{00735\ RESID\_INLINE}
\DoxyCodeLine{00736\ \textcolor{keywordtype}{short}\ Filter::output()}
\DoxyCodeLine{00737\ \{}
\DoxyCodeLine{00738\ \ \ model\_filter\_t\&\ f\ =\ model\_filter[sid\_model];}
\DoxyCodeLine{00739\ }
\DoxyCodeLine{00740\ \ \ \textcolor{comment}{//\ Writing\ the\ switch\ below\ manually\ would\ be\ tedious\ and\ error-\/prone;}}
\DoxyCodeLine{00741\ \ \ \textcolor{comment}{//\ it\ is\ rather\ generated\ by\ the\ following\ Perl\ program:}}
\DoxyCodeLine{00742\ }
\DoxyCodeLine{00743\ \ \ \textcolor{comment}{/*}}
\DoxyCodeLine{00744\ \textcolor{comment}{my\ @i\ =\ qw(v1\ v2\ v3\ ve\ Vlp\ Vbp\ Vhp);}}
\DoxyCodeLine{00745\ \textcolor{comment}{for\ my\ \$mix\ (0..2**@i-\/1)\ \{}}
\DoxyCodeLine{00746\ \textcolor{comment}{\ \ \ \ print\ sprintf("{}\ \ case\ 0x\%02x:\(\backslash\)n"{},\ \$mix);}}
\DoxyCodeLine{00747\ \textcolor{comment}{\ \ \ \ my\ @sum;}}
\DoxyCodeLine{00748\ \textcolor{comment}{\ \ \ \ for\ (@i)\ \{}}
\DoxyCodeLine{00749\ \textcolor{comment}{\ \ \ \ \ \ \ \ unshift(@sum,\ \$\_)\ if\ \$mix\ \&\ 0x01;}}
\DoxyCodeLine{00750\ \textcolor{comment}{\ \ \ \ \ \ \ \ \$mix\ >>=\ 1;}}
\DoxyCodeLine{00751\ \textcolor{comment}{\ \ \ \ \}}}
\DoxyCodeLine{00752\ \textcolor{comment}{\ \ \ \ my\ \$sum\ =\ join("{}\ +\ "{},\ @sum)\ ||\ "{}0"{};}}
\DoxyCodeLine{00753\ \textcolor{comment}{\ \ \ \ print\ "{}\ \ \ \ Vi\ =\ \$sum;\(\backslash\)n"{};}}
\DoxyCodeLine{00754\ \textcolor{comment}{\ \ \ \ print\ "{}\ \ \ \ offset\ =\ mixer\_offset<"{}\ .\ @sum\ .\ "{}>::value;\(\backslash\)n"{};}}
\DoxyCodeLine{00755\ \textcolor{comment}{\ \ \ \ print\ "{}\ \ \ \ break;\(\backslash\)n"{};}}
\DoxyCodeLine{00756\ \textcolor{comment}{\}}}
\DoxyCodeLine{00757\ \textcolor{comment}{\ \ */}}
\DoxyCodeLine{00758\ }
\DoxyCodeLine{00759\ \ \ \textcolor{comment}{//\ Sum\ inputs\ routed\ into\ the\ mixer.}}
\DoxyCodeLine{00760\ \ \ \textcolor{keywordtype}{int}\ Vi\ =\ 0;}
\DoxyCodeLine{00761\ \ \ \textcolor{keywordtype}{int}\ offset\ =\ 0;}
\DoxyCodeLine{00762\ }
\DoxyCodeLine{00763\ \ \ \textcolor{keywordflow}{switch}\ (mix\ \&\ 0x7f)\ \{}
\DoxyCodeLine{00764\ \ \ \textcolor{keywordflow}{case}\ 0x00:}
\DoxyCodeLine{00765\ \ \ \ \ Vi\ =\ 0;}
\DoxyCodeLine{00766\ \ \ \ \ offset\ =\ mixer\_offset<0>::value;}
\DoxyCodeLine{00767\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00768\ \ \ \textcolor{keywordflow}{case}\ 0x01:}
\DoxyCodeLine{00769\ \ \ \ \ Vi\ =\ v1;}
\DoxyCodeLine{00770\ \ \ \ \ offset\ =\ mixer\_offset<1>::value;}
\DoxyCodeLine{00771\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00772\ \ \ \textcolor{keywordflow}{case}\ 0x02:}
\DoxyCodeLine{00773\ \ \ \ \ Vi\ =\ v2;}
\DoxyCodeLine{00774\ \ \ \ \ offset\ =\ mixer\_offset<1>::value;}
\DoxyCodeLine{00775\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00776\ \ \ \textcolor{keywordflow}{case}\ 0x03:}
\DoxyCodeLine{00777\ \ \ \ \ Vi\ =\ v2\ +\ v1;}
\DoxyCodeLine{00778\ \ \ \ \ offset\ =\ mixer\_offset<2>::value;}
\DoxyCodeLine{00779\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00780\ \ \ \textcolor{keywordflow}{case}\ 0x04:}
\DoxyCodeLine{00781\ \ \ \ \ Vi\ =\ v3;}
\DoxyCodeLine{00782\ \ \ \ \ offset\ =\ mixer\_offset<1>::value;}
\DoxyCodeLine{00783\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00784\ \ \ \textcolor{keywordflow}{case}\ 0x05:}
\DoxyCodeLine{00785\ \ \ \ \ Vi\ =\ v3\ +\ v1;}
\DoxyCodeLine{00786\ \ \ \ \ offset\ =\ mixer\_offset<2>::value;}
\DoxyCodeLine{00787\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00788\ \ \ \textcolor{keywordflow}{case}\ 0x06:}
\DoxyCodeLine{00789\ \ \ \ \ Vi\ =\ v3\ +\ v2;}
\DoxyCodeLine{00790\ \ \ \ \ offset\ =\ mixer\_offset<2>::value;}
\DoxyCodeLine{00791\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00792\ \ \ \textcolor{keywordflow}{case}\ 0x07:}
\DoxyCodeLine{00793\ \ \ \ \ Vi\ =\ v3\ +\ v2\ +\ v1;}
\DoxyCodeLine{00794\ \ \ \ \ offset\ =\ mixer\_offset<3>::value;}
\DoxyCodeLine{00795\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00796\ \ \ \textcolor{keywordflow}{case}\ 0x08:}
\DoxyCodeLine{00797\ \ \ \ \ Vi\ =\ ve;}
\DoxyCodeLine{00798\ \ \ \ \ offset\ =\ mixer\_offset<1>::value;}
\DoxyCodeLine{00799\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00800\ \ \ \textcolor{keywordflow}{case}\ 0x09:}
\DoxyCodeLine{00801\ \ \ \ \ Vi\ =\ ve\ +\ v1;}
\DoxyCodeLine{00802\ \ \ \ \ offset\ =\ mixer\_offset<2>::value;}
\DoxyCodeLine{00803\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00804\ \ \ \textcolor{keywordflow}{case}\ 0x0a:}
\DoxyCodeLine{00805\ \ \ \ \ Vi\ =\ ve\ +\ v2;}
\DoxyCodeLine{00806\ \ \ \ \ offset\ =\ mixer\_offset<2>::value;}
\DoxyCodeLine{00807\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00808\ \ \ \textcolor{keywordflow}{case}\ 0x0b:}
\DoxyCodeLine{00809\ \ \ \ \ Vi\ =\ ve\ +\ v2\ +\ v1;}
\DoxyCodeLine{00810\ \ \ \ \ offset\ =\ mixer\_offset<3>::value;}
\DoxyCodeLine{00811\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00812\ \ \ \textcolor{keywordflow}{case}\ 0x0c:}
\DoxyCodeLine{00813\ \ \ \ \ Vi\ =\ ve\ +\ v3;}
\DoxyCodeLine{00814\ \ \ \ \ offset\ =\ mixer\_offset<2>::value;}
\DoxyCodeLine{00815\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00816\ \ \ \textcolor{keywordflow}{case}\ 0x0d:}
\DoxyCodeLine{00817\ \ \ \ \ Vi\ =\ ve\ +\ v3\ +\ v1;}
\DoxyCodeLine{00818\ \ \ \ \ offset\ =\ mixer\_offset<3>::value;}
\DoxyCodeLine{00819\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00820\ \ \ \textcolor{keywordflow}{case}\ 0x0e:}
\DoxyCodeLine{00821\ \ \ \ \ Vi\ =\ ve\ +\ v3\ +\ v2;}
\DoxyCodeLine{00822\ \ \ \ \ offset\ =\ mixer\_offset<3>::value;}
\DoxyCodeLine{00823\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00824\ \ \ \textcolor{keywordflow}{case}\ 0x0f:}
\DoxyCodeLine{00825\ \ \ \ \ Vi\ =\ ve\ +\ v3\ +\ v2\ +\ v1;}
\DoxyCodeLine{00826\ \ \ \ \ offset\ =\ mixer\_offset<4>::value;}
\DoxyCodeLine{00827\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00828\ \ \ \textcolor{keywordflow}{case}\ 0x10:}
\DoxyCodeLine{00829\ \ \ \ \ Vi\ =\ Vlp;}
\DoxyCodeLine{00830\ \ \ \ \ offset\ =\ mixer\_offset<1>::value;}
\DoxyCodeLine{00831\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00832\ \ \ \textcolor{keywordflow}{case}\ 0x11:}
\DoxyCodeLine{00833\ \ \ \ \ Vi\ =\ Vlp\ +\ v1;}
\DoxyCodeLine{00834\ \ \ \ \ offset\ =\ mixer\_offset<2>::value;}
\DoxyCodeLine{00835\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00836\ \ \ \textcolor{keywordflow}{case}\ 0x12:}
\DoxyCodeLine{00837\ \ \ \ \ Vi\ =\ Vlp\ +\ v2;}
\DoxyCodeLine{00838\ \ \ \ \ offset\ =\ mixer\_offset<2>::value;}
\DoxyCodeLine{00839\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00840\ \ \ \textcolor{keywordflow}{case}\ 0x13:}
\DoxyCodeLine{00841\ \ \ \ \ Vi\ =\ Vlp\ +\ v2\ +\ v1;}
\DoxyCodeLine{00842\ \ \ \ \ offset\ =\ mixer\_offset<3>::value;}
\DoxyCodeLine{00843\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00844\ \ \ \textcolor{keywordflow}{case}\ 0x14:}
\DoxyCodeLine{00845\ \ \ \ \ Vi\ =\ Vlp\ +\ v3;}
\DoxyCodeLine{00846\ \ \ \ \ offset\ =\ mixer\_offset<2>::value;}
\DoxyCodeLine{00847\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00848\ \ \ \textcolor{keywordflow}{case}\ 0x15:}
\DoxyCodeLine{00849\ \ \ \ \ Vi\ =\ Vlp\ +\ v3\ +\ v1;}
\DoxyCodeLine{00850\ \ \ \ \ offset\ =\ mixer\_offset<3>::value;}
\DoxyCodeLine{00851\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00852\ \ \ \textcolor{keywordflow}{case}\ 0x16:}
\DoxyCodeLine{00853\ \ \ \ \ Vi\ =\ Vlp\ +\ v3\ +\ v2;}
\DoxyCodeLine{00854\ \ \ \ \ offset\ =\ mixer\_offset<3>::value;}
\DoxyCodeLine{00855\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00856\ \ \ \textcolor{keywordflow}{case}\ 0x17:}
\DoxyCodeLine{00857\ \ \ \ \ Vi\ =\ Vlp\ +\ v3\ +\ v2\ +\ v1;}
\DoxyCodeLine{00858\ \ \ \ \ offset\ =\ mixer\_offset<4>::value;}
\DoxyCodeLine{00859\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00860\ \ \ \textcolor{keywordflow}{case}\ 0x18:}
\DoxyCodeLine{00861\ \ \ \ \ Vi\ =\ Vlp\ +\ ve;}
\DoxyCodeLine{00862\ \ \ \ \ offset\ =\ mixer\_offset<2>::value;}
\DoxyCodeLine{00863\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00864\ \ \ \textcolor{keywordflow}{case}\ 0x19:}
\DoxyCodeLine{00865\ \ \ \ \ Vi\ =\ Vlp\ +\ ve\ +\ v1;}
\DoxyCodeLine{00866\ \ \ \ \ offset\ =\ mixer\_offset<3>::value;}
\DoxyCodeLine{00867\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00868\ \ \ \textcolor{keywordflow}{case}\ 0x1a:}
\DoxyCodeLine{00869\ \ \ \ \ Vi\ =\ Vlp\ +\ ve\ +\ v2;}
\DoxyCodeLine{00870\ \ \ \ \ offset\ =\ mixer\_offset<3>::value;}
\DoxyCodeLine{00871\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00872\ \ \ \textcolor{keywordflow}{case}\ 0x1b:}
\DoxyCodeLine{00873\ \ \ \ \ Vi\ =\ Vlp\ +\ ve\ +\ v2\ +\ v1;}
\DoxyCodeLine{00874\ \ \ \ \ offset\ =\ mixer\_offset<4>::value;}
\DoxyCodeLine{00875\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00876\ \ \ \textcolor{keywordflow}{case}\ 0x1c:}
\DoxyCodeLine{00877\ \ \ \ \ Vi\ =\ Vlp\ +\ ve\ +\ v3;}
\DoxyCodeLine{00878\ \ \ \ \ offset\ =\ mixer\_offset<3>::value;}
\DoxyCodeLine{00879\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00880\ \ \ \textcolor{keywordflow}{case}\ 0x1d:}
\DoxyCodeLine{00881\ \ \ \ \ Vi\ =\ Vlp\ +\ ve\ +\ v3\ +\ v1;}
\DoxyCodeLine{00882\ \ \ \ \ offset\ =\ mixer\_offset<4>::value;}
\DoxyCodeLine{00883\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00884\ \ \ \textcolor{keywordflow}{case}\ 0x1e:}
\DoxyCodeLine{00885\ \ \ \ \ Vi\ =\ Vlp\ +\ ve\ +\ v3\ +\ v2;}
\DoxyCodeLine{00886\ \ \ \ \ offset\ =\ mixer\_offset<4>::value;}
\DoxyCodeLine{00887\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00888\ \ \ \textcolor{keywordflow}{case}\ 0x1f:}
\DoxyCodeLine{00889\ \ \ \ \ Vi\ =\ Vlp\ +\ ve\ +\ v3\ +\ v2\ +\ v1;}
\DoxyCodeLine{00890\ \ \ \ \ offset\ =\ mixer\_offset<5>::value;}
\DoxyCodeLine{00891\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00892\ \ \ \textcolor{keywordflow}{case}\ 0x20:}
\DoxyCodeLine{00893\ \ \ \ \ Vi\ =\ Vbp;}
\DoxyCodeLine{00894\ \ \ \ \ offset\ =\ mixer\_offset<1>::value;}
\DoxyCodeLine{00895\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00896\ \ \ \textcolor{keywordflow}{case}\ 0x21:}
\DoxyCodeLine{00897\ \ \ \ \ Vi\ =\ Vbp\ +\ v1;}
\DoxyCodeLine{00898\ \ \ \ \ offset\ =\ mixer\_offset<2>::value;}
\DoxyCodeLine{00899\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00900\ \ \ \textcolor{keywordflow}{case}\ 0x22:}
\DoxyCodeLine{00901\ \ \ \ \ Vi\ =\ Vbp\ +\ v2;}
\DoxyCodeLine{00902\ \ \ \ \ offset\ =\ mixer\_offset<2>::value;}
\DoxyCodeLine{00903\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00904\ \ \ \textcolor{keywordflow}{case}\ 0x23:}
\DoxyCodeLine{00905\ \ \ \ \ Vi\ =\ Vbp\ +\ v2\ +\ v1;}
\DoxyCodeLine{00906\ \ \ \ \ offset\ =\ mixer\_offset<3>::value;}
\DoxyCodeLine{00907\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00908\ \ \ \textcolor{keywordflow}{case}\ 0x24:}
\DoxyCodeLine{00909\ \ \ \ \ Vi\ =\ Vbp\ +\ v3;}
\DoxyCodeLine{00910\ \ \ \ \ offset\ =\ mixer\_offset<2>::value;}
\DoxyCodeLine{00911\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00912\ \ \ \textcolor{keywordflow}{case}\ 0x25:}
\DoxyCodeLine{00913\ \ \ \ \ Vi\ =\ Vbp\ +\ v3\ +\ v1;}
\DoxyCodeLine{00914\ \ \ \ \ offset\ =\ mixer\_offset<3>::value;}
\DoxyCodeLine{00915\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00916\ \ \ \textcolor{keywordflow}{case}\ 0x26:}
\DoxyCodeLine{00917\ \ \ \ \ Vi\ =\ Vbp\ +\ v3\ +\ v2;}
\DoxyCodeLine{00918\ \ \ \ \ offset\ =\ mixer\_offset<3>::value;}
\DoxyCodeLine{00919\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00920\ \ \ \textcolor{keywordflow}{case}\ 0x27:}
\DoxyCodeLine{00921\ \ \ \ \ Vi\ =\ Vbp\ +\ v3\ +\ v2\ +\ v1;}
\DoxyCodeLine{00922\ \ \ \ \ offset\ =\ mixer\_offset<4>::value;}
\DoxyCodeLine{00923\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00924\ \ \ \textcolor{keywordflow}{case}\ 0x28:}
\DoxyCodeLine{00925\ \ \ \ \ Vi\ =\ Vbp\ +\ ve;}
\DoxyCodeLine{00926\ \ \ \ \ offset\ =\ mixer\_offset<2>::value;}
\DoxyCodeLine{00927\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00928\ \ \ \textcolor{keywordflow}{case}\ 0x29:}
\DoxyCodeLine{00929\ \ \ \ \ Vi\ =\ Vbp\ +\ ve\ +\ v1;}
\DoxyCodeLine{00930\ \ \ \ \ offset\ =\ mixer\_offset<3>::value;}
\DoxyCodeLine{00931\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00932\ \ \ \textcolor{keywordflow}{case}\ 0x2a:}
\DoxyCodeLine{00933\ \ \ \ \ Vi\ =\ Vbp\ +\ ve\ +\ v2;}
\DoxyCodeLine{00934\ \ \ \ \ offset\ =\ mixer\_offset<3>::value;}
\DoxyCodeLine{00935\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00936\ \ \ \textcolor{keywordflow}{case}\ 0x2b:}
\DoxyCodeLine{00937\ \ \ \ \ Vi\ =\ Vbp\ +\ ve\ +\ v2\ +\ v1;}
\DoxyCodeLine{00938\ \ \ \ \ offset\ =\ mixer\_offset<4>::value;}
\DoxyCodeLine{00939\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00940\ \ \ \textcolor{keywordflow}{case}\ 0x2c:}
\DoxyCodeLine{00941\ \ \ \ \ Vi\ =\ Vbp\ +\ ve\ +\ v3;}
\DoxyCodeLine{00942\ \ \ \ \ offset\ =\ mixer\_offset<3>::value;}
\DoxyCodeLine{00943\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00944\ \ \ \textcolor{keywordflow}{case}\ 0x2d:}
\DoxyCodeLine{00945\ \ \ \ \ Vi\ =\ Vbp\ +\ ve\ +\ v3\ +\ v1;}
\DoxyCodeLine{00946\ \ \ \ \ offset\ =\ mixer\_offset<4>::value;}
\DoxyCodeLine{00947\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00948\ \ \ \textcolor{keywordflow}{case}\ 0x2e:}
\DoxyCodeLine{00949\ \ \ \ \ Vi\ =\ Vbp\ +\ ve\ +\ v3\ +\ v2;}
\DoxyCodeLine{00950\ \ \ \ \ offset\ =\ mixer\_offset<4>::value;}
\DoxyCodeLine{00951\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00952\ \ \ \textcolor{keywordflow}{case}\ 0x2f:}
\DoxyCodeLine{00953\ \ \ \ \ Vi\ =\ Vbp\ +\ ve\ +\ v3\ +\ v2\ +\ v1;}
\DoxyCodeLine{00954\ \ \ \ \ offset\ =\ mixer\_offset<5>::value;}
\DoxyCodeLine{00955\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00956\ \ \ \textcolor{keywordflow}{case}\ 0x30:}
\DoxyCodeLine{00957\ \ \ \ \ Vi\ =\ Vbp\ +\ Vlp;}
\DoxyCodeLine{00958\ \ \ \ \ offset\ =\ mixer\_offset<2>::value;}
\DoxyCodeLine{00959\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00960\ \ \ \textcolor{keywordflow}{case}\ 0x31:}
\DoxyCodeLine{00961\ \ \ \ \ Vi\ =\ Vbp\ +\ Vlp\ +\ v1;}
\DoxyCodeLine{00962\ \ \ \ \ offset\ =\ mixer\_offset<3>::value;}
\DoxyCodeLine{00963\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00964\ \ \ \textcolor{keywordflow}{case}\ 0x32:}
\DoxyCodeLine{00965\ \ \ \ \ Vi\ =\ Vbp\ +\ Vlp\ +\ v2;}
\DoxyCodeLine{00966\ \ \ \ \ offset\ =\ mixer\_offset<3>::value;}
\DoxyCodeLine{00967\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00968\ \ \ \textcolor{keywordflow}{case}\ 0x33:}
\DoxyCodeLine{00969\ \ \ \ \ Vi\ =\ Vbp\ +\ Vlp\ +\ v2\ +\ v1;}
\DoxyCodeLine{00970\ \ \ \ \ offset\ =\ mixer\_offset<4>::value;}
\DoxyCodeLine{00971\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00972\ \ \ \textcolor{keywordflow}{case}\ 0x34:}
\DoxyCodeLine{00973\ \ \ \ \ Vi\ =\ Vbp\ +\ Vlp\ +\ v3;}
\DoxyCodeLine{00974\ \ \ \ \ offset\ =\ mixer\_offset<3>::value;}
\DoxyCodeLine{00975\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00976\ \ \ \textcolor{keywordflow}{case}\ 0x35:}
\DoxyCodeLine{00977\ \ \ \ \ Vi\ =\ Vbp\ +\ Vlp\ +\ v3\ +\ v1;}
\DoxyCodeLine{00978\ \ \ \ \ offset\ =\ mixer\_offset<4>::value;}
\DoxyCodeLine{00979\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00980\ \ \ \textcolor{keywordflow}{case}\ 0x36:}
\DoxyCodeLine{00981\ \ \ \ \ Vi\ =\ Vbp\ +\ Vlp\ +\ v3\ +\ v2;}
\DoxyCodeLine{00982\ \ \ \ \ offset\ =\ mixer\_offset<4>::value;}
\DoxyCodeLine{00983\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00984\ \ \ \textcolor{keywordflow}{case}\ 0x37:}
\DoxyCodeLine{00985\ \ \ \ \ Vi\ =\ Vbp\ +\ Vlp\ +\ v3\ +\ v2\ +\ v1;}
\DoxyCodeLine{00986\ \ \ \ \ offset\ =\ mixer\_offset<5>::value;}
\DoxyCodeLine{00987\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00988\ \ \ \textcolor{keywordflow}{case}\ 0x38:}
\DoxyCodeLine{00989\ \ \ \ \ Vi\ =\ Vbp\ +\ Vlp\ +\ ve;}
\DoxyCodeLine{00990\ \ \ \ \ offset\ =\ mixer\_offset<3>::value;}
\DoxyCodeLine{00991\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00992\ \ \ \textcolor{keywordflow}{case}\ 0x39:}
\DoxyCodeLine{00993\ \ \ \ \ Vi\ =\ Vbp\ +\ Vlp\ +\ ve\ +\ v1;}
\DoxyCodeLine{00994\ \ \ \ \ offset\ =\ mixer\_offset<4>::value;}
\DoxyCodeLine{00995\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00996\ \ \ \textcolor{keywordflow}{case}\ 0x3a:}
\DoxyCodeLine{00997\ \ \ \ \ Vi\ =\ Vbp\ +\ Vlp\ +\ ve\ +\ v2;}
\DoxyCodeLine{00998\ \ \ \ \ offset\ =\ mixer\_offset<4>::value;}
\DoxyCodeLine{00999\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{01000\ \ \ \textcolor{keywordflow}{case}\ 0x3b:}
\DoxyCodeLine{01001\ \ \ \ \ Vi\ =\ Vbp\ +\ Vlp\ +\ ve\ +\ v2\ +\ v1;}
\DoxyCodeLine{01002\ \ \ \ \ offset\ =\ mixer\_offset<5>::value;}
\DoxyCodeLine{01003\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{01004\ \ \ \textcolor{keywordflow}{case}\ 0x3c:}
\DoxyCodeLine{01005\ \ \ \ \ Vi\ =\ Vbp\ +\ Vlp\ +\ ve\ +\ v3;}
\DoxyCodeLine{01006\ \ \ \ \ offset\ =\ mixer\_offset<4>::value;}
\DoxyCodeLine{01007\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{01008\ \ \ \textcolor{keywordflow}{case}\ 0x3d:}
\DoxyCodeLine{01009\ \ \ \ \ Vi\ =\ Vbp\ +\ Vlp\ +\ ve\ +\ v3\ +\ v1;}
\DoxyCodeLine{01010\ \ \ \ \ offset\ =\ mixer\_offset<5>::value;}
\DoxyCodeLine{01011\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{01012\ \ \ \textcolor{keywordflow}{case}\ 0x3e:}
\DoxyCodeLine{01013\ \ \ \ \ Vi\ =\ Vbp\ +\ Vlp\ +\ ve\ +\ v3\ +\ v2;}
\DoxyCodeLine{01014\ \ \ \ \ offset\ =\ mixer\_offset<5>::value;}
\DoxyCodeLine{01015\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{01016\ \ \ \textcolor{keywordflow}{case}\ 0x3f:}
\DoxyCodeLine{01017\ \ \ \ \ Vi\ =\ Vbp\ +\ Vlp\ +\ ve\ +\ v3\ +\ v2\ +\ v1;}
\DoxyCodeLine{01018\ \ \ \ \ offset\ =\ mixer\_offset<6>::value;}
\DoxyCodeLine{01019\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{01020\ \ \ \textcolor{keywordflow}{case}\ 0x40:}
\DoxyCodeLine{01021\ \ \ \ \ Vi\ =\ Vhp;}
\DoxyCodeLine{01022\ \ \ \ \ offset\ =\ mixer\_offset<1>::value;}
\DoxyCodeLine{01023\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{01024\ \ \ \textcolor{keywordflow}{case}\ 0x41:}
\DoxyCodeLine{01025\ \ \ \ \ Vi\ =\ Vhp\ +\ v1;}
\DoxyCodeLine{01026\ \ \ \ \ offset\ =\ mixer\_offset<2>::value;}
\DoxyCodeLine{01027\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{01028\ \ \ \textcolor{keywordflow}{case}\ 0x42:}
\DoxyCodeLine{01029\ \ \ \ \ Vi\ =\ Vhp\ +\ v2;}
\DoxyCodeLine{01030\ \ \ \ \ offset\ =\ mixer\_offset<2>::value;}
\DoxyCodeLine{01031\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{01032\ \ \ \textcolor{keywordflow}{case}\ 0x43:}
\DoxyCodeLine{01033\ \ \ \ \ Vi\ =\ Vhp\ +\ v2\ +\ v1;}
\DoxyCodeLine{01034\ \ \ \ \ offset\ =\ mixer\_offset<3>::value;}
\DoxyCodeLine{01035\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{01036\ \ \ \textcolor{keywordflow}{case}\ 0x44:}
\DoxyCodeLine{01037\ \ \ \ \ Vi\ =\ Vhp\ +\ v3;}
\DoxyCodeLine{01038\ \ \ \ \ offset\ =\ mixer\_offset<2>::value;}
\DoxyCodeLine{01039\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{01040\ \ \ \textcolor{keywordflow}{case}\ 0x45:}
\DoxyCodeLine{01041\ \ \ \ \ Vi\ =\ Vhp\ +\ v3\ +\ v1;}
\DoxyCodeLine{01042\ \ \ \ \ offset\ =\ mixer\_offset<3>::value;}
\DoxyCodeLine{01043\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{01044\ \ \ \textcolor{keywordflow}{case}\ 0x46:}
\DoxyCodeLine{01045\ \ \ \ \ Vi\ =\ Vhp\ +\ v3\ +\ v2;}
\DoxyCodeLine{01046\ \ \ \ \ offset\ =\ mixer\_offset<3>::value;}
\DoxyCodeLine{01047\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{01048\ \ \ \textcolor{keywordflow}{case}\ 0x47:}
\DoxyCodeLine{01049\ \ \ \ \ Vi\ =\ Vhp\ +\ v3\ +\ v2\ +\ v1;}
\DoxyCodeLine{01050\ \ \ \ \ offset\ =\ mixer\_offset<4>::value;}
\DoxyCodeLine{01051\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{01052\ \ \ \textcolor{keywordflow}{case}\ 0x48:}
\DoxyCodeLine{01053\ \ \ \ \ Vi\ =\ Vhp\ +\ ve;}
\DoxyCodeLine{01054\ \ \ \ \ offset\ =\ mixer\_offset<2>::value;}
\DoxyCodeLine{01055\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{01056\ \ \ \textcolor{keywordflow}{case}\ 0x49:}
\DoxyCodeLine{01057\ \ \ \ \ Vi\ =\ Vhp\ +\ ve\ +\ v1;}
\DoxyCodeLine{01058\ \ \ \ \ offset\ =\ mixer\_offset<3>::value;}
\DoxyCodeLine{01059\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{01060\ \ \ \textcolor{keywordflow}{case}\ 0x4a:}
\DoxyCodeLine{01061\ \ \ \ \ Vi\ =\ Vhp\ +\ ve\ +\ v2;}
\DoxyCodeLine{01062\ \ \ \ \ offset\ =\ mixer\_offset<3>::value;}
\DoxyCodeLine{01063\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{01064\ \ \ \textcolor{keywordflow}{case}\ 0x4b:}
\DoxyCodeLine{01065\ \ \ \ \ Vi\ =\ Vhp\ +\ ve\ +\ v2\ +\ v1;}
\DoxyCodeLine{01066\ \ \ \ \ offset\ =\ mixer\_offset<4>::value;}
\DoxyCodeLine{01067\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{01068\ \ \ \textcolor{keywordflow}{case}\ 0x4c:}
\DoxyCodeLine{01069\ \ \ \ \ Vi\ =\ Vhp\ +\ ve\ +\ v3;}
\DoxyCodeLine{01070\ \ \ \ \ offset\ =\ mixer\_offset<3>::value;}
\DoxyCodeLine{01071\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{01072\ \ \ \textcolor{keywordflow}{case}\ 0x4d:}
\DoxyCodeLine{01073\ \ \ \ \ Vi\ =\ Vhp\ +\ ve\ +\ v3\ +\ v1;}
\DoxyCodeLine{01074\ \ \ \ \ offset\ =\ mixer\_offset<4>::value;}
\DoxyCodeLine{01075\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{01076\ \ \ \textcolor{keywordflow}{case}\ 0x4e:}
\DoxyCodeLine{01077\ \ \ \ \ Vi\ =\ Vhp\ +\ ve\ +\ v3\ +\ v2;}
\DoxyCodeLine{01078\ \ \ \ \ offset\ =\ mixer\_offset<4>::value;}
\DoxyCodeLine{01079\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{01080\ \ \ \textcolor{keywordflow}{case}\ 0x4f:}
\DoxyCodeLine{01081\ \ \ \ \ Vi\ =\ Vhp\ +\ ve\ +\ v3\ +\ v2\ +\ v1;}
\DoxyCodeLine{01082\ \ \ \ \ offset\ =\ mixer\_offset<5>::value;}
\DoxyCodeLine{01083\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{01084\ \ \ \textcolor{keywordflow}{case}\ 0x50:}
\DoxyCodeLine{01085\ \ \ \ \ Vi\ =\ Vhp\ +\ Vlp;}
\DoxyCodeLine{01086\ \ \ \ \ offset\ =\ mixer\_offset<2>::value;}
\DoxyCodeLine{01087\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{01088\ \ \ \textcolor{keywordflow}{case}\ 0x51:}
\DoxyCodeLine{01089\ \ \ \ \ Vi\ =\ Vhp\ +\ Vlp\ +\ v1;}
\DoxyCodeLine{01090\ \ \ \ \ offset\ =\ mixer\_offset<3>::value;}
\DoxyCodeLine{01091\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{01092\ \ \ \textcolor{keywordflow}{case}\ 0x52:}
\DoxyCodeLine{01093\ \ \ \ \ Vi\ =\ Vhp\ +\ Vlp\ +\ v2;}
\DoxyCodeLine{01094\ \ \ \ \ offset\ =\ mixer\_offset<3>::value;}
\DoxyCodeLine{01095\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{01096\ \ \ \textcolor{keywordflow}{case}\ 0x53:}
\DoxyCodeLine{01097\ \ \ \ \ Vi\ =\ Vhp\ +\ Vlp\ +\ v2\ +\ v1;}
\DoxyCodeLine{01098\ \ \ \ \ offset\ =\ mixer\_offset<4>::value;}
\DoxyCodeLine{01099\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{01100\ \ \ \textcolor{keywordflow}{case}\ 0x54:}
\DoxyCodeLine{01101\ \ \ \ \ Vi\ =\ Vhp\ +\ Vlp\ +\ v3;}
\DoxyCodeLine{01102\ \ \ \ \ offset\ =\ mixer\_offset<3>::value;}
\DoxyCodeLine{01103\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{01104\ \ \ \textcolor{keywordflow}{case}\ 0x55:}
\DoxyCodeLine{01105\ \ \ \ \ Vi\ =\ Vhp\ +\ Vlp\ +\ v3\ +\ v1;}
\DoxyCodeLine{01106\ \ \ \ \ offset\ =\ mixer\_offset<4>::value;}
\DoxyCodeLine{01107\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{01108\ \ \ \textcolor{keywordflow}{case}\ 0x56:}
\DoxyCodeLine{01109\ \ \ \ \ Vi\ =\ Vhp\ +\ Vlp\ +\ v3\ +\ v2;}
\DoxyCodeLine{01110\ \ \ \ \ offset\ =\ mixer\_offset<4>::value;}
\DoxyCodeLine{01111\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{01112\ \ \ \textcolor{keywordflow}{case}\ 0x57:}
\DoxyCodeLine{01113\ \ \ \ \ Vi\ =\ Vhp\ +\ Vlp\ +\ v3\ +\ v2\ +\ v1;}
\DoxyCodeLine{01114\ \ \ \ \ offset\ =\ mixer\_offset<5>::value;}
\DoxyCodeLine{01115\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{01116\ \ \ \textcolor{keywordflow}{case}\ 0x58:}
\DoxyCodeLine{01117\ \ \ \ \ Vi\ =\ Vhp\ +\ Vlp\ +\ ve;}
\DoxyCodeLine{01118\ \ \ \ \ offset\ =\ mixer\_offset<3>::value;}
\DoxyCodeLine{01119\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{01120\ \ \ \textcolor{keywordflow}{case}\ 0x59:}
\DoxyCodeLine{01121\ \ \ \ \ Vi\ =\ Vhp\ +\ Vlp\ +\ ve\ +\ v1;}
\DoxyCodeLine{01122\ \ \ \ \ offset\ =\ mixer\_offset<4>::value;}
\DoxyCodeLine{01123\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{01124\ \ \ \textcolor{keywordflow}{case}\ 0x5a:}
\DoxyCodeLine{01125\ \ \ \ \ Vi\ =\ Vhp\ +\ Vlp\ +\ ve\ +\ v2;}
\DoxyCodeLine{01126\ \ \ \ \ offset\ =\ mixer\_offset<4>::value;}
\DoxyCodeLine{01127\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{01128\ \ \ \textcolor{keywordflow}{case}\ 0x5b:}
\DoxyCodeLine{01129\ \ \ \ \ Vi\ =\ Vhp\ +\ Vlp\ +\ ve\ +\ v2\ +\ v1;}
\DoxyCodeLine{01130\ \ \ \ \ offset\ =\ mixer\_offset<5>::value;}
\DoxyCodeLine{01131\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{01132\ \ \ \textcolor{keywordflow}{case}\ 0x5c:}
\DoxyCodeLine{01133\ \ \ \ \ Vi\ =\ Vhp\ +\ Vlp\ +\ ve\ +\ v3;}
\DoxyCodeLine{01134\ \ \ \ \ offset\ =\ mixer\_offset<4>::value;}
\DoxyCodeLine{01135\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{01136\ \ \ \textcolor{keywordflow}{case}\ 0x5d:}
\DoxyCodeLine{01137\ \ \ \ \ Vi\ =\ Vhp\ +\ Vlp\ +\ ve\ +\ v3\ +\ v1;}
\DoxyCodeLine{01138\ \ \ \ \ offset\ =\ mixer\_offset<5>::value;}
\DoxyCodeLine{01139\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{01140\ \ \ \textcolor{keywordflow}{case}\ 0x5e:}
\DoxyCodeLine{01141\ \ \ \ \ Vi\ =\ Vhp\ +\ Vlp\ +\ ve\ +\ v3\ +\ v2;}
\DoxyCodeLine{01142\ \ \ \ \ offset\ =\ mixer\_offset<5>::value;}
\DoxyCodeLine{01143\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{01144\ \ \ \textcolor{keywordflow}{case}\ 0x5f:}
\DoxyCodeLine{01145\ \ \ \ \ Vi\ =\ Vhp\ +\ Vlp\ +\ ve\ +\ v3\ +\ v2\ +\ v1;}
\DoxyCodeLine{01146\ \ \ \ \ offset\ =\ mixer\_offset<6>::value;}
\DoxyCodeLine{01147\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{01148\ \ \ \textcolor{keywordflow}{case}\ 0x60:}
\DoxyCodeLine{01149\ \ \ \ \ Vi\ =\ Vhp\ +\ Vbp;}
\DoxyCodeLine{01150\ \ \ \ \ offset\ =\ mixer\_offset<2>::value;}
\DoxyCodeLine{01151\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{01152\ \ \ \textcolor{keywordflow}{case}\ 0x61:}
\DoxyCodeLine{01153\ \ \ \ \ Vi\ =\ Vhp\ +\ Vbp\ +\ v1;}
\DoxyCodeLine{01154\ \ \ \ \ offset\ =\ mixer\_offset<3>::value;}
\DoxyCodeLine{01155\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{01156\ \ \ \textcolor{keywordflow}{case}\ 0x62:}
\DoxyCodeLine{01157\ \ \ \ \ Vi\ =\ Vhp\ +\ Vbp\ +\ v2;}
\DoxyCodeLine{01158\ \ \ \ \ offset\ =\ mixer\_offset<3>::value;}
\DoxyCodeLine{01159\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{01160\ \ \ \textcolor{keywordflow}{case}\ 0x63:}
\DoxyCodeLine{01161\ \ \ \ \ Vi\ =\ Vhp\ +\ Vbp\ +\ v2\ +\ v1;}
\DoxyCodeLine{01162\ \ \ \ \ offset\ =\ mixer\_offset<4>::value;}
\DoxyCodeLine{01163\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{01164\ \ \ \textcolor{keywordflow}{case}\ 0x64:}
\DoxyCodeLine{01165\ \ \ \ \ Vi\ =\ Vhp\ +\ Vbp\ +\ v3;}
\DoxyCodeLine{01166\ \ \ \ \ offset\ =\ mixer\_offset<3>::value;}
\DoxyCodeLine{01167\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{01168\ \ \ \textcolor{keywordflow}{case}\ 0x65:}
\DoxyCodeLine{01169\ \ \ \ \ Vi\ =\ Vhp\ +\ Vbp\ +\ v3\ +\ v1;}
\DoxyCodeLine{01170\ \ \ \ \ offset\ =\ mixer\_offset<4>::value;}
\DoxyCodeLine{01171\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{01172\ \ \ \textcolor{keywordflow}{case}\ 0x66:}
\DoxyCodeLine{01173\ \ \ \ \ Vi\ =\ Vhp\ +\ Vbp\ +\ v3\ +\ v2;}
\DoxyCodeLine{01174\ \ \ \ \ offset\ =\ mixer\_offset<4>::value;}
\DoxyCodeLine{01175\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{01176\ \ \ \textcolor{keywordflow}{case}\ 0x67:}
\DoxyCodeLine{01177\ \ \ \ \ Vi\ =\ Vhp\ +\ Vbp\ +\ v3\ +\ v2\ +\ v1;}
\DoxyCodeLine{01178\ \ \ \ \ offset\ =\ mixer\_offset<5>::value;}
\DoxyCodeLine{01179\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{01180\ \ \ \textcolor{keywordflow}{case}\ 0x68:}
\DoxyCodeLine{01181\ \ \ \ \ Vi\ =\ Vhp\ +\ Vbp\ +\ ve;}
\DoxyCodeLine{01182\ \ \ \ \ offset\ =\ mixer\_offset<3>::value;}
\DoxyCodeLine{01183\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{01184\ \ \ \textcolor{keywordflow}{case}\ 0x69:}
\DoxyCodeLine{01185\ \ \ \ \ Vi\ =\ Vhp\ +\ Vbp\ +\ ve\ +\ v1;}
\DoxyCodeLine{01186\ \ \ \ \ offset\ =\ mixer\_offset<4>::value;}
\DoxyCodeLine{01187\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{01188\ \ \ \textcolor{keywordflow}{case}\ 0x6a:}
\DoxyCodeLine{01189\ \ \ \ \ Vi\ =\ Vhp\ +\ Vbp\ +\ ve\ +\ v2;}
\DoxyCodeLine{01190\ \ \ \ \ offset\ =\ mixer\_offset<4>::value;}
\DoxyCodeLine{01191\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{01192\ \ \ \textcolor{keywordflow}{case}\ 0x6b:}
\DoxyCodeLine{01193\ \ \ \ \ Vi\ =\ Vhp\ +\ Vbp\ +\ ve\ +\ v2\ +\ v1;}
\DoxyCodeLine{01194\ \ \ \ \ offset\ =\ mixer\_offset<5>::value;}
\DoxyCodeLine{01195\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{01196\ \ \ \textcolor{keywordflow}{case}\ 0x6c:}
\DoxyCodeLine{01197\ \ \ \ \ Vi\ =\ Vhp\ +\ Vbp\ +\ ve\ +\ v3;}
\DoxyCodeLine{01198\ \ \ \ \ offset\ =\ mixer\_offset<4>::value;}
\DoxyCodeLine{01199\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{01200\ \ \ \textcolor{keywordflow}{case}\ 0x6d:}
\DoxyCodeLine{01201\ \ \ \ \ Vi\ =\ Vhp\ +\ Vbp\ +\ ve\ +\ v3\ +\ v1;}
\DoxyCodeLine{01202\ \ \ \ \ offset\ =\ mixer\_offset<5>::value;}
\DoxyCodeLine{01203\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{01204\ \ \ \textcolor{keywordflow}{case}\ 0x6e:}
\DoxyCodeLine{01205\ \ \ \ \ Vi\ =\ Vhp\ +\ Vbp\ +\ ve\ +\ v3\ +\ v2;}
\DoxyCodeLine{01206\ \ \ \ \ offset\ =\ mixer\_offset<5>::value;}
\DoxyCodeLine{01207\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{01208\ \ \ \textcolor{keywordflow}{case}\ 0x6f:}
\DoxyCodeLine{01209\ \ \ \ \ Vi\ =\ Vhp\ +\ Vbp\ +\ ve\ +\ v3\ +\ v2\ +\ v1;}
\DoxyCodeLine{01210\ \ \ \ \ offset\ =\ mixer\_offset<6>::value;}
\DoxyCodeLine{01211\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{01212\ \ \ \textcolor{keywordflow}{case}\ 0x70:}
\DoxyCodeLine{01213\ \ \ \ \ Vi\ =\ Vhp\ +\ Vbp\ +\ Vlp;}
\DoxyCodeLine{01214\ \ \ \ \ offset\ =\ mixer\_offset<3>::value;}
\DoxyCodeLine{01215\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{01216\ \ \ \textcolor{keywordflow}{case}\ 0x71:}
\DoxyCodeLine{01217\ \ \ \ \ Vi\ =\ Vhp\ +\ Vbp\ +\ Vlp\ +\ v1;}
\DoxyCodeLine{01218\ \ \ \ \ offset\ =\ mixer\_offset<4>::value;}
\DoxyCodeLine{01219\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{01220\ \ \ \textcolor{keywordflow}{case}\ 0x72:}
\DoxyCodeLine{01221\ \ \ \ \ Vi\ =\ Vhp\ +\ Vbp\ +\ Vlp\ +\ v2;}
\DoxyCodeLine{01222\ \ \ \ \ offset\ =\ mixer\_offset<4>::value;}
\DoxyCodeLine{01223\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{01224\ \ \ \textcolor{keywordflow}{case}\ 0x73:}
\DoxyCodeLine{01225\ \ \ \ \ Vi\ =\ Vhp\ +\ Vbp\ +\ Vlp\ +\ v2\ +\ v1;}
\DoxyCodeLine{01226\ \ \ \ \ offset\ =\ mixer\_offset<5>::value;}
\DoxyCodeLine{01227\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{01228\ \ \ \textcolor{keywordflow}{case}\ 0x74:}
\DoxyCodeLine{01229\ \ \ \ \ Vi\ =\ Vhp\ +\ Vbp\ +\ Vlp\ +\ v3;}
\DoxyCodeLine{01230\ \ \ \ \ offset\ =\ mixer\_offset<4>::value;}
\DoxyCodeLine{01231\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{01232\ \ \ \textcolor{keywordflow}{case}\ 0x75:}
\DoxyCodeLine{01233\ \ \ \ \ Vi\ =\ Vhp\ +\ Vbp\ +\ Vlp\ +\ v3\ +\ v1;}
\DoxyCodeLine{01234\ \ \ \ \ offset\ =\ mixer\_offset<5>::value;}
\DoxyCodeLine{01235\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{01236\ \ \ \textcolor{keywordflow}{case}\ 0x76:}
\DoxyCodeLine{01237\ \ \ \ \ Vi\ =\ Vhp\ +\ Vbp\ +\ Vlp\ +\ v3\ +\ v2;}
\DoxyCodeLine{01238\ \ \ \ \ offset\ =\ mixer\_offset<5>::value;}
\DoxyCodeLine{01239\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{01240\ \ \ \textcolor{keywordflow}{case}\ 0x77:}
\DoxyCodeLine{01241\ \ \ \ \ Vi\ =\ Vhp\ +\ Vbp\ +\ Vlp\ +\ v3\ +\ v2\ +\ v1;}
\DoxyCodeLine{01242\ \ \ \ \ offset\ =\ mixer\_offset<6>::value;}
\DoxyCodeLine{01243\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{01244\ \ \ \textcolor{keywordflow}{case}\ 0x78:}
\DoxyCodeLine{01245\ \ \ \ \ Vi\ =\ Vhp\ +\ Vbp\ +\ Vlp\ +\ ve;}
\DoxyCodeLine{01246\ \ \ \ \ offset\ =\ mixer\_offset<4>::value;}
\DoxyCodeLine{01247\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{01248\ \ \ \textcolor{keywordflow}{case}\ 0x79:}
\DoxyCodeLine{01249\ \ \ \ \ Vi\ =\ Vhp\ +\ Vbp\ +\ Vlp\ +\ ve\ +\ v1;}
\DoxyCodeLine{01250\ \ \ \ \ offset\ =\ mixer\_offset<5>::value;}
\DoxyCodeLine{01251\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{01252\ \ \ \textcolor{keywordflow}{case}\ 0x7a:}
\DoxyCodeLine{01253\ \ \ \ \ Vi\ =\ Vhp\ +\ Vbp\ +\ Vlp\ +\ ve\ +\ v2;}
\DoxyCodeLine{01254\ \ \ \ \ offset\ =\ mixer\_offset<5>::value;}
\DoxyCodeLine{01255\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{01256\ \ \ \textcolor{keywordflow}{case}\ 0x7b:}
\DoxyCodeLine{01257\ \ \ \ \ Vi\ =\ Vhp\ +\ Vbp\ +\ Vlp\ +\ ve\ +\ v2\ +\ v1;}
\DoxyCodeLine{01258\ \ \ \ \ offset\ =\ mixer\_offset<6>::value;}
\DoxyCodeLine{01259\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{01260\ \ \ \textcolor{keywordflow}{case}\ 0x7c:}
\DoxyCodeLine{01261\ \ \ \ \ Vi\ =\ Vhp\ +\ Vbp\ +\ Vlp\ +\ ve\ +\ v3;}
\DoxyCodeLine{01262\ \ \ \ \ offset\ =\ mixer\_offset<5>::value;}
\DoxyCodeLine{01263\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{01264\ \ \ \textcolor{keywordflow}{case}\ 0x7d:}
\DoxyCodeLine{01265\ \ \ \ \ Vi\ =\ Vhp\ +\ Vbp\ +\ Vlp\ +\ ve\ +\ v3\ +\ v1;}
\DoxyCodeLine{01266\ \ \ \ \ offset\ =\ mixer\_offset<6>::value;}
\DoxyCodeLine{01267\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{01268\ \ \ \textcolor{keywordflow}{case}\ 0x7e:}
\DoxyCodeLine{01269\ \ \ \ \ Vi\ =\ Vhp\ +\ Vbp\ +\ Vlp\ +\ ve\ +\ v3\ +\ v2;}
\DoxyCodeLine{01270\ \ \ \ \ offset\ =\ mixer\_offset<6>::value;}
\DoxyCodeLine{01271\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{01272\ \ \ \textcolor{keywordflow}{case}\ 0x7f:}
\DoxyCodeLine{01273\ \ \ \ \ Vi\ =\ Vhp\ +\ Vbp\ +\ Vlp\ +\ ve\ +\ v3\ +\ v2\ +\ v1;}
\DoxyCodeLine{01274\ \ \ \ \ offset\ =\ mixer\_offset<7>::value;}
\DoxyCodeLine{01275\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{01276\ \ \ \}}
\DoxyCodeLine{01277\ }
\DoxyCodeLine{01278\ \ \ \textcolor{comment}{//\ Sum\ the\ inputs\ in\ the\ mixer\ and\ run\ the\ mixer\ output\ through\ the\ gain.}}
\DoxyCodeLine{01279\ \ \ \textcolor{keywordflow}{if}\ (sid\_model\ ==\ 0)\ \{}
\DoxyCodeLine{01280\ \ \ \ \ \textcolor{keywordflow}{return}\ (\textcolor{keywordtype}{short})(f.gain[vol][f.mixer[offset\ +\ Vi]]\ -\/\ (1\ <<\ 15));}
\DoxyCodeLine{01281\ \ \ \}}
\DoxyCodeLine{01282\ \ \ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{01283\ \ \ \ \ \textcolor{comment}{//\ FIXME:\ Temporary\ code\ for\ MOS\ 8580,\ should\ use\ code\ above.}}
\DoxyCodeLine{01284\ \ \ \ \ \textcolor{comment}{/*\ do\ hard\ clipping\ here,\ else\ some\ tunes\ manage\ to\ overflow\ this}}
\DoxyCodeLine{01285\ \textcolor{comment}{\ \ \ \ \ \ \ (eg\ /MUSICIANS/L/Linus/64\_Forever.sid,\ starting\ at\ 0:44)\ */}}
\DoxyCodeLine{01286\ \ \ \ \ \textcolor{keywordtype}{int}\ tmp\ =\ Vi*(int)vol\ >>\ 4;}
\DoxyCodeLine{01287\ \ \ \ \ \textcolor{keywordflow}{if}\ (tmp\ <\ -\/32768)\ tmp\ =\ -\/32768;}
\DoxyCodeLine{01288\ \ \ \ \ \textcolor{keywordflow}{if}\ (tmp\ >\ 32767)\ tmp\ =\ 32767;}
\DoxyCodeLine{01289\ \ \ \ \ \textcolor{keywordflow}{return}\ (\textcolor{keywordtype}{short})tmp;\ \ \}}
\DoxyCodeLine{01290\ \}}
\DoxyCodeLine{01291\ }
\DoxyCodeLine{01292\ }
\DoxyCodeLine{01293\ \textcolor{comment}{/*}}
\DoxyCodeLine{01294\ \textcolor{comment}{Find\ output\ voltage\ in\ inverting\ gain\ and\ inverting\ summer\ SID\ op-\/amp}}
\DoxyCodeLine{01295\ \textcolor{comment}{circuits,\ using\ a\ combination\ of\ Newton-\/Raphson\ and\ bisection.}}
\DoxyCodeLine{01296\ \textcolor{comment}{}}
\DoxyCodeLine{01297\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ \ \ \ \ -\/-\/-\/R2-\/-\/}}
\DoxyCodeLine{01298\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ \ \ \ |\ \ \ \ \ \ \ |}}
\DoxyCodeLine{01299\ \textcolor{comment}{\ \ vi\ -\/-\/-\/R1-\/-\/-\/-\/-\/[A>-\/-\/-\/-\/-\/\ vo}}
\DoxyCodeLine{01300\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ \ \ \ vx}}
\DoxyCodeLine{01301\ \textcolor{comment}{}}
\DoxyCodeLine{01302\ \textcolor{comment}{From\ Kirchoff's\ current\ law\ it\ follows\ that}}
\DoxyCodeLine{01303\ \textcolor{comment}{}}
\DoxyCodeLine{01304\ \textcolor{comment}{\ \ IR1f\ +\ IR2r\ =\ 0}}
\DoxyCodeLine{01305\ \textcolor{comment}{}}
\DoxyCodeLine{01306\ \textcolor{comment}{Substituting\ the\ triode\ mode\ transistor\ model\ K*W/L*(Vgst\string^2\ -\/\ Vgdt\string^2)}}
\DoxyCodeLine{01307\ \textcolor{comment}{for\ the\ currents,\ we\ get:}}
\DoxyCodeLine{01308\ \textcolor{comment}{}}
\DoxyCodeLine{01309\ \textcolor{comment}{\ \ n*((Vddt\ -\/\ vx)\string^2\ -\/\ (Vddt\ -\/\ vi)\string^2)\ +\ (Vddt\ -\/\ vx)\string^2\ -\/\ (Vddt\ -\/\ vo)\string^2\ =\ 0}}
\DoxyCodeLine{01310\ \textcolor{comment}{}}
\DoxyCodeLine{01311\ \textcolor{comment}{Our\ root\ function\ f\ can\ thus\ be\ written\ as:}}
\DoxyCodeLine{01312\ \textcolor{comment}{}}
\DoxyCodeLine{01313\ \textcolor{comment}{\ \ f\ =\ (n\ +\ 1)*(Vddt\ -\/\ vx)\string^2\ -\/\ n*(Vddt\ -\/\ vi)\string^2\ -\/\ (Vddt\ -\/\ vo)\string^2\ =\ 0}}
\DoxyCodeLine{01314\ \textcolor{comment}{}}
\DoxyCodeLine{01315\ \textcolor{comment}{We\ are\ using\ the\ mapping\ function\ x\ =\ vo\ -\/\ vx\ -\/>\ vx.\ We\ thus\ substitute}}
\DoxyCodeLine{01316\ \textcolor{comment}{for\ vo\ =\ vx\ +\ x\ and\ get:}}
\DoxyCodeLine{01317\ \textcolor{comment}{}}
\DoxyCodeLine{01318\ \textcolor{comment}{\ \ f\ =\ (n\ +\ 1)*(Vddt\ -\/\ vx)\string^2\ -\/\ n*(Vddt\ -\/\ vi)\string^2\ -\/\ (Vddt\ -\/\ (vx\ +\ x))\string^2\ =\ 0}}
\DoxyCodeLine{01319\ \textcolor{comment}{}}
\DoxyCodeLine{01320\ \textcolor{comment}{Using\ substitution\ constants}}
\DoxyCodeLine{01321\ \textcolor{comment}{}}
\DoxyCodeLine{01322\ \textcolor{comment}{\ \ a\ =\ n\ +\ 1}}
\DoxyCodeLine{01323\ \textcolor{comment}{\ \ b\ =\ Vddt}}
\DoxyCodeLine{01324\ \textcolor{comment}{\ \ c\ =\ n*(Vddt\ -\/\ vi)\string^2}}
\DoxyCodeLine{01325\ \textcolor{comment}{}}
\DoxyCodeLine{01326\ \textcolor{comment}{the\ equations\ for\ the\ root\ function\ and\ its\ derivative\ can\ be\ written\ as:}}
\DoxyCodeLine{01327\ \textcolor{comment}{}}
\DoxyCodeLine{01328\ \textcolor{comment}{\ \ f\ =\ a*(b\ -\/\ vx)\string^2\ -\/\ c\ -\/\ (b\ -\/\ (vx\ +\ x))\string^2}}
\DoxyCodeLine{01329\ \textcolor{comment}{\ \ df\ =\ 2*((b\ -\/\ (vx\ +\ x))*(dvx\ +\ 1)\ -\/\ a*(b\ -\/\ vx)*dvx)}}
\DoxyCodeLine{01330\ \textcolor{comment}{*/}}
\DoxyCodeLine{01331\ RESID\_INLINE}
\DoxyCodeLine{01332\ \textcolor{keywordtype}{int}\ Filter::solve\_gain(opamp\_t*\ opamp,\ \textcolor{keywordtype}{int}\ n,\ \textcolor{keywordtype}{int}\ vi,\ \textcolor{keywordtype}{int}\&\ x,\ model\_filter\_t\&\ mf)}
\DoxyCodeLine{01333\ \{}
\DoxyCodeLine{01334\ \ \ \textcolor{comment}{//\ Note\ that\ all\ variables\ are\ translated\ and\ scaled\ in\ order\ to\ fit}}
\DoxyCodeLine{01335\ \ \ \textcolor{comment}{//\ in\ 16\ bits.\ It\ is\ not\ necessary\ to\ explicitly\ translate\ the\ variables\ here,}}
\DoxyCodeLine{01336\ \ \ \textcolor{comment}{//\ since\ they\ are\ all\ used\ in\ subtractions\ which\ cancel\ out\ the\ translation:}}
\DoxyCodeLine{01337\ \ \ \textcolor{comment}{//\ (a\ -\/\ t)\ -\/\ (b\ -\/\ t)\ =\ a\ -\/\ b}}
\DoxyCodeLine{01338\ }
\DoxyCodeLine{01339\ \ \ \textcolor{comment}{//\ Start\ off\ with\ an\ estimate\ of\ x\ and\ a\ root\ bracket\ [ak,\ bk].}}
\DoxyCodeLine{01340\ \ \ \textcolor{comment}{//\ f\ is\ increasing,\ so\ that\ f(ak)\ <\ 0\ and\ f(bk)\ >\ 0.}}
\DoxyCodeLine{01341\ \ \ \textcolor{keywordtype}{int}\ ak\ =\ mf.ak,\ bk\ =\ mf.bk;}
\DoxyCodeLine{01342\ }
\DoxyCodeLine{01343\ \ \ \textcolor{keywordtype}{int}\ a\ =\ n\ +\ (1\ <<\ 7);\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Scaled\ by\ 2\string^7}}
\DoxyCodeLine{01344\ \ \ \textcolor{keywordtype}{int}\ b\ =\ mf.kVddt;\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Scaled\ by\ m*2\string^16}}
\DoxyCodeLine{01345\ \ \ \textcolor{keywordtype}{int}\ b\_vi\ =\ b\ -\/\ vi;\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Scaled\ by\ m*2\string^16}}
\DoxyCodeLine{01346\ \ \ \textcolor{keywordflow}{if}\ (b\_vi\ <\ 0)\ b\_vi\ =\ 0;}
\DoxyCodeLine{01347\ \ \ \textcolor{keywordtype}{int}\ c\ =\ n*int(\textcolor{keywordtype}{unsigned}(b\_vi)*\textcolor{keywordtype}{unsigned}(b\_vi)\ >>\ 12);\ \ \ \ \textcolor{comment}{//\ Scaled\ by\ m\string^2*2\string^27}}
\DoxyCodeLine{01348\ }
\DoxyCodeLine{01349\ \ \ \textcolor{keywordflow}{for}\ (;;)\ \{}
\DoxyCodeLine{01350\ \ \ \ \ \textcolor{keywordtype}{int}\ xk\ =\ x;}
\DoxyCodeLine{01351\ }
\DoxyCodeLine{01352\ \ \ \ \ \textcolor{comment}{//\ Calculate\ f\ and\ df.}}
\DoxyCodeLine{01353\ \ \ \ \ \textcolor{keywordtype}{int}\ vx\ =\ opamp[x].vx;\ \ \ \ \ \ \textcolor{comment}{//\ Scaled\ by\ m*2\string^16}}
\DoxyCodeLine{01354\ \ \ \ \ \textcolor{keywordtype}{int}\ dvx\ =\ opamp[x].dvx;\ \ \ \ \textcolor{comment}{//\ Scaled\ by\ 2\string^11}}
\DoxyCodeLine{01355\ }
\DoxyCodeLine{01356\ \ \ \ \ \textcolor{comment}{//\ f\ =\ a*(b\ -\/\ vx)\string^2\ -\/\ c\ -\/\ (b\ -\/\ vo)\string^2}}
\DoxyCodeLine{01357\ \ \ \ \ \textcolor{comment}{//\ df\ =\ 2*((b\ -\/\ vo)*(dvx\ +\ 1)\ -\/\ a*(b\ -\/\ vx)*dvx)}}
\DoxyCodeLine{01358\ \ \ \ \ \textcolor{comment}{//}}
\DoxyCodeLine{01359\ \ \ \ \ \textcolor{keywordtype}{int}\ vo\ =\ vx\ +\ (x\ <<\ 1)\ -\/\ (1\ <<\ 16);}
\DoxyCodeLine{01360\ \ \ \ \ \textcolor{keywordflow}{if}\ (vo\ >=\ (1\ <<\ 16))\ \{}
\DoxyCodeLine{01361\ \ \ \ \ \ \ vo\ =\ (1\ <<\ 16)\ -\/\ 1;}
\DoxyCodeLine{01362\ \ \ \ \ \}}
\DoxyCodeLine{01363\ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (vo\ <\ 0)\ \{}
\DoxyCodeLine{01364\ \ \ \ \ \ \ vo\ =\ 0;}
\DoxyCodeLine{01365\ \ \ \ \ \}}
\DoxyCodeLine{01366\ \ \ \ \ \textcolor{keywordtype}{int}\ b\_vx\ =\ b\ -\/\ vx;}
\DoxyCodeLine{01367\ \ \ \ \ \textcolor{keywordflow}{if}\ (b\_vx\ <\ 0)\ b\_vx\ =\ 0;}
\DoxyCodeLine{01368\ \ \ \ \ \textcolor{keywordtype}{int}\ b\_vo\ =\ b\ -\/\ vo;}
\DoxyCodeLine{01369\ \ \ \ \ \textcolor{keywordflow}{if}\ (b\_vo\ <\ 0)\ b\_vo\ =\ 0;}
\DoxyCodeLine{01370\ \ \ \ \ \textcolor{comment}{//\ The\ dividend\ is\ scaled\ by\ m\string^2*2\string^27.}}
\DoxyCodeLine{01371\ \ \ \ \ \textcolor{keywordtype}{int}\ f\ =\ a*int(\textcolor{keywordtype}{unsigned}(b\_vx)*\textcolor{keywordtype}{unsigned}(b\_vx)\ >>\ 12)\ -\/\ c\ -\/\ int(\textcolor{keywordtype}{unsigned}(b\_vo)*\textcolor{keywordtype}{unsigned}(b\_vo)\ >>\ 5);}
\DoxyCodeLine{01372\ \ \ \ \ \textcolor{comment}{//\ The\ divisor\ is\ scaled\ by\ m*2\string^11.}}
\DoxyCodeLine{01373\ \ \ \ \ \textcolor{keywordtype}{int}\ df\ =\ ((b\_vo*(dvx\ +\ (1\ <<\ 11))\ >>\ 1)\ -\/\ (a*(b\_vx*dvx\ >>\ 8)))\ >>\ 14;}
\DoxyCodeLine{01374\ \ \ \ \ \textcolor{comment}{//\ The\ resulting\ quotient\ is\ thus\ scaled\ by\ m*2\string^16.}}
\DoxyCodeLine{01375\ }
\DoxyCodeLine{01376\ \ \ \ \ \textcolor{comment}{//\ Newton-\/Raphson\ step:\ xk1\ =\ xk\ -\/\ f(xk)/f'(xk)}}
\DoxyCodeLine{01377\ \ \ \ \ \textcolor{comment}{//\ If\ f(xk)\ or\ f'(xk)\ are\ zero\ then\ we\ can't\ improve\ further.}}
\DoxyCodeLine{01378\ \ \ \ \ \textcolor{keywordflow}{if}\ (df)\ \{}
\DoxyCodeLine{01379\ \ \ \ \ \ \ \ \ x\ -\/=\ f/df;}
\DoxyCodeLine{01380\ \ \ \ \ \}}
\DoxyCodeLine{01381\ \ \ \ \ \textcolor{keywordflow}{if}\ (unlikely(x\ ==\ xk))\ \{}
\DoxyCodeLine{01382\ \ \ \ \ \ \ \textcolor{comment}{//\ No\ further\ root\ improvement\ possible.}}
\DoxyCodeLine{01383\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ vo;}
\DoxyCodeLine{01384\ \ \ \ \ \}}
\DoxyCodeLine{01385\ }
\DoxyCodeLine{01386\ \ \ \ \ \textcolor{comment}{//\ Narrow\ down\ root\ bracket.}}
\DoxyCodeLine{01387\ \ \ \ \ \textcolor{keywordflow}{if}\ (f\ <\ 0)\ \{}
\DoxyCodeLine{01388\ \ \ \ \ \ \ \textcolor{comment}{//\ f(xk)\ <\ 0}}
\DoxyCodeLine{01389\ \ \ \ \ \ \ ak\ =\ xk;}
\DoxyCodeLine{01390\ \ \ \ \ \}}
\DoxyCodeLine{01391\ \ \ \ \ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{01392\ \ \ \ \ \ \ \textcolor{comment}{//\ f(xk)\ >\ 0}}
\DoxyCodeLine{01393\ \ \ \ \ \ \ bk\ =\ xk;}
\DoxyCodeLine{01394\ \ \ \ \ \}}
\DoxyCodeLine{01395\ }
\DoxyCodeLine{01396\ \ \ \ \ \textcolor{keywordflow}{if}\ (unlikely(x\ <=\ ak)\ ||\ unlikely(x\ >=\ bk))\ \{}
\DoxyCodeLine{01397\ \ \ \ \ \ \ \textcolor{comment}{//\ Bisection\ step\ (ala\ Dekker's\ method).}}
\DoxyCodeLine{01398\ \ \ \ \ \ \ x\ =\ (ak\ +\ bk)\ >>\ 1;}
\DoxyCodeLine{01399\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (unlikely(x\ ==\ ak))\ \{}
\DoxyCodeLine{01400\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ No\ further\ bisection\ possible.}}
\DoxyCodeLine{01401\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ vo;}
\DoxyCodeLine{01402\ \ \ \ \ \ \ \}}
\DoxyCodeLine{01403\ \ \ \ \ \}}
\DoxyCodeLine{01404\ \ \ \}}
\DoxyCodeLine{01405\ \}}
\DoxyCodeLine{01406\ }
\DoxyCodeLine{01407\ }
\DoxyCodeLine{01408\ \textcolor{comment}{/*}}
\DoxyCodeLine{01409\ \textcolor{comment}{Find\ output\ voltage\ in\ inverting\ integrator\ SID\ op-\/amp\ circuits,\ using\ a}}
\DoxyCodeLine{01410\ \textcolor{comment}{single\ fixpoint\ iteration\ step.}}
\DoxyCodeLine{01411\ \textcolor{comment}{}}
\DoxyCodeLine{01412\ \textcolor{comment}{A\ circuit\ diagram\ of\ a\ MOS\ 6581\ integrator\ is\ shown\ below.}}
\DoxyCodeLine{01413\ \textcolor{comment}{}}
\DoxyCodeLine{01414\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ -\/-\/-\/C-\/-\/-\/}}
\DoxyCodeLine{01415\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ |\ \ \ \ \ \ \ |}}
\DoxyCodeLine{01416\ \textcolor{comment}{\ \ vi\ -\/-\/-\/-\/-\/Rw-\/-\/-\/-\/-\/-\/-\/[A>-\/-\/-\/-\/-\/\ vo}}
\DoxyCodeLine{01417\ \textcolor{comment}{\ \ \ \ \ \ \ |\ \ \ \ \ \ |\ vx}}
\DoxyCodeLine{01418\ \textcolor{comment}{\ \ \ \ \ \ \ \ -\/-\/Rs-\/-\/}}
\DoxyCodeLine{01419\ \textcolor{comment}{}}
\DoxyCodeLine{01420\ \textcolor{comment}{From\ Kirchoff's\ current\ law\ it\ follows\ that}}
\DoxyCodeLine{01421\ \textcolor{comment}{}}
\DoxyCodeLine{01422\ \textcolor{comment}{\ \ IRw\ +\ IRs\ +\ ICr\ =\ 0}}
\DoxyCodeLine{01423\ \textcolor{comment}{}}
\DoxyCodeLine{01424\ \textcolor{comment}{Using\ the\ formula\ for\ current\ through\ a\ capacitor,\ i\ =\ C*dv/dt,\ we\ get}}
\DoxyCodeLine{01425\ \textcolor{comment}{}}
\DoxyCodeLine{01426\ \textcolor{comment}{\ \ IRw\ +\ IRs\ +\ C*(vc\ -\/\ vc0)/dt\ =\ 0}}
\DoxyCodeLine{01427\ \textcolor{comment}{\ \ dt/C*(IRw\ +\ IRs)\ +\ vc\ -\/\ vc0\ =\ 0}}
\DoxyCodeLine{01428\ \textcolor{comment}{\ \ vc\ =\ vc0\ -\/\ n*(IRw(vi,vx)\ +\ IRs(vi,vx))}}
\DoxyCodeLine{01429\ \textcolor{comment}{}}
\DoxyCodeLine{01430\ \textcolor{comment}{which\ may\ be\ rewritten\ as\ the\ following\ iterative\ fixpoint\ function:}}
\DoxyCodeLine{01431\ \textcolor{comment}{}}
\DoxyCodeLine{01432\ \textcolor{comment}{\ \ vc\ =\ vc0\ -\/\ n*(IRw(vi,g(vc))\ +\ IRs(vi,g(vc)))}}
\DoxyCodeLine{01433\ \textcolor{comment}{}}
\DoxyCodeLine{01434\ \textcolor{comment}{To\ accurately\ calculate\ the\ currents\ through\ Rs\ and\ Rw,\ we\ need\ to\ use}}
\DoxyCodeLine{01435\ \textcolor{comment}{transistor\ models.\ Rs\ has\ a\ gate\ voltage\ of\ Vdd\ =\ 12V,\ and\ can\ be}}
\DoxyCodeLine{01436\ \textcolor{comment}{assumed\ to\ always\ be\ in\ triode\ mode.\ For\ Rw,\ the\ situation\ is\ rather}}
\DoxyCodeLine{01437\ \textcolor{comment}{more\ complex,\ as\ it\ turns\ out\ that\ this\ transistor\ will\ operate\ in}}
\DoxyCodeLine{01438\ \textcolor{comment}{both\ subthreshold,\ triode,\ and\ saturation\ modes.}}
\DoxyCodeLine{01439\ \textcolor{comment}{}}
\DoxyCodeLine{01440\ \textcolor{comment}{The\ Shichman-\/Hodges\ transistor\ model\ routinely\ used\ in\ textbooks\ may}}
\DoxyCodeLine{01441\ \textcolor{comment}{be\ written\ as\ follows:}}
\DoxyCodeLine{01442\ \textcolor{comment}{}}
\DoxyCodeLine{01443\ \textcolor{comment}{\ \ Ids\ =\ 0\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ,\ Vgst\ <\ 0\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (subthreshold\ mode)}}
\DoxyCodeLine{01444\ \textcolor{comment}{\ \ Ids\ =\ K/2*W/L*(2*Vgst\ -\/\ Vds)*Vds\ ,\ Vgst\ >=\ 0,\ Vds\ <\ Vgst\ \ (triode\ mode)}}
\DoxyCodeLine{01445\ \textcolor{comment}{\ \ Ids\ =\ K/2*W/L*Vgst\string^2\ \ \ \ \ \ \ \ \ \ \ \ \ ,\ Vgst\ >=\ 0,\ Vds\ >=\ Vgst\ (saturation\ mode)}}
\DoxyCodeLine{01446\ \textcolor{comment}{}}
\DoxyCodeLine{01447\ \textcolor{comment}{\ \ where}}
\DoxyCodeLine{01448\ \textcolor{comment}{\ \ K\ \ \ =\ u*Cox\ (conductance)}}
\DoxyCodeLine{01449\ \textcolor{comment}{\ \ W/L\ =\ ratio\ between\ substrate\ width\ and\ length}}
\DoxyCodeLine{01450\ \textcolor{comment}{\ \ Vgst\ =\ Vg\ -\/\ Vs\ -\/\ Vt\ (overdrive\ voltage)}}
\DoxyCodeLine{01451\ \textcolor{comment}{}}
\DoxyCodeLine{01452\ \textcolor{comment}{This\ transistor\ model\ is\ also\ called\ the\ quadratic\ model.}}
\DoxyCodeLine{01453\ \textcolor{comment}{}}
\DoxyCodeLine{01454\ \textcolor{comment}{Note\ that\ the\ equation\ for\ the\ triode\ mode\ can\ be\ reformulated\ as}}
\DoxyCodeLine{01455\ \textcolor{comment}{independent\ terms\ depending\ on\ Vgs\ and\ Vgd,\ respectively,\ by\ the}}
\DoxyCodeLine{01456\ \textcolor{comment}{following\ substitution:}}
\DoxyCodeLine{01457\ \textcolor{comment}{}}
\DoxyCodeLine{01458\ \textcolor{comment}{\ \ Vds\ =\ Vgst\ -\/\ (Vgst\ -\/\ Vds)\ =\ Vgst\ -\/\ Vgdt}}
\DoxyCodeLine{01459\ \textcolor{comment}{}}
\DoxyCodeLine{01460\ \textcolor{comment}{\ \ Ids\ =\ K*W/L*(2*Vgst\ -\/\ Vds)*Vds}}
\DoxyCodeLine{01461\ \textcolor{comment}{\ \ =\ K*W/L*(2*Vgst\ -\/\ (Vgst\ -\/\ Vgdt)*(Vgst\ -\/\ Vgdt)}}
\DoxyCodeLine{01462\ \textcolor{comment}{\ \ =\ K*W/L*(Vgst\ +\ Vgdt)*(Vgst\ -\/\ Vgdt)}}
\DoxyCodeLine{01463\ \textcolor{comment}{\ \ =\ K*W/L*(Vgst\string^2\ -\/\ Vgdt\string^2)}}
\DoxyCodeLine{01464\ \textcolor{comment}{}}
\DoxyCodeLine{01465\ \textcolor{comment}{This\ turns\ out\ to\ be\ a\ general\ equation\ which\ covers\ both\ the\ triode}}
\DoxyCodeLine{01466\ \textcolor{comment}{and\ saturation\ modes\ (where\ the\ second\ term\ is\ 0\ in\ saturation\ mode).}}
\DoxyCodeLine{01467\ \textcolor{comment}{The\ equation\ is\ also\ symmetrical,\ i.e.\ it\ can\ calculate\ negative}}
\DoxyCodeLine{01468\ \textcolor{comment}{currents\ without\ any\ change\ of\ parameters\ (since\ the\ terms\ for\ drain}}
\DoxyCodeLine{01469\ \textcolor{comment}{and\ source\ are\ identical\ except\ for\ the\ sign).}}
\DoxyCodeLine{01470\ \textcolor{comment}{}}
\DoxyCodeLine{01471\ \textcolor{comment}{FIXME:\ Subthreshold\ as\ function\ of\ Vgs,\ Vgd.}}
\DoxyCodeLine{01472\ \textcolor{comment}{\ \ Ids\ =\ I0*e\string^(Vgst/(n*VT))\ \ \ \ \ \ \ ,\ Vgst\ <\ 0\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (subthreshold\ mode)}}
\DoxyCodeLine{01473\ \textcolor{comment}{}}
\DoxyCodeLine{01474\ \textcolor{comment}{The\ remaining\ problem\ with\ the\ textbook\ model\ is\ that\ the\ transition}}
\DoxyCodeLine{01475\ \textcolor{comment}{from\ subthreshold\ the\ triode/saturation\ is\ not\ continuous.}}
\DoxyCodeLine{01476\ \textcolor{comment}{}}
\DoxyCodeLine{01477\ \textcolor{comment}{Realizing\ that\ the\ subthreshold\ and\ triode/saturation\ modes\ may\ both}}
\DoxyCodeLine{01478\ \textcolor{comment}{be\ defined\ by\ independent\ (and\ equal)\ terms\ of\ Vgs\ and\ Vds,}}
\DoxyCodeLine{01479\ \textcolor{comment}{respectively,\ the\ corresponding\ terms\ can\ be\ blended\ into\ (equal)}}
\DoxyCodeLine{01480\ \textcolor{comment}{continuous\ functions\ suitable\ for\ table\ lookup.}}
\DoxyCodeLine{01481\ \textcolor{comment}{}}
\DoxyCodeLine{01482\ \textcolor{comment}{The\ EKV\ model\ (Enz,\ Krummenacher\ and\ Vittoz)\ essentially\ performs\ this}}
\DoxyCodeLine{01483\ \textcolor{comment}{blending\ using\ an\ elegant\ mathematical\ formulation:}}
\DoxyCodeLine{01484\ \textcolor{comment}{}}
\DoxyCodeLine{01485\ \textcolor{comment}{\ \ Ids\ =\ Is*(if\ -\/\ ir)}}
\DoxyCodeLine{01486\ \textcolor{comment}{\ \ Is\ =\ 2*u*Cox*Ut\string^2/k*W/L}}
\DoxyCodeLine{01487\ \textcolor{comment}{\ \ if\ =\ ln\string^2(1\ +\ e\string^((k*(Vg\ -\/\ Vt)\ -\/\ Vs)/(2*Ut))}}
\DoxyCodeLine{01488\ \textcolor{comment}{\ \ ir\ =\ ln\string^2(1\ +\ e\string^((k*(Vg\ -\/\ Vt)\ -\/\ Vd)/(2*Ut))}}
\DoxyCodeLine{01489\ \textcolor{comment}{}}
\DoxyCodeLine{01490\ \textcolor{comment}{For\ our\ purposes,\ the\ EKV\ model\ preserves\ two\ important\ properties}}
\DoxyCodeLine{01491\ \textcolor{comment}{discussed\ above:}}
\DoxyCodeLine{01492\ \textcolor{comment}{}}
\DoxyCodeLine{01493\ \textcolor{comment}{-\/\ It\ consists\ of\ two\ independent\ terms,\ which\ can\ be\ represented\ by}}
\DoxyCodeLine{01494\ \textcolor{comment}{\ \ the\ same\ lookup\ table.}}
\DoxyCodeLine{01495\ \textcolor{comment}{-\/\ It\ is\ symmetrical,\ i.e.\ it\ calculates\ current\ in\ both\ directions,}}
\DoxyCodeLine{01496\ \textcolor{comment}{\ \ facilitating\ a\ branch-\/free\ implementation.}}
\DoxyCodeLine{01497\ \textcolor{comment}{}}
\DoxyCodeLine{01498\ \textcolor{comment}{Rw\ in\ the\ circuit\ diagram\ above\ is\ a\ VCR\ (voltage\ controlled\ resistor),}}
\DoxyCodeLine{01499\ \textcolor{comment}{as\ shown\ in\ the\ circuit\ diagram\ below.}}
\DoxyCodeLine{01500\ \textcolor{comment}{}}
\DoxyCodeLine{01501\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ Vw}}
\DoxyCodeLine{01502\ \textcolor{comment}{}}
\DoxyCodeLine{01503\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ |}}
\DoxyCodeLine{01504\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ \ \ Vdd\ \ \ \ \ |}}
\DoxyCodeLine{01505\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ \ \ \ \ \ |-\/-\/-\/|}}
\DoxyCodeLine{01506\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ \ \ \ \ \_|\_\ \ \ |}}
\DoxyCodeLine{01507\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ \ \ -\/-\/\ \ \ \ -\/-\/|\ Vg}}
\DoxyCodeLine{01508\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ \ |\ \ \ \ \ \ \_\_|\_\_}}
\DoxyCodeLine{01509\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ \ |\ \ \ \ \ \ -\/-\/-\/-\/-\/\ \ Rw}}
\DoxyCodeLine{01510\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ \ |\ \ \ \ \ \ |\ \ \ |}}
\DoxyCodeLine{01511\ \textcolor{comment}{\ \ vi\ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/\ \ \ \ \ -\/-\/-\/-\/-\/-\/-\/-\/\ vo}}
\DoxyCodeLine{01512\ \textcolor{comment}{}}
\DoxyCodeLine{01513\ \textcolor{comment}{}}
\DoxyCodeLine{01514\ \textcolor{comment}{In\ order\ to\ calculalate\ the\ current\ through\ the\ VCR,\ its\ gate\ voltage}}
\DoxyCodeLine{01515\ \textcolor{comment}{must\ be\ determined.}}
\DoxyCodeLine{01516\ \textcolor{comment}{}}
\DoxyCodeLine{01517\ \textcolor{comment}{Assuming\ triode\ mode\ and\ applying\ Kirchoff's\ current\ law,\ we\ get\ the}}
\DoxyCodeLine{01518\ \textcolor{comment}{following\ equation\ for\ Vg:}}
\DoxyCodeLine{01519\ \textcolor{comment}{}}
\DoxyCodeLine{01520\ \textcolor{comment}{u*Cox/2*W/L*((Vddt\ -\/\ Vg)\string^2\ -\/\ (Vddt\ -\/\ vi)\string^2\ +\ (Vddt\ -\/\ Vg)\string^2\ -\/\ (Vddt\ -\/\ Vw)\string^2)\ =\ 0}}
\DoxyCodeLine{01521\ \textcolor{comment}{2*(Vddt\ -\/\ Vg)\string^2\ -\/\ (Vddt\ -\/\ vi)\string^2\ -\/\ (Vddt\ -\/\ Vw)\string^2\ =\ 0}}
\DoxyCodeLine{01522\ \textcolor{comment}{(Vddt\ -\/\ Vg)\ =\ sqrt(((Vddt\ -\/\ vi)\string^2\ +\ (Vddt\ -\/\ Vw)\string^2)/2)}}
\DoxyCodeLine{01523\ \textcolor{comment}{}}
\DoxyCodeLine{01524\ \textcolor{comment}{Vg\ =\ Vddt\ -\/\ sqrt(((Vddt\ -\/\ vi)\string^2\ +\ (Vddt\ -\/\ Vw)\string^2)/2)}}
\DoxyCodeLine{01525\ \textcolor{comment}{}}
\DoxyCodeLine{01526\ \textcolor{comment}{*/}}
\DoxyCodeLine{01527\ RESID\_INLINE}
\DoxyCodeLine{01528\ \textcolor{keywordtype}{int}\ Filter::solve\_integrate\_6581(\textcolor{keywordtype}{int}\ dt,\ \textcolor{keywordtype}{int}\ vi,\ \textcolor{keywordtype}{int}\&\ vx,\ \textcolor{keywordtype}{int}\&\ vc,\ model\_filter\_t\&\ mf)}
\DoxyCodeLine{01529\ \{}
\DoxyCodeLine{01530\ \ \ \textcolor{comment}{//\ Note\ that\ all\ variables\ are\ translated\ and\ scaled\ in\ order\ to\ fit}}
\DoxyCodeLine{01531\ \ \ \textcolor{comment}{//\ in\ 16\ bits.\ It\ is\ not\ necessary\ to\ explicitly\ translate\ the\ variables\ here,}}
\DoxyCodeLine{01532\ \ \ \textcolor{comment}{//\ since\ they\ are\ all\ used\ in\ subtractions\ which\ cancel\ out\ the\ translation:}}
\DoxyCodeLine{01533\ \ \ \textcolor{comment}{//\ (a\ -\/\ t)\ -\/\ (b\ -\/\ t)\ =\ a\ -\/\ b}}
\DoxyCodeLine{01534\ }
\DoxyCodeLine{01535\ \ \ \textcolor{keywordtype}{int}\ kVddt\ =\ mf.kVddt;\ \ \ \ \ \ \textcolor{comment}{//\ Scaled\ by\ m*2\string^16}}
\DoxyCodeLine{01536\ }
\DoxyCodeLine{01537\ \ \ \textcolor{comment}{//\ "{}Snake"{}\ voltages\ for\ triode\ mode\ calculation.}}
\DoxyCodeLine{01538\ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ Vgst\ =\ kVddt\ -\/\ vx;}
\DoxyCodeLine{01539\ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ Vgdt\ =\ kVddt\ -\/\ vi;}
\DoxyCodeLine{01540\ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ Vgdt\_2\ =\ Vgdt*Vgdt;}
\DoxyCodeLine{01541\ }
\DoxyCodeLine{01542\ \ \ \textcolor{comment}{//\ "{}Snake"{}\ current,\ scaled\ by\ (1/m)*2\string^13*m*2\string^16*m*2\string^16*2\string^-\/15\ =\ m*2\string^30}}
\DoxyCodeLine{01543\ \ \ \textcolor{keywordtype}{int}\ n\_I\_snake\ =\ mf.n\_snake*(int(Vgst*Vgst\ -\/\ Vgdt\_2)\ >>\ 15);}
\DoxyCodeLine{01544\ }
\DoxyCodeLine{01545\ \ \ \textcolor{comment}{//\ VCR\ gate\ voltage.\ \ \ \ \ \ \ //\ Scaled\ by\ m*2\string^16}}
\DoxyCodeLine{01546\ \ \ \textcolor{comment}{//\ Vg\ =\ Vddt\ -\/\ sqrt(((Vddt\ -\/\ Vw)\string^2\ +\ Vgdt\string^2)/2)}}
\DoxyCodeLine{01547\ \ \ \textcolor{keywordtype}{int}\ kVg\ =\ vcr\_kVg[(Vddt\_Vw\_2\ +\ (Vgdt\_2\ >>\ 1))\ >>\ 16];}
\DoxyCodeLine{01548\ }
\DoxyCodeLine{01549\ \ \ \textcolor{comment}{//\ VCR\ voltages\ for\ EKV\ model\ table\ lookup.}}
\DoxyCodeLine{01550\ \ \ \textcolor{keywordtype}{int}\ Vgs\ =\ kVg\ -\/\ vx;}
\DoxyCodeLine{01551\ \ \ \textcolor{keywordflow}{if}\ (Vgs\ <\ 0)\ Vgs\ =\ 0;}
\DoxyCodeLine{01552\ \ \ \textcolor{keywordtype}{int}\ Vgd\ =\ kVg\ -\/\ vi;}
\DoxyCodeLine{01553\ \ \ \textcolor{keywordflow}{if}\ (Vgd\ <\ 0)\ Vgd\ =\ 0;}
\DoxyCodeLine{01554\ }
\DoxyCodeLine{01555\ \ \ \textcolor{comment}{//\ VCR\ current,\ scaled\ by\ m*2\string^15*2\string^15\ =\ m*2\string^30}}
\DoxyCodeLine{01556\ \ \ \textcolor{keywordtype}{int}\ n\_I\_vcr\ =\ int(\textcolor{keywordtype}{unsigned}(vcr\_n\_Ids\_term[Vgs]\ -\/\ vcr\_n\_Ids\_term[Vgd])\ <<\ 15);}
\DoxyCodeLine{01557\ }
\DoxyCodeLine{01558\ \ \ \textcolor{comment}{//\ Change\ in\ capacitor\ charge.}}
\DoxyCodeLine{01559\ \ \ vc\ -\/=\ (n\_I\_snake\ +\ n\_I\_vcr)*dt;}
\DoxyCodeLine{01560\ }
\DoxyCodeLine{01561\ \textcolor{comment}{/*}}
\DoxyCodeLine{01562\ \textcolor{comment}{\ \ //\ FIXME:\ Determine\ whether\ this\ check\ is\ necessary.}}
\DoxyCodeLine{01563\ \textcolor{comment}{\ \ if\ (vc\ <\ mf.vc\_min)\ \{}}
\DoxyCodeLine{01564\ \textcolor{comment}{\ \ \ \ vc\ =\ mf.vc\_min;}}
\DoxyCodeLine{01565\ \textcolor{comment}{\ \ \}}}
\DoxyCodeLine{01566\ \textcolor{comment}{\ \ else\ if\ (vc\ >\ mf.vc\_max)\ \{}}
\DoxyCodeLine{01567\ \textcolor{comment}{\ \ \ \ vc\ =\ mf.vc\_max;}}
\DoxyCodeLine{01568\ \textcolor{comment}{\ \ \}}}
\DoxyCodeLine{01569\ \textcolor{comment}{*/}}
\DoxyCodeLine{01570\ }
\DoxyCodeLine{01571\ \ \ \textcolor{comment}{//\ vx\ =\ g(vc)}}
\DoxyCodeLine{01572\ \ \ vx\ =\ mf.opamp\_rev[(vc\ >>\ 15)\ +\ (1\ <<\ 15)];}
\DoxyCodeLine{01573\ }
\DoxyCodeLine{01574\ \ \ \textcolor{comment}{//\ Return\ vo.}}
\DoxyCodeLine{01575\ \ \ \textcolor{keywordflow}{return}\ vx\ +\ (vc\ >>\ 14);}
\DoxyCodeLine{01576\ \}}
\DoxyCodeLine{01577\ }
\DoxyCodeLine{01578\ \textcolor{preprocessor}{\#endif\ }\textcolor{comment}{//\ RESID\_INLINING\ ||\ defined(RESID\_FILTER\_CC)}}
\DoxyCodeLine{01579\ }
\DoxyCodeLine{01580\ \}\ \textcolor{comment}{//\ namespace\ reSID}}
\DoxyCodeLine{01581\ }
\DoxyCodeLine{01582\ \textcolor{preprocessor}{\#endif\ }\textcolor{comment}{//\ not\ RESID\_FILTER\_H}}

\end{DoxyCode}
