\doxysection{envelope.\+h}
\hypertarget{envelope_8h_source}{}\label{envelope_8h_source}\index{/Users/hoff/Retro/virtualc64/Emulator/Components/SID/resid/envelope.h@{/Users/hoff/Retro/virtualc64/Emulator/Components/SID/resid/envelope.h}}

\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ \textcolor{comment}{//\ \ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{00002\ \textcolor{comment}{//\ \ This\ file\ is\ part\ of\ reSID,\ a\ MOS6581\ SID\ emulator\ engine.}}
\DoxyCodeLine{00003\ \textcolor{comment}{//\ \ Copyright\ (C)\ 2010\ \ Dag\ Lem\ <resid@nimrod.no>}}
\DoxyCodeLine{00004\ \textcolor{comment}{//}}
\DoxyCodeLine{00005\ \textcolor{comment}{//\ \ This\ program\ is\ free\ software;\ you\ can\ redistribute\ it\ and/or\ modify}}
\DoxyCodeLine{00006\ \textcolor{comment}{//\ \ it\ under\ the\ terms\ of\ the\ GNU\ General\ Public\ License\ as\ published\ by}}
\DoxyCodeLine{00007\ \textcolor{comment}{//\ \ the\ Free\ Software\ Foundation;\ either\ version\ 2\ of\ the\ License,\ or}}
\DoxyCodeLine{00008\ \textcolor{comment}{//\ \ (at\ your\ option)\ any\ later\ version.}}
\DoxyCodeLine{00009\ \textcolor{comment}{//}}
\DoxyCodeLine{00010\ \textcolor{comment}{//\ \ This\ program\ is\ distributed\ in\ the\ hope\ that\ it\ will\ be\ useful,}}
\DoxyCodeLine{00011\ \textcolor{comment}{//\ \ but\ WITHOUT\ ANY\ WARRANTY;\ without\ even\ the\ implied\ warranty\ of}}
\DoxyCodeLine{00012\ \textcolor{comment}{//\ \ MERCHANTABILITY\ or\ FITNESS\ FOR\ A\ PARTICULAR\ PURPOSE.\ \ See\ the}}
\DoxyCodeLine{00013\ \textcolor{comment}{//\ \ GNU\ General\ Public\ License\ for\ more\ details.}}
\DoxyCodeLine{00014\ \textcolor{comment}{//}}
\DoxyCodeLine{00015\ \textcolor{comment}{//\ \ You\ should\ have\ received\ a\ copy\ of\ the\ GNU\ General\ Public\ License}}
\DoxyCodeLine{00016\ \textcolor{comment}{//\ \ along\ with\ this\ program;\ if\ not,\ write\ to\ the\ Free\ Software}}
\DoxyCodeLine{00017\ \textcolor{comment}{//\ \ Foundation,\ Inc.,\ 59\ Temple\ Place,\ Suite\ 330,\ Boston,\ MA\ \ 02111-\/1307\ \ USA}}
\DoxyCodeLine{00018\ \textcolor{comment}{//\ \ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{00019\ }
\DoxyCodeLine{00020\ \textcolor{preprocessor}{\#ifndef\ RESID\_ENVELOPE\_H}}
\DoxyCodeLine{00021\ \textcolor{preprocessor}{\#define\ RESID\_ENVELOPE\_H}}
\DoxyCodeLine{00022\ }
\DoxyCodeLine{00023\ \textcolor{preprocessor}{\#include\ "{}resid-\/config.h"{}}}
\DoxyCodeLine{00024\ }
\DoxyCodeLine{00025\ \textcolor{keyword}{namespace\ }reSID}
\DoxyCodeLine{00026\ \{}
\DoxyCodeLine{00027\ }
\DoxyCodeLine{00028\ \textcolor{comment}{//\ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{00029\ \textcolor{comment}{//\ A\ 15\ bit\ counter\ is\ used\ to\ implement\ the\ envelope\ rates,\ in\ effect}}
\DoxyCodeLine{00030\ \textcolor{comment}{//\ dividing\ the\ clock\ to\ the\ envelope\ counter\ by\ the\ currently\ selected\ rate}}
\DoxyCodeLine{00031\ \textcolor{comment}{//\ period.}}
\DoxyCodeLine{00032\ \textcolor{comment}{//\ In\ addition,\ another\ counter\ is\ used\ to\ implement\ the\ exponential\ envelope}}
\DoxyCodeLine{00033\ \textcolor{comment}{//\ decay,\ in\ effect\ further\ dividing\ the\ clock\ to\ the\ envelope\ counter.}}
\DoxyCodeLine{00034\ \textcolor{comment}{//\ The\ period\ of\ this\ counter\ is\ set\ to\ 1,\ 2,\ 4,\ 8,\ 16,\ 30\ at\ the\ envelope}}
\DoxyCodeLine{00035\ \textcolor{comment}{//\ counter\ values\ 255,\ 93,\ 54,\ 26,\ 14,\ 6,\ respectively.}}
\DoxyCodeLine{00036\ \textcolor{comment}{//\ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{00037\ \textcolor{keyword}{class\ }EnvelopeGenerator}
\DoxyCodeLine{00038\ \{}
\DoxyCodeLine{00039\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00040\ \ \ EnvelopeGenerator();}
\DoxyCodeLine{00041\ \ \ \ \ }
\DoxyCodeLine{00042\ \ \ \textcolor{keyword}{typedef}\ \textcolor{keywordtype}{int}\ State;}
\DoxyCodeLine{00043\ \ \ enum\ :\ \textcolor{keywordtype}{int}\ \{\ ATTACK,\ DECAY\_SUSTAIN,\ RELEASE,\ FREEZED\ \};}
\DoxyCodeLine{00044\ \ \ \ \ }
\DoxyCodeLine{00045\ \ \ \textcolor{comment}{//\ enum\ State\ \{\ ATTACK,\ DECAY\_SUSTAIN,\ RELEASE,\ FREEZED\ \};}}
\DoxyCodeLine{00046\ }
\DoxyCodeLine{00047\ \ \ \textcolor{keywordtype}{void}\ set\_chip\_model(chip\_model\ model);}
\DoxyCodeLine{00048\ }
\DoxyCodeLine{00049\ \ \ \textcolor{keywordtype}{void}\ clock();}
\DoxyCodeLine{00050\ \ \ \textcolor{keywordtype}{void}\ clock(cycle\_count\ delta\_t);}
\DoxyCodeLine{00051\ \ \ \textcolor{keywordtype}{void}\ reset();}
\DoxyCodeLine{00052\ }
\DoxyCodeLine{00053\ \ \ \textcolor{keywordtype}{void}\ writeCONTROL\_REG(reg8);}
\DoxyCodeLine{00054\ \ \ \textcolor{keywordtype}{void}\ writeATTACK\_DECAY(reg8);}
\DoxyCodeLine{00055\ \ \ \textcolor{keywordtype}{void}\ writeSUSTAIN\_RELEASE(reg8);}
\DoxyCodeLine{00056\ \ \ reg8\ readENV();}
\DoxyCodeLine{00057\ }
\DoxyCodeLine{00058\ \ \ \textcolor{comment}{//\ 8-\/bit\ envelope\ output.}}
\DoxyCodeLine{00059\ \ \ \textcolor{keywordtype}{short}\ output();}
\DoxyCodeLine{00060\ }
\DoxyCodeLine{00061\ \textcolor{keyword}{protected}:}
\DoxyCodeLine{00062\ \ \ \textcolor{keywordtype}{void}\ set\_exponential\_counter();}
\DoxyCodeLine{00063\ }
\DoxyCodeLine{00064\ \ \ \textcolor{keywordtype}{void}\ state\_change();}
\DoxyCodeLine{00065\ }
\DoxyCodeLine{00066\ \ \ reg16\ rate\_counter;}
\DoxyCodeLine{00067\ \ \ reg16\ rate\_period;}
\DoxyCodeLine{00068\ \ \ reg8\ exponential\_counter;}
\DoxyCodeLine{00069\ \ \ reg8\ exponential\_counter\_period;}
\DoxyCodeLine{00070\ \ \ reg8\ new\_exponential\_counter\_period;}
\DoxyCodeLine{00071\ \ \ reg8\ envelope\_counter;}
\DoxyCodeLine{00072\ \ \ reg8\ env3;}
\DoxyCodeLine{00073\ \ \ \textcolor{comment}{//\ Emulation\ of\ pipeline\ delay\ for\ envelope\ decrement.}}
\DoxyCodeLine{00074\ \ \ cycle\_count\ envelope\_pipeline;}
\DoxyCodeLine{00075\ \ \ cycle\_count\ exponential\_pipeline;}
\DoxyCodeLine{00076\ \ \ cycle\_count\ state\_pipeline;}
\DoxyCodeLine{00077\ \ \ \textcolor{keywordtype}{bool}\ hold\_zero;}
\DoxyCodeLine{00078\ \ \ \textcolor{keywordtype}{bool}\ reset\_rate\_counter;}
\DoxyCodeLine{00079\ }
\DoxyCodeLine{00080\ \ \ reg4\ attack;}
\DoxyCodeLine{00081\ \ \ reg4\ decay;}
\DoxyCodeLine{00082\ \ \ reg4\ sustain;}
\DoxyCodeLine{00083\ \ \ reg4\ release;}
\DoxyCodeLine{00084\ }
\DoxyCodeLine{00085\ \ \ reg8\ gate;}
\DoxyCodeLine{00086\ }
\DoxyCodeLine{00087\ \ \ State\ state;}
\DoxyCodeLine{00088\ \ \ State\ next\_state;}
\DoxyCodeLine{00089\ }
\DoxyCodeLine{00090\ \ \ chip\_model\ sid\_model;}
\DoxyCodeLine{00091\ }
\DoxyCodeLine{00092\ \ \ \textcolor{comment}{//\ Lookup\ table\ to\ convert\ from\ attack,\ decay,\ or\ release\ value\ to\ rate}}
\DoxyCodeLine{00093\ \ \ \textcolor{comment}{//\ counter\ period.}}
\DoxyCodeLine{00094\ \ \ \textcolor{keyword}{static}\ reg16\ rate\_counter\_period[];}
\DoxyCodeLine{00095\ }
\DoxyCodeLine{00096\ \ \ \textcolor{comment}{//\ The\ 16\ selectable\ sustain\ levels.}}
\DoxyCodeLine{00097\ \ \ \textcolor{keyword}{static}\ reg8\ sustain\_level[];}
\DoxyCodeLine{00098\ }
\DoxyCodeLine{00099\ \ \ \textcolor{comment}{//\ DAC\ lookup\ tables.}}
\DoxyCodeLine{00100\ \ \ \textcolor{keyword}{static}\ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{short}\ model\_dac[2][1\ <<\ 8];}
\DoxyCodeLine{00101\ }
\DoxyCodeLine{00102\ \textcolor{keyword}{friend}\ \textcolor{keyword}{class\ }SID;}
\DoxyCodeLine{00103\ \};}
\DoxyCodeLine{00104\ }
\DoxyCodeLine{00105\ }
\DoxyCodeLine{00106\ \textcolor{comment}{//\ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{00107\ \textcolor{comment}{//\ Inline\ functions.}}
\DoxyCodeLine{00108\ \textcolor{comment}{//\ The\ following\ functions\ are\ defined\ inline\ because\ they\ are\ called\ every}}
\DoxyCodeLine{00109\ \textcolor{comment}{//\ time\ a\ sample\ is\ calculated.}}
\DoxyCodeLine{00110\ \textcolor{comment}{//\ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{00111\ }
\DoxyCodeLine{00112\ \textcolor{preprocessor}{\#if\ RESID\_INLINING\ ||\ defined(RESID\_ENVELOPE\_CC)}}
\DoxyCodeLine{00113\ }
\DoxyCodeLine{00114\ \textcolor{comment}{//\ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{00115\ \textcolor{comment}{//\ SID\ clocking\ -\/\ 1\ cycle.}}
\DoxyCodeLine{00116\ \textcolor{comment}{//\ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{00117\ RESID\_INLINE}
\DoxyCodeLine{00118\ \textcolor{keywordtype}{void}\ EnvelopeGenerator::clock()}
\DoxyCodeLine{00119\ \{}
\DoxyCodeLine{00120\ \ \ \textcolor{comment}{//\ The\ ENV3\ value\ is\ sampled\ at\ the\ first\ phase\ of\ the\ clock}}
\DoxyCodeLine{00121\ \ \ env3\ =\ envelope\_counter;}
\DoxyCodeLine{00122\ }
\DoxyCodeLine{00123\ \ \ \textcolor{keywordflow}{if}\ (unlikely(state\_pipeline))\ \{}
\DoxyCodeLine{00124\ \ \ \ \ state\_change();}
\DoxyCodeLine{00125\ \ \ \}}
\DoxyCodeLine{00126\ }
\DoxyCodeLine{00127\ \ \ \textcolor{comment}{//\ If\ the\ exponential\ counter\ period\ !=\ 1,\ the\ envelope\ decrement\ is\ delayed}}
\DoxyCodeLine{00128\ \ \ \textcolor{comment}{//\ 1\ cycle.\ This\ is\ only\ modeled\ for\ single\ cycle\ clocking.}}
\DoxyCodeLine{00129\ \ \ \textcolor{keywordflow}{if}\ (unlikely(envelope\_pipeline\ !=\ 0)\ \&\&\ (-\/-\/envelope\_pipeline\ ==\ 0))\ \{}
\DoxyCodeLine{00130\ \ \ \ \ \textcolor{keywordflow}{if}\ (likely(!hold\_zero))\ \{}
\DoxyCodeLine{00131\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (state\ ==\ ATTACK)\ \{}
\DoxyCodeLine{00132\ \ \ \ \ \ \ \ \ ++envelope\_counter\ \&=\ 0xff;}
\DoxyCodeLine{00133\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (unlikely(envelope\_counter\ ==\ 0xff))\ \{}
\DoxyCodeLine{00134\ \ \ \ \ \ \ \ \ \ \ \ \ state\ =\ DECAY\_SUSTAIN;}
\DoxyCodeLine{00135\ \ \ \ \ \ \ \ \ \ \ \ \ rate\_period\ =\ rate\_counter\_period[decay];}
\DoxyCodeLine{00136\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00137\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00138\ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ ((state\ ==\ DECAY\_SUSTAIN)\ ||\ (state\ ==\ RELEASE))\ \{}
\DoxyCodeLine{00139\ \ \ \ \ \ \ \ \ -\/-\/envelope\_counter\ \&=\ 0xff;}
\DoxyCodeLine{00140\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00141\ }
\DoxyCodeLine{00142\ \ \ \ \ \ \ set\_exponential\_counter();}
\DoxyCodeLine{00143\ \ \ \ \ \}}
\DoxyCodeLine{00144\ \ \ \}}
\DoxyCodeLine{00145\ }
\DoxyCodeLine{00146\ \ \ \textcolor{keywordflow}{if}\ (unlikely(exponential\_pipeline\ !=\ 0)\ \&\&\ (-\/-\/exponential\_pipeline\ ==\ 0))\ \{}
\DoxyCodeLine{00147\ \ \ \ \ exponential\_counter\ =\ 0;}
\DoxyCodeLine{00148\ }
\DoxyCodeLine{00149\ \ \ \ \ \textcolor{keywordflow}{if}\ (((state\ ==\ DECAY\_SUSTAIN)\ \&\&\ (envelope\_counter\ !=\ sustain\_level[sustain]))}
\DoxyCodeLine{00150\ \ \ \ \ \ \ \ \ ||\ (state\ ==\ RELEASE))\ \{}
\DoxyCodeLine{00151\ \ \ \ \ \ \ \textcolor{comment}{//\ The\ envelope\ counter\ can\ flip\ from\ 0x00\ to\ 0xff\ by\ changing\ state\ to}}
\DoxyCodeLine{00152\ \ \ \ \ \ \ \textcolor{comment}{//\ attack,\ then\ to\ release.\ The\ envelope\ counter\ will\ then\ continue}}
\DoxyCodeLine{00153\ \ \ \ \ \ \ \textcolor{comment}{//\ counting\ down\ in\ the\ release\ state.}}
\DoxyCodeLine{00154\ \ \ \ \ \ \ \textcolor{comment}{//\ This\ has\ been\ verified\ by\ sampling\ ENV3.}}
\DoxyCodeLine{00155\ }
\DoxyCodeLine{00156\ \ \ \ \ \ \ envelope\_pipeline\ =\ 1;}
\DoxyCodeLine{00157\ \ \ \ \ \}}
\DoxyCodeLine{00158\ \ \ \}}
\DoxyCodeLine{00159\ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (unlikely(reset\_rate\_counter))\ \{}
\DoxyCodeLine{00160\ \ \ \ \ rate\_counter\ =\ 0;}
\DoxyCodeLine{00161\ \ \ \ \ reset\_rate\_counter\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00162\ }
\DoxyCodeLine{00163\ \ \ \ \ \textcolor{keywordflow}{if}\ (state\ ==\ ATTACK)\ \{}
\DoxyCodeLine{00164\ \ \ \ \ \ \ \textcolor{comment}{//\ The\ first\ envelope\ step\ in\ the\ attack\ state\ also\ resets\ the\ exponential}}
\DoxyCodeLine{00165\ \ \ \ \ \ \ \textcolor{comment}{//\ counter.\ This\ has\ been\ verified\ by\ sampling\ ENV3.}}
\DoxyCodeLine{00166\ \ \ \ \ \ \ exponential\_counter\ =\ 0;\ \textcolor{comment}{//\ NOTE\ this\ is\ actually\ delayed\ one\ cycle,\ not\ modeled}}
\DoxyCodeLine{00167\ }
\DoxyCodeLine{00168\ \ \ \ \ \ \ \textcolor{comment}{//\ The\ envelope\ counter\ can\ flip\ from\ 0xff\ to\ 0x00\ by\ changing\ state\ to}}
\DoxyCodeLine{00169\ \ \ \ \ \ \ \textcolor{comment}{//\ release,\ then\ to\ attack.\ The\ envelope\ counter\ is\ then\ frozen\ at}}
\DoxyCodeLine{00170\ \ \ \ \ \ \ \textcolor{comment}{//\ zero;\ to\ unlock\ this\ situation\ the\ state\ must\ be\ changed\ to\ release,}}
\DoxyCodeLine{00171\ \ \ \ \ \ \ \textcolor{comment}{//\ then\ to\ attack.\ This\ has\ been\ verified\ by\ sampling\ ENV3.}}
\DoxyCodeLine{00172\ }
\DoxyCodeLine{00173\ \ \ \ \ \ \ envelope\_pipeline\ =\ 2;}
\DoxyCodeLine{00174\ \ \ \ \ \}}
\DoxyCodeLine{00175\ \ \ \ \ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00176\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ ((!hold\_zero)\ \&\&\ ++exponential\_counter\ ==\ exponential\_counter\_period)\ \{}
\DoxyCodeLine{00177\ \ \ \ \ \ \ \ \ exponential\_pipeline\ =\ exponential\_counter\_period\ !=\ 1\ ?\ 2\ :\ 1;}
\DoxyCodeLine{00178\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00179\ \ \ \ \ \}}
\DoxyCodeLine{00180\ \ \ \}}
\DoxyCodeLine{00181\ }
\DoxyCodeLine{00182\ \ \ \textcolor{comment}{//\ Check\ for\ ADSR\ delay\ bug.}}
\DoxyCodeLine{00183\ \ \ \textcolor{comment}{//\ If\ the\ rate\ counter\ comparison\ value\ is\ set\ below\ the\ current\ value\ of\ the}}
\DoxyCodeLine{00184\ \ \ \textcolor{comment}{//\ rate\ counter,\ the\ counter\ will\ continue\ counting\ up\ until\ it\ wraps\ around}}
\DoxyCodeLine{00185\ \ \ \textcolor{comment}{//\ to\ zero\ at\ 2\string^15\ =\ 0x8000,\ and\ then\ count\ rate\_period\ -\/\ 1\ before\ the}}
\DoxyCodeLine{00186\ \ \ \textcolor{comment}{//\ envelope\ can\ finally\ be\ stepped.}}
\DoxyCodeLine{00187\ \ \ \textcolor{comment}{//\ This\ has\ been\ verified\ by\ sampling\ ENV3.}}
\DoxyCodeLine{00188\ \ \ \textcolor{comment}{//}}
\DoxyCodeLine{00189\ \ \ \textcolor{keywordflow}{if}\ (likely(rate\_counter\ !=\ rate\_period))\ \{}
\DoxyCodeLine{00190\ \ \ \ \ \textcolor{keywordflow}{if}\ (unlikely(++rate\_counter\ \&\ 0x8000))\ \{}
\DoxyCodeLine{00191\ \ \ \ \ \ \ ++rate\_counter\ \&=\ 0x7fff;}
\DoxyCodeLine{00192\ \ \ \ \ \}}
\DoxyCodeLine{00193\ \ \ \}}
\DoxyCodeLine{00194\ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{00195\ \ \ \ \ reset\_rate\_counter\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00196\ \}}
\DoxyCodeLine{00197\ }
\DoxyCodeLine{00198\ }
\DoxyCodeLine{00199\ \textcolor{comment}{//\ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{00200\ \textcolor{comment}{//\ SID\ clocking\ -\/\ delta\_t\ cycles.}}
\DoxyCodeLine{00201\ \textcolor{comment}{//\ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{00202\ RESID\_INLINE}
\DoxyCodeLine{00203\ \textcolor{keywordtype}{void}\ EnvelopeGenerator::clock(cycle\_count\ delta\_t)}
\DoxyCodeLine{00204\ \{}
\DoxyCodeLine{00205\ \ \ \textcolor{comment}{//\ NB!\ Any\ pipelined\ envelope\ counter\ decrement\ from\ single\ cycle\ clocking}}
\DoxyCodeLine{00206\ \ \ \textcolor{comment}{//\ will\ be\ lost.\ It\ is\ not\ worth\ the\ trouble\ to\ flush\ the\ pipeline\ here.}}
\DoxyCodeLine{00207\ }
\DoxyCodeLine{00208\ \ \ \textcolor{keywordflow}{if}\ (unlikely(state\_pipeline))\ \{}
\DoxyCodeLine{00209\ \ \ \ \ \textcolor{keywordflow}{if}\ (next\_state\ ==\ ATTACK)\ \{}
\DoxyCodeLine{00210\ \ \ \ \ \ \ state\ =\ ATTACK;}
\DoxyCodeLine{00211\ \ \ \ \ \ \ hold\_zero\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00212\ \ \ \ \ \ \ rate\_period\ =\ rate\_counter\_period[attack];}
\DoxyCodeLine{00213\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (next\_state\ ==\ RELEASE)\ \{}
\DoxyCodeLine{00214\ \ \ \ \ \ \ state\ =\ RELEASE;}
\DoxyCodeLine{00215\ \ \ \ \ \ \ rate\_period\ =\ rate\_counter\_period[release];}
\DoxyCodeLine{00216\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (next\_state\ ==\ FREEZED)\ \{}
\DoxyCodeLine{00217\ \ \ \ \ \ \ hold\_zero\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00218\ \ \ \ \ \}}
\DoxyCodeLine{00219\ \ \ \ \ state\_pipeline\ =\ 0;}
\DoxyCodeLine{00220\ \ \ \}}
\DoxyCodeLine{00221\ }
\DoxyCodeLine{00222\ \ \ \textcolor{comment}{//\ Check\ for\ ADSR\ delay\ bug.}}
\DoxyCodeLine{00223\ \ \ \textcolor{comment}{//\ If\ the\ rate\ counter\ comparison\ value\ is\ set\ below\ the\ current\ value\ of\ the}}
\DoxyCodeLine{00224\ \ \ \textcolor{comment}{//\ rate\ counter,\ the\ counter\ will\ continue\ counting\ up\ until\ it\ wraps\ around}}
\DoxyCodeLine{00225\ \ \ \textcolor{comment}{//\ to\ zero\ at\ 2\string^15\ =\ 0x8000,\ and\ then\ count\ rate\_period\ -\/\ 1\ before\ the}}
\DoxyCodeLine{00226\ \ \ \textcolor{comment}{//\ envelope\ can\ finally\ be\ stepped.}}
\DoxyCodeLine{00227\ \ \ \textcolor{comment}{//\ This\ has\ been\ verified\ by\ sampling\ ENV3.}}
\DoxyCodeLine{00228\ \ \ \textcolor{comment}{//}}
\DoxyCodeLine{00229\ }
\DoxyCodeLine{00230\ \ \ \textcolor{comment}{//\ NB!\ This\ requires\ two's\ complement\ integer.}}
\DoxyCodeLine{00231\ \ \ \textcolor{keywordtype}{int}\ rate\_step\ =\ rate\_period\ -\/\ rate\_counter;}
\DoxyCodeLine{00232\ \ \ \textcolor{keywordflow}{if}\ (unlikely(rate\_step\ <=\ 0))\ \{}
\DoxyCodeLine{00233\ \ \ \ \ rate\_step\ +=\ 0x7fff;}
\DoxyCodeLine{00234\ \ \ \}}
\DoxyCodeLine{00235\ }
\DoxyCodeLine{00236\ \ \ \textcolor{keywordflow}{while}\ (delta\_t)\ \{}
\DoxyCodeLine{00237\ \ \ \ \ \textcolor{keywordflow}{if}\ (delta\_t\ <\ rate\_step)\ \{}
\DoxyCodeLine{00238\ \ \ \ \ \ \ \textcolor{comment}{//\ likely\ (\string~65\%)}}
\DoxyCodeLine{00239\ \ \ \ \ \ \ rate\_counter\ +=\ delta\_t;}
\DoxyCodeLine{00240\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (unlikely(rate\_counter\ \&\ 0x8000))\ \{}
\DoxyCodeLine{00241\ \ \ \ \ \ \ \ \ ++rate\_counter\ \&=\ 0x7fff;}
\DoxyCodeLine{00242\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00243\ \ \ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00244\ \ \ \ \ \}}
\DoxyCodeLine{00245\ }
\DoxyCodeLine{00246\ \ \ \ \ rate\_counter\ =\ 0;}
\DoxyCodeLine{00247\ \ \ \ \ delta\_t\ -\/=\ rate\_step;}
\DoxyCodeLine{00248\ }
\DoxyCodeLine{00249\ \ \ \ \ \textcolor{comment}{//\ The\ first\ envelope\ step\ in\ the\ attack\ state\ also\ resets\ the\ exponential}}
\DoxyCodeLine{00250\ \ \ \ \ \textcolor{comment}{//\ counter.\ This\ has\ been\ verified\ by\ sampling\ ENV3.}}
\DoxyCodeLine{00251\ \ \ \ \ \textcolor{comment}{//}}
\DoxyCodeLine{00252\ \ \ \ \ \textcolor{keywordflow}{if}\ (state\ ==\ ATTACK\ ||\ ++exponential\_counter\ ==\ exponential\_counter\_period)\ \{}
\DoxyCodeLine{00253\ \ \ \ \ \ \ \textcolor{comment}{//\ likely\ (\string~50\%)}}
\DoxyCodeLine{00254\ \ \ \ \ \ \ exponential\_counter\ =\ 0;}
\DoxyCodeLine{00255\ }
\DoxyCodeLine{00256\ \ \ \ \ \ \ \textcolor{comment}{//\ Check\ whether\ the\ envelope\ counter\ is\ frozen\ at\ zero.}}
\DoxyCodeLine{00257\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (unlikely(hold\_zero))\ \{}
\DoxyCodeLine{00258\ \ \ \ \ \ \ \ \ rate\_step\ =\ rate\_period;}
\DoxyCodeLine{00259\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{continue};}
\DoxyCodeLine{00260\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00261\ }
\DoxyCodeLine{00262\ \ \ \ \ \ \ \textcolor{keywordflow}{switch}\ (state)\ \{}
\DoxyCodeLine{00263\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ ATTACK:}
\DoxyCodeLine{00264\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ The\ envelope\ counter\ can\ flip\ from\ 0xff\ to\ 0x00\ by\ changing\ state\ to}}
\DoxyCodeLine{00265\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ release,\ then\ to\ attack.\ The\ envelope\ counter\ is\ then\ frozen\ at}}
\DoxyCodeLine{00266\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ zero;\ to\ unlock\ this\ situation\ the\ state\ must\ be\ changed\ to\ release,}}
\DoxyCodeLine{00267\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ then\ to\ attack.\ This\ has\ been\ verified\ by\ sampling\ ENV3.}}
\DoxyCodeLine{00268\ \ \ \ \ \ \ \ \ \textcolor{comment}{//}}
\DoxyCodeLine{00269\ \ \ \ \ \ \ \ \ ++envelope\_counter\ \&=\ 0xff;}
\DoxyCodeLine{00270\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (unlikely(envelope\_counter\ ==\ 0xff))\ \{}
\DoxyCodeLine{00271\ \ \ \ \ \ \ \ \ \ \ state\ =\ DECAY\_SUSTAIN;}
\DoxyCodeLine{00272\ \ \ \ \ \ \ \ \ \ \ rate\_period\ =\ rate\_counter\_period[decay];}
\DoxyCodeLine{00273\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00274\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00275\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ DECAY\_SUSTAIN:}
\DoxyCodeLine{00276\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (likely(envelope\_counter\ !=\ sustain\_level[sustain]))\ \{}
\DoxyCodeLine{00277\ \ \ \ \ \ \ \ \ \ \ -\/-\/envelope\_counter;}
\DoxyCodeLine{00278\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00279\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00280\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ RELEASE:}
\DoxyCodeLine{00281\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ The\ envelope\ counter\ can\ flip\ from\ 0x00\ to\ 0xff\ by\ changing\ state\ to}}
\DoxyCodeLine{00282\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ attack,\ then\ to\ release.\ The\ envelope\ counter\ will\ then\ continue}}
\DoxyCodeLine{00283\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ counting\ down\ in\ the\ release\ state.}}
\DoxyCodeLine{00284\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ This\ has\ been\ verified\ by\ sampling\ ENV3.}}
\DoxyCodeLine{00285\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ NB!\ The\ operation\ below\ requires\ two's\ complement\ integer.}}
\DoxyCodeLine{00286\ \ \ \ \ \ \ \ \ \textcolor{comment}{//}}
\DoxyCodeLine{00287\ \ \ \ \ \ \ \ \ -\/-\/envelope\_counter\ \&=\ 0xff;}
\DoxyCodeLine{00288\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00289\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ FREEZED:}
\DoxyCodeLine{00290\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ we\ should\ never\ get\ here}}
\DoxyCodeLine{00291\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00292\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00293\ }
\DoxyCodeLine{00294\ \ \ \ \ \ \ \textcolor{comment}{//\ Check\ for\ change\ of\ exponential\ counter\ period.}}
\DoxyCodeLine{00295\ \ \ \ \ \ \ set\_exponential\_counter();}
\DoxyCodeLine{00296\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (unlikely(new\_exponential\_counter\_period\ >\ 0))\ \{}
\DoxyCodeLine{00297\ \ \ \ \ \ \ \ \ exponential\_counter\_period\ =\ new\_exponential\_counter\_period;}
\DoxyCodeLine{00298\ \ \ \ \ \ \ \ \ new\_exponential\_counter\_period\ =\ 0;}
\DoxyCodeLine{00299\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (next\_state\ ==\ FREEZED)\ \{}
\DoxyCodeLine{00300\ \ \ \ \ \ \ \ \ \ \ hold\_zero\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00301\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00302\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00303\ \ \ \ \ \}}
\DoxyCodeLine{00304\ }
\DoxyCodeLine{00305\ \ \ \ \ rate\_step\ =\ rate\_period;}
\DoxyCodeLine{00306\ \ \ \}}
\DoxyCodeLine{00307\ \}}
\DoxyCodeLine{00308\ }
\DoxyCodeLine{00348\ RESID\_INLINE}
\DoxyCodeLine{00349\ \textcolor{keywordtype}{void}\ EnvelopeGenerator::state\_change()}
\DoxyCodeLine{00350\ \{}
\DoxyCodeLine{00351\ \ \ state\_pipeline-\/-\/;}
\DoxyCodeLine{00352\ }
\DoxyCodeLine{00353\ \ \ \textcolor{keywordflow}{switch}\ (next\_state)\ \{}
\DoxyCodeLine{00354\ \ \ \ \ \textcolor{keywordflow}{case}\ ATTACK:}
\DoxyCodeLine{00355\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (state\_pipeline\ ==\ 0)\ \{}
\DoxyCodeLine{00356\ \ \ \ \ \ \ \ \ state\ =\ ATTACK;}
\DoxyCodeLine{00357\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ The\ attack\ register\ is\ correctly\ activated\ during\ second\ cycle\ of\ attack\ phase}}
\DoxyCodeLine{00358\ \ \ \ \ \ \ \ \ rate\_period\ =\ rate\_counter\_period[attack];}
\DoxyCodeLine{00359\ \ \ \ \ \ \ \ \ hold\_zero\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00360\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00361\ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00362\ \ \ \ \ \textcolor{keywordflow}{case}\ DECAY\_SUSTAIN:}
\DoxyCodeLine{00363\ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00364\ \ \ \ \ \textcolor{keywordflow}{case}\ RELEASE:}
\DoxyCodeLine{00365\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (((state\ ==\ ATTACK)\ \&\&\ (state\_pipeline\ ==\ 0))}
\DoxyCodeLine{00366\ \ \ \ \ \ \ \ \ \ \ ||\ ((state\ ==\ DECAY\_SUSTAIN)\ \&\&\ (state\_pipeline\ ==\ 1)))\ \{}
\DoxyCodeLine{00367\ \ \ \ \ \ \ \ \ state\ =\ RELEASE;}
\DoxyCodeLine{00368\ \ \ \ \ \ \ \ \ rate\_period\ =\ rate\_counter\_period[release];}
\DoxyCodeLine{00369\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00370\ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00371\ \ \ \ \ \textcolor{keywordflow}{case}\ FREEZED:}
\DoxyCodeLine{00372\ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00373\ \ \ \}}
\DoxyCodeLine{00374\ \}}
\DoxyCodeLine{00375\ }
\DoxyCodeLine{00376\ }
\DoxyCodeLine{00377\ \textcolor{comment}{//\ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{00378\ \textcolor{comment}{//\ Read\ the\ envelope\ generator\ output.}}
\DoxyCodeLine{00379\ \textcolor{comment}{//\ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{00380\ RESID\_INLINE}
\DoxyCodeLine{00381\ \textcolor{keywordtype}{short}\ EnvelopeGenerator::output()}
\DoxyCodeLine{00382\ \{}
\DoxyCodeLine{00383\ \ \ \textcolor{comment}{//\ DAC\ imperfections\ are\ emulated\ by\ using\ envelope\_counter\ as\ an\ index}}
\DoxyCodeLine{00384\ \ \ \textcolor{comment}{//\ into\ a\ DAC\ lookup\ table.\ readENV()\ uses\ envelope\_counter\ directly.}}
\DoxyCodeLine{00385\ \ \ \textcolor{keywordflow}{return}\ model\_dac[sid\_model][envelope\_counter];}
\DoxyCodeLine{00386\ \}}
\DoxyCodeLine{00387\ }
\DoxyCodeLine{00388\ RESID\_INLINE}
\DoxyCodeLine{00389\ \textcolor{keywordtype}{void}\ EnvelopeGenerator::set\_exponential\_counter()}
\DoxyCodeLine{00390\ \{}
\DoxyCodeLine{00391\ \ \ \textcolor{comment}{//\ Check\ for\ change\ of\ exponential\ counter\ period.}}
\DoxyCodeLine{00392\ \ \ \textcolor{keywordflow}{switch}\ (envelope\_counter)\ \{}
\DoxyCodeLine{00393\ \ \ \textcolor{keywordflow}{case}\ 0xff:}
\DoxyCodeLine{00394\ \ \ \ \ exponential\_counter\_period\ =\ 1;}
\DoxyCodeLine{00395\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00396\ \ \ \textcolor{keywordflow}{case}\ 0x5d:}
\DoxyCodeLine{00397\ \ \ \ \ exponential\_counter\_period\ =\ 2;}
\DoxyCodeLine{00398\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00399\ \ \ \textcolor{keywordflow}{case}\ 0x36:}
\DoxyCodeLine{00400\ \ \ \ \ exponential\_counter\_period\ =\ 4;}
\DoxyCodeLine{00401\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00402\ \ \ \textcolor{keywordflow}{case}\ 0x1a:}
\DoxyCodeLine{00403\ \ \ \ \ exponential\_counter\_period\ =\ 8;}
\DoxyCodeLine{00404\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00405\ \ \ \textcolor{keywordflow}{case}\ 0x0e:}
\DoxyCodeLine{00406\ \ \ \ \ exponential\_counter\_period\ =\ 16;}
\DoxyCodeLine{00407\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00408\ \ \ \textcolor{keywordflow}{case}\ 0x06:}
\DoxyCodeLine{00409\ \ \ \ \ exponential\_counter\_period\ =\ 30;}
\DoxyCodeLine{00410\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00411\ \ \ \textcolor{keywordflow}{case}\ 0x00:}
\DoxyCodeLine{00412\ \ \ \ \ \textcolor{comment}{//\ TODO\ write\ a\ test\ to\ verify\ that\ 0x00\ really\ changes\ the\ period}}
\DoxyCodeLine{00413\ \ \ \ \ \textcolor{comment}{//\ e.g.\ set\ R\ =\ 0xf,\ gate\ on\ to\ 0x06,\ gate\ off\ to\ 0x00,\ gate\ on\ to\ 0x04,}}
\DoxyCodeLine{00414\ \ \ \ \ \textcolor{comment}{//\ gate\ off,\ sample.}}
\DoxyCodeLine{00415\ \ \ \ \ exponential\_counter\_period\ =\ 1;}
\DoxyCodeLine{00416\ }
\DoxyCodeLine{00417\ \ \ \ \ \textcolor{comment}{//\ When\ the\ envelope\ counter\ is\ changed\ to\ zero,\ it\ is\ frozen\ at\ zero.}}
\DoxyCodeLine{00418\ \ \ \ \ \textcolor{comment}{//\ This\ has\ been\ verified\ by\ sampling\ ENV3.}}
\DoxyCodeLine{00419\ \ \ \ \ hold\_zero\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00420\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00421\ \ \ \}}
\DoxyCodeLine{00422\ \}}
\DoxyCodeLine{00423\ }
\DoxyCodeLine{00424\ \textcolor{preprocessor}{\#endif\ }\textcolor{comment}{//\ RESID\_INLINING\ ||\ defined(RESID\_ENVELOPE\_CC)}}
\DoxyCodeLine{00425\ }
\DoxyCodeLine{00426\ \}\ \textcolor{comment}{//\ namespace\ reSID}}
\DoxyCodeLine{00427\ }
\DoxyCodeLine{00428\ \textcolor{preprocessor}{\#endif\ }\textcolor{comment}{//\ not\ RESID\_ENVELOPE\_H}}

\end{DoxyCode}
